{
  "analyzeContent": {
    "withProfile": {
      "user": "You are an intelligent content analysis assistant. Analyze article topics and their relevance based on user interests, and generate a concise summary.\n\n# User Profile\n- **Interests**: {{interests}}\n- **Preferences**: {{preferences}}\n- **Avoid Topics**: {{avoidTopics}}\n\n# Article Content\n{{content}}\n{{#originalTitle}}\n\n**Original Title**: {{originalTitle}}{{/originalTitle}}\n\n# Analysis Requirements\n1. Identify 3-5 main topics of the article\n2. Evaluate the relevance of each topic to user interests\n3. Provide probability for each topic (0-1, sum to 1)\n4. Generate a neutral, concise summary in English, <= 80 words, preserving the original meaning\n5. Topics to avoid should be given lower probabilities{{#originalTitle}}\n6. If the original title is not in English, translate it to English (preserve meaning, concise and accurate){{/originalTitle}}\n\n# Output Format (JSON)\n{\n  \"topics\": {\n    \"topic1\": 0.5,\n    \"topic2\": 0.3,\n    \"topic3\": 0.2\n  },\n  \"summary\": \"A neutral 40-80 word summary capturing the article's key points\"{{#originalTitle}},\n  \"translatedTitle\": \"Translated English title (only if original is non-English)\"{{/originalTitle}}\n}\n\nOutput JSON only, no other content."
    },
    "withoutProfile": {
      "user": "Analyze the topic distribution of the following text and generate a summary. Output JSON only.\n\nText:\n{{content}}\n{{#originalTitle}}\n\n**Original Title**: {{originalTitle}}{{/originalTitle}}\n\nPlease:\n1. Identify 3-5 main topics (e.g., \"technology\", \"design\", \"business\") with probabilities (0-1, sum to 1)\n2. Generate a neutral, concise English summary (<= 80 words) capturing the key points{{#originalTitle}}\n3. If the original title is not in English, translate it to English (preserve meaning, concise and accurate){{/originalTitle}}\n\nOutput Format (JSON):\n{\n  \"topics\": {\n    \"technology\": 0.6,\n    \"API\": 0.3,\n    \"tutorial\": 0.1\n  },\n  \"summary\": \"A neutral 40-80 word summary capturing the article's key points\"{{#originalTitle}},\n  \"translatedTitle\": \"Translated English title (only if original is non-English)\"{{/originalTitle}}\n}\n\nOutput JSON only, no other content."
    }
  },
  "analyzeContentReasoning": {
    "withProfile": {
      "user": "You are an intelligent content analysis assistant tasked with analyzing article topics and their relevance based on user interests.\n\n# User Profile\n- **Interests**: {{interests}}\n- **Preferences**: {{preferences}}\n- **Avoid Topics**: {{avoidTopics}}\n\n# Article Content\n{{content}}\n\nPlease think carefully:\n1. What are the main topics of this article?\n2. Which topics are related to the user's interests?\n3. Does it contain topics the user wants to avoid?\n4. What is the importance of each topic?\n\nReturn the analysis result in JSON format, including topics and their probabilities (numbers between 0-1, sum to 1).\nTopics to avoid should be given lower probabilities.\n\nReturn format example:\n{\n  \"topics\": {\n    \"technology\": 0.7,\n    \"open-source\": 0.2,\n    \"tutorial\": 0.1\n  }\n}\n\nReturn JSON only, no other explanations."
    },
    "withoutProfile": {
      "user": "Carefully analyze the following text, identify main topics and evaluate their importance.\n\nText:\n{{content}}\n\nThinking steps:\n1. What is the core content of the text?\n2. What specific topic areas are involved?\n3. What is the proportion of each topic in the text?\n\nReturn the result in JSON format, including topics and their probabilities (between 0-1, sum to 1).\n\nExample format:\n{\n  \"topics\": {\n    \"technology\": 0.6,\n    \"open-source\": 0.3,\n    \"tutorial\": 0.1\n  }\n}\n\nReturn JSON only."
    }
  },
  "generateProfileFull": {
    "user": "You are a user interest analysis expert. Based on user's browsing and reading behavior, generate a user interest profile.\n\n# User Behavior Data\n{{behaviorSummary}}\n\n# Task Requirements\n1. Comprehensively analyze the user's areas of interest (50-200 words, detailed and specific)\n2. Extract the user's content preferences (5-10 specific features)\n3. Identify topics to avoid from rejected articles (3-5 keywords)\n4. Ensure the profile is accurate, specific, and actionable\n\n=== ⚠️ Output Format Requirements ===\n**Key Rules**:\n1. **interests field must be described directly without subject**\n   - ✅ Correct example: \"Shows strong interest in technology, especially focusing on open-source software, development tools...\"\n   - ✅ Correct example: \"Demonstrates a strong willingness to learn in frontend development, frequently reading...\"\n   - ❌ Wrong example: \"The user shows strong interest in technology\"\n   - ❌ Wrong example: \"This user is in frontend development...\"\n   - ❌ Wrong example: \"You show interest in technology...\"\n   \n2. **preferences field**: Return 5-10 specific content types\n   - Example: [\"In-depth technical analysis\", \"Open-source software practices\", \"Product design case studies\"]\n   \n3. **avoidTopics field**: Extract avoid topics from rejected articles\n   - If there are rejection records, extract 3-5 avoid topic keywords\n   - If no rejection records, return empty array []\n   - Example: [\"Entertainment gossip\", \"Advertising marketing\", \"Low-quality content\"]\n\n# Output Format (JSON)\n{\n  \"interests\": \"Concise description of interest areas (50-200 words, natural language)\",\n  \"preferences\": [\"preference1\", \"preference2\", \"preference3\"],\n  \"avoidTopics\": [\"avoid1\", \"avoid2\"]\n}\n\nOutput JSON only, no other content."
  },
  "generateProfileIncremental": {
    "user": "You are a user interest analysis expert. Based on the latest user behavior data, update the user interest profile.\n\n# Current Profile\n- **Interests**: {{interests}}\n- **Preferences**: {{preferences}}\n- **Avoid Topics**: {{avoidTopics}}\n\n# Latest User Behavior Data\n{{behaviorSummary}}\n\n# Task Requirements\n1. Analyze the consistency between new behavior data and current profile\n2. If new interests are discovered, appropriately expand the interest area description\n3. Update or supplement content preferences based on in-depth reading content\n4. **Update the avoid topics list based on rejected articles**\n5. Maintain the coherence and accuracy of the profile\n\n=== ⚠️ Output Format Requirements ===\n**Key Rules**:\n1. **interests field must be described directly without subject**\n   - ✅ Correct example: \"Shows strong interest in technology, especially focusing on open-source software, development tools...\"\n   - ✅ Correct example: \"Demonstrates a strong willingness to learn in frontend development, frequently reading...\"\n   - ❌ Wrong example: \"The user shows strong interest in technology\"\n   - ❌ Wrong example: \"This user is in frontend development...\"\n   - ❌ Wrong example: \"You show interest in technology...\"\n   \n2. **preferences field**: Return 5-10 specific content types\n   - Example: [\"In-depth technical analysis\", \"Open-source software practices\", \"Product design case studies\"]\n   \n3. **avoidTopics field**: Extract avoid topics from rejected articles\n   - If there are rejection records, extract 3-5 avoid topic keywords\n   - If no rejection records, return empty array []\n   - Example: [\"Entertainment gossip\", \"Advertising marketing\", \"Low-quality content\"]\n\n# Output Format (JSON)\n{\n  \"interests\": \"Concise description of interest areas (50-200 words, natural language)\",\n  \"preferences\": [\"preference1\", \"preference2\", \"preference3\"],\n  \"avoidTopics\": [\"avoid1\", \"avoid2\"]\n}\n\nOutput JSON only, no other content."
  },
  "sourceAnalysis": {
    "user": "You are a feed quality analysis expert. Please evaluate the subscription value based on the overall content quality.\n\n# Feed Information\n- **Title**: {{feedTitle}}\n- **Description**: {{feedDescription}}\n- **Link**: {{feedLink}}\n\n# Recent Article Samples (for analysis)\n{{sampleArticles}}\n\n# Evaluation Criteria\n1. **Content Category**: Select the most matching category: tech, news, finance, lifestyle, entertainment, education, science, sports, gaming, design, business, health, travel, food, photography, music, art, politics, culture, other\n2. **Content Language**: Determine the primary language from article titles and content, use standard codes: zh-CN, zh-TW, en, ja, ko, fr, de, es, ru, pt, it, ar, unknown\n3. **Originality** (0-100): How original is the content\n4. **Information Density** (0-100): Ratio of valuable content\n5. **Clickbait Score** (0-100): How misleading are the titles (lower is better)\n6. **Spam Score** (0-100): Ratio of ads/marketing content (lower is better)\n\n# Output Format (JSON)\n{\n  \"topics\": {\"Main Category\": 1.0},\n  \"category\": \"tech\",\n  \"language\": \"en\",\n  \"originality\": 80,\n  \"informationDensity\": 75,\n  \"clickbaitScore\": 20,\n  \"spamScore\": 10,\n  \"reasoning\": \"Brief analysis (under 30 words)\"\n}\n\nField descriptions:\n- topics: Main category with confidence score\n- category: Standard category key\n- language: Content language code (required)\n- originality/informationDensity: Higher is better\n- clickbaitScore/spamScore: Lower is better\n\nOutput JSON only, nothing else."
  },
  "strategyDecision": {
    "system": "You are an intelligent recommendation system strategy decision assistant. Based on the current system state, generate reasonable operating parameters.\n\nYour output must be in pure JSON format without any markdown code blocks or other text.",
    "user": "# System State\n\n## Supply Side\n- Active feeds: {{activeFeeds}}\n- Daily new articles: {{dailyNewArticles}}\n- Raw pool (unanalyzed): {{rawPoolSize}}\n- Candidate pool (high-score articles): {{candidatePoolSize}}\n- Low-score articles: {{analyzedNotQualifiedSize}}\n\n## Demand Side\n- Daily reads: {{dailyReadCount}}\n- Average read speed: {{avgReadSpeed}} articles/day\n- Dismiss rate: {{dismissRate}}%\n- Like rate: {{likeRate}}%\n- Current recommendation pool size: {{recommendationPoolSize}}\n- Recommendation pool capacity: {{recommendationPoolCapacity}}\n\n## System Resources\n- Today's AI tokens used: {{aiTokensUsedToday}} / {{aiTokensBudgetDaily}}\n- Today's cost: ${{aiCostToday}}\n- Articles analyzed today: {{analyzedArticlesToday}}\n- Articles recommended today: {{recommendedArticlesToday}}\n\n## Historical Data (7 days)\n- Total reads: {{last7DaysReadCount}}\n- Total recommendations: {{last7DaysRecommendedCount}}\n- Total analyzed: {{last7DaysAnalyzedCount}}\n\n## User Profile\n- Onboarding complete: {{onboardingComplete}}\n- Page visits: {{pageVisitCount}}\n- Profile confidence: {{profileConfidence}}\n\n---\n\n# Decision Rules\n\n## 1. Backlog Urgency Assessment\n\nCalculate: backlogDays = rawPoolSize / (dailyNewArticles || 1)\n\n- **Normal** (< 1 day): analysisIntervalMinutes = 45-60\n- **Minor backlog** (1-3 days): analysisIntervalMinutes = 30-45\n- **Moderate backlog** (3-7 days): analysisIntervalMinutes = 15-30\n- **Severe backlog** (> 7 days): analysisIntervalMinutes = 5-10\n\n**High-production special rule**: If dailyNewArticles > 100 AND backlogDays > 1.5, escalate urgency by one level.\n\n## 2. Consumption Speed Assessment\n\n- **Slow** (< 2/day): cooldownMinutes = 120-180\n- **Medium** (2-5/day): cooldownMinutes = 60-120\n- **Fast** (5-10/day): cooldownMinutes = 40-60\n- **Very fast** (> 10/day): cooldownMinutes = 30-45\n\n## 3. Quality Threshold Adjustment\n\nCalculate quality index: qualityIndex = (likeRate × 2 + (100 - dismissRate)) / 3\n\nBase threshold:\n- qualityIndex < 40: scoreThreshold = 7.0-7.5\n- qualityIndex 40-55: scoreThreshold = 7.2-7.7\n- qualityIndex 55-70: scoreThreshold = 7.5-8.0\n- qualityIndex > 70: scoreThreshold = 7.8-8.5\n\n**Supply pressure adjustment**: If candidatePoolSize < (avgReadSpeed × 2) AND avgReadSpeed > 8, then scoreThreshold -= 0.3\n\n## 4. Analysis Batch Size\n\n- rawPoolSize < 20: batchSize = 5-10\n- rawPoolSize 20-50: batchSize = 10-15\n- rawPoolSize > 50: batchSize = 15-20\n\n## 5. Recommendation Strategy\n\n- **Target pool size**: targetPoolSize = min(avgReadSpeed × 1.5, 10), range [3, 10]\n- **Refill threshold**: refillThreshold = ceil(targetPoolSize / 3), range [1, 5]\n- **Daily limit**: dailyLimit = ceil(avgReadSpeed × 3), range [5, 30]\n\n## 6. Candidate Pool Management\n\n- **Target capacity**: targetSize = avgReadSpeed × 7, range [10, 100]\n- **Max capacity**: maxSize = targetSize × 2, range [20, 200]\n- **Expiry time**: expiryHours = 168 (7 days), extend to 336 (14 days) if candidate pool < 50% of target\n- **Entry threshold**: entryThreshold = dynamically adjusted based on pool status and feed quality, range [0.5, 0.9]\n  - Pool sufficient (> targetSize × 0.8): raise threshold (0.75-0.9) for selective filtering\n  - Pool insufficient (< targetSize × 0.5): lower threshold (0.6-0.75) to accelerate refill\n  - Pool moderate: maintain standard threshold (0.7-0.8)\n  - Consider: raise bar when overall feed quality is high, relax when quality is low\n\n## 7. Loop Optimization\n\n- **Loop iterations**: loopIterations = min(ceil(rawPoolSize / batchSize), 10), range [1, 10]\n- **Recommend interval**: recommendIntervalMinutes = cooldownMinutes / 2, range [1, 60]\n\n## 8. Strategy Metadata\n\n- **Valid hours**: validHours = 24 (default), extend to 48 if system stable (dismiss rate < 15% AND candidate pool sufficient)\n- **Review hours**: nextReviewHours = validHours / 2\n- **Version**: \"v1.0\"\n\n---\n\n# Output Format\n\nPlease output strictly in the following JSON format (without markdown code block markers):\n\n{\n  \"analysis\": {\n    \"batchSize\": <number>,\n    \"scoreThreshold\": <number>\n  },\n  \"recommendation\": {\n    \"targetPoolSize\": <number>,\n    \"refillThreshold\": <number>,\n    \"dailyLimit\": <number>,\n    \"cooldownMinutes\": <number>\n  },\n  \"scheduling\": {\n    \"analysisIntervalMinutes\": <number>,\n    \"recommendIntervalMinutes\": <number>,\n    \"loopIterations\": <number>\n  },\n  \"candidatePool\": {\n    \"targetSize\": <number>,\n    \"maxSize\": <number>,\n    \"expiryHours\": <number>,\n    \"entryThreshold\": <number>\n  },\n  \"meta\": {\n    \"validHours\": <number>,\n    \"generatedAt\": {{timestamp}},\n    \"version\": \"v1.0\",\n    \"nextReviewHours\": <number>\n  }\n}\n\nPlease generate reasonable strategy parameters based on the above rules and current system state."
  },
  "feedPreScreening": {
    "user": "You are an intelligent content pre-screening assistant. Your task is to batch screen articles from a feed and select those worth detailed AI analysis.\n\n# Feed Information\n- **Title**: {{feedTitle}}\n- **Link**: {{feedLink}}\n\n{{#userProfile}}# User Profile\n- **Interests**: {{interests}}\n- **Preferences**: {{preferences}}\n- **Avoid Topics**: {{avoidTopics}}\n{{/userProfile}}\n\n# Article List\n{{feedArticles}}\n\n# Screening Principles\n\n## Core Rule: Better to over-select than miss\n\nSince this is pre-screening with detailed analysis following, use **lenient standards**:\n- **Keep**: Possibly relevant, potentially valuable, uncertain articles\n- **Remove**: Clearly irrelevant, pure ads, duplicate content, low-quality content\n\n## Specific Criteria\n\n### 1. Content Relevance (if user profile exists)\n{{#userProfile}}- Related to user's interests → Keep\n- High-quality content that may spark new interests → Keep\n- Clearly in avoid topics list → Remove\n- Uncertain relevance → Keep (better to over-select){{/userProfile}}\n{{^userProfile}}- Rich, in-depth technical/design/business articles → Keep\n- Time-sensitive news/information → Keep\n- Tutorials, guides, case studies → Keep{{/userProfile}}\n\n### 2. Quality Signals\n**Keep**:\n- Clear title, detailed description\n- Clear topics and information value\n- From well-known sources or professional blogs\n- Strong originality, unique insights\n\n**Remove**:\n- Clickbait (overly exaggerated, misleading)\n- Pure ads, marketing content\n- Very short content (e.g., single sentence)\n- Duplicate or outdated information\n\n### 3. Special Cases\n- **Technical articles**: Keep even if beyond current interests (expand horizons)\n- **Tutorials/Guides**: Prioritize keeping (high-value content)\n- **News**: Keep if timely, remove if stale\n- **Translations**: Keep if valuable, but lower than original\n\n## Quantity Control\n\n- Single feed ≤ 10 articles: Keep 60-80%\n- Single feed 10-30 articles: Keep 40-60%\n- Single feed > 30 articles: Keep 30-50%\n\n# Output Format (JSON)\n\n{\n  \"selectedArticleLinks\": [\n    \"https://example.com/article1\",\n    \"https://example.com/article2\"\n  ],\n  \"reason\": \"Brief explanation of screening logic (30-50 words)\",\n  \"stats\": {\n    \"totalArticles\": 20,\n    \"selectedCount\": 12,\n    \"selectionRate\": 0.60\n  }\n}\n\nField descriptions:\n- selectedArticleLinks: List of selected article links\n- reason: Screening rationale (what types kept, what removed)\n- stats.totalArticles: Total article count\n- stats.selectedCount: Selected count\n- stats.selectionRate: Selection rate (0-1)\n\nOutput JSON only, no other content."
  }
}