{
  "analyzeContent": {
    "withProfile": {
      "user": "你是一个智能内容分析助手，需要根据用户兴趣分析文章的主题和相关性，并生成精炼摘要。\n\n# 用户画像\n- **兴趣领域**: {{interests}}\n- **内容偏好**: {{preferences}}\n- **避免主题**: {{avoidTopics}}\n\n# 文章内容\n{{content}}\n{{#originalTitle}}\n\n**原文标题**: {{originalTitle}}{{/originalTitle}}\n\n# 分析要求\n1. 识别文章的 3-5 个主要主题\n2. 评估每个主题与用户兴趣的相关性\n3. 给出每个主题的概率（0-1之间，总和为1）\n4. 生成一段不超过 80 字的中文精炼摘要（避免夸张语气，不改变原意）\n5. 避免的主题应该给予更低的概率{{#originalTitle}}\n6. 如果原文标题不是中文，请将其翻译成中文（保持原意，简洁准确）{{/originalTitle}}\n\n# 输出格式（JSON）\n{\n  \"topics\": {\n    \"主题1\": 0.5,\n    \"主题2\": 0.3,\n    \"主题3\": 0.2\n  },\n  \"summary\": \"用 40-80 字概括文章要点的中性摘要\"{{#originalTitle}},\n  \"translatedTitle\": \"翻译后的中文标题（仅当原标题非中文时提供）\"{{/originalTitle}}\n}\n\n只输出 JSON，不要其他内容。"
    },
    "withoutProfile": {
      "user": "分析以下文本的主题分布并生成摘要，输出 JSON。\n\n文本：\n{{content}}\n{{#originalTitle}}\n\n**原文标题**: {{originalTitle}}{{/originalTitle}}\n\n请：\n1. 识别 3-5 个主要主题（如\"技术\"、\"设计\"、\"商业\"等），并给出每个主题的概率（0-1之间，总和为1）\n2. 生成一段不超过 80 字的中性摘要，概括文章要点{{#originalTitle}}\n3. 如果原文标题不是中文，请将其翻译成中文（保持原意，简洁准确）{{/originalTitle}}\n\n输出格式（JSON）：\n{\n  \"topics\": {\n    \"技术\": 0.6,\n    \"API\": 0.3,\n    \"教程\": 0.1\n  },\n  \"summary\": \"用 40-80 字概括文章要点的中性摘要\"{{#originalTitle}},\n  \"translatedTitle\": \"翻译后的中文标题（仅当原标题非中文时提供）\"{{/originalTitle}}\n}\n\n只输出 JSON，不要其他内容。"
    }
  },
  "analyzeContentReasoning": {
    "withProfile": {
      "user": "你是一个智能内容分析助手，需要根据用户兴趣分析文章的主题和相关性。\n\n# 用户画像\n- **兴趣领域**: {{interests}}\n- **内容偏好**: {{preferences}}\n- **避免主题**: {{avoidTopics}}\n\n# 文章内容\n{{content}}\n\n请仔细思考：\n1. 这篇文章的主要主题是什么？\n2. 哪些主题与用户的兴趣相关？\n3. 是否包含用户避免的主题？\n4. 每个主题的重要性如何？\n\n以 JSON 格式返回分析结果，包含主题及其概率（0-1之间的数字，总和为1）。\n避免的主题应该给予更低的概率。\n\n返回格式示例：\n{\n  \"topics\": {\n    \"技术\": 0.7,\n    \"开源\": 0.2,\n    \"教程\": 0.1\n  }\n}\n\n只返回 JSON，不要其他解释。"
    },
    "withoutProfile": {
      "user": "仔细分析以下文本，识别主要主题并评估其重要性。\n\n文本：\n{{content}}\n\n思考步骤：\n1. 文本的核心内容是什么？\n2. 涉及哪些具体主题领域？\n3. 每个主题在文本中的比重如何？\n\n返回 JSON 格式结果，包含主题及其概率（0-1之间，总和为1）。\n\n示例格式：\n{\n  \"topics\": {\n    \"技术\": 0.6,\n    \"开源\": 0.3,\n    \"教程\": 0.1\n  }\n}\n\n只返回 JSON。"
    }
  },
  "generateProfileFull": {
    "user": "你是一个用户兴趣分析专家。基于用户的浏览和阅读行为，生成用户的兴趣画像。\n\n# 用户行为数据\n{{behaviorSummary}}\n\n# 任务要求\n1. 综合分析用户的兴趣领域（50-200字，详细且具体）\n2. 提炼用户的内容偏好（5-10条具体特征）\n3. 从拒绝的文章中识别避免的主题（3-5条关键词）\n4. 确保画像准确、具体、可操作\n\n=== ⚠️ 输出格式要求 ===\n**关键规则**：\n1. **interests 字段必须直接描述，不要加主语**\n   - ✅ 正确示例：\"对技术领域有浓厚兴趣，特别关注开源软件、开发工具...\"\n   - ✅ 正确示例：\"在前端开发领域表现出强烈的学习意愿，经常阅读...\"\n   - ❌ 错误示例：\"用户对技术领域有浓厚兴趣\"\n   - ❌ 错误示例：\"该用户在前端开发...\"\n   - ❌ 错误示例:\"你对技术领域...\"\n   \n2. **preferences 字段**：返回 5-10 个具体的内容类型\n   - 示例：[\"技术深度分析\", \"开源软件实践\", \"产品设计案例\"]\n   \n3. **avoidTopics 字段**：从拒绝的文章中提取避免主题\n   - 如果有拒绝记录，提取 3-5 个避免主题关键词\n   - 如果没有拒绝记录，返回空数组 []\n   - 示例：[\"娱乐八卦\", \"广告营销\", \"低质量内容\"]\n\n# 输出格式（JSON）\n{\n  \"interests\": \"简洁的兴趣领域描述（50-200字，自然语言）\",\n  \"preferences\": [\"偏好1\", \"偏好2\", \"偏好3\"],\n  \"avoidTopics\": [\"避免1\", \"避免2\"]\n}\n\n只输出 JSON，不要其他内容。"
  },
  "generateProfileIncremental": {
    "user": "你是一个用户兴趣分析专家。基于用户的最新行为数据，更新用户的兴趣画像。\n\n# 当前画像\n- **兴趣领域**: {{interests}}\n- **内容偏好**: {{preferences}}\n- **避免主题**: {{avoidTopics}}\n\n# 最新用户行为数据\n{{behaviorSummary}}\n\n# 任务要求\n1. 分析新行为数据与当前画像的一致性\n2. 如果发现新的兴趣点，适当扩展兴趣领域描述\n3. 根据深度阅读的内容，更新或补充内容偏好\n4. **根据拒绝的文章，更新避免主题列表**\n5. 保持画像的连贯性和准确性\n\n=== ⚠️ 输出格式要求 ===\n**关键规则**：\n1. **interests 字段必须直接描述，不要加主语**\n   - ✅ 正确示例：\"对技术领域有浓厚兴趣，特别关注开源软件、开发工具...\"\n   - ✅ 正确示例：\"在前端开发领域表现出强烈的学习意愿，经常阅读...\"\n   - ❌ 错误示例：\"用户对技术领域有浓厚兴趣\"\n   - ❌ 错误示例：\"该用户在前端开发...\"\n   - ❌ 错误示例：\"你对技术领域...\"\n   \n2. **preferences 字段**：返回 5-10 个具体的内容类型\n   - 示例：[\"技术深度分析\", \"开源软件实践\", \"产品设计案例\"]\n   \n3. **avoidTopics 字段**：从拒绝的文章中提取避免主题\n   - 如果有拒绝记录，提取 3-5 个避免主题关键词\n   - 如果没有拒绝记录，返回空数组 []\n   - 示例：[\"娱乐八卦\", \"广告营销\", \"低质量内容\"]\n\n# 输出格式（JSON）\n{\n  \"interests\": \"简洁的兴趣领域描述（50-200字，自然语言）\",\n  \"preferences\": [\"偏好1\", \"偏好2\", \"偏好3\"],\n  \"avoidTopics\": [\"避免1\", \"避免2\"]\n}\n\n只输出 JSON，不要其他内容。"
  },
  "sourceAnalysis": {
    "user": "你是一个订阅源质量分析专家。请基于订阅源的整体内容质量来评估其订阅价值。\n\n# 订阅源信息\n- **名称**: {{feedTitle}}\n- **描述**: {{feedDescription}}\n- **链接**: {{feedLink}}\n\n# 最近发布的文章样本（供分析）\n{{sampleArticles}}\n\n# 评估维度\n1. **内容类别**: 从以下标准类别中选择最匹配的：tech, news, finance, lifestyle, entertainment, education, science, sports, gaming, design, business, health, travel, food, photography, music, art, politics, culture, other\n2. **内容语言**: 根据文章标题和内容判断主要语言，使用标准代码：zh-CN, zh-TW, en, ja, ko, fr, de, es, ru, pt, it, ar, unknown\n3. **原创性** (0-100): 内容的原创程度\n4. **信息密度** (0-100): 有价值内容的占比\n5. **标题党程度** (0-100): 标题是否夸张误导（越低越好）\n6. **垃圾内容程度** (0-100): 广告/营销内容占比（越低越好）\n\n# 输出格式（JSON）\n{\n  \"topics\": {\"主要分类\": 1.0},\n  \"category\": \"tech\",\n  \"language\": \"en\",\n  \"originality\": 80,\n  \"informationDensity\": 75,\n  \"clickbaitScore\": 20,\n  \"spamScore\": 10,\n  \"reasoning\": \"简短分析依据（30字内）\"\n}\n\n字段说明：\n- topics: 主要分类及置信度\n- category: 标准分类 key\n- language: 内容语言代码（必须填写）\n- originality/informationDensity: 越高越好\n- clickbaitScore/spamScore: 越低越好\n\n只输出 JSON，不要其他内容。"
  },
  "strategyDecision": {
    "system": "你是一个智能推荐系统策略决策助手。根据系统当前状态，生成合理的运行参数。\n\n你的输出必须是纯 JSON 格式，不要包含任何 markdown 标记或其他文本。",
    "user": "# 系统状态\n\n## 供给侧\n- 活跃订阅源：{{activeFeeds}} 个\n- 日均新文章：{{dailyNewArticles}} 篇\n- 原料池（未分析）：{{rawPoolSize}} 篇\n- 候选池（高分文章）：{{candidatePoolSize}} 篇\n- 低分文章：{{analyzedNotQualifiedSize}} 篇\n\n## 需求侧\n- 日均阅读：{{dailyReadCount}} 篇\n- 平均阅读速度：{{avgReadSpeed}} 篇/天\n- 拒绝率：{{dismissRate}}%\n- 喜欢率：{{likeRate}}%\n- 推荐池当前大小：{{recommendationPoolSize}} 篇\n- 推荐池容量：{{recommendationPoolCapacity}} 篇\n\n## 系统资源\n- 今日 AI Tokens 使用：{{aiTokensUsedToday}} / {{aiTokensBudgetDaily}}\n- 今日成本：${{aiCostToday}}\n- 今日已分析：{{analyzedArticlesToday}} 篇\n- 今日已推荐：{{recommendedArticlesToday}} 篇\n\n## 历史数据（7天）\n- 总阅读数：{{last7DaysReadCount}} 篇\n- 总推荐数：{{last7DaysRecommendedCount}} 篇\n- 总分析数：{{last7DaysAnalyzedCount}} 篇\n\n## 用户画像\n- 引导完成：{{onboardingComplete}}\n- 页面访问数：{{pageVisitCount}}\n- 画像置信度：{{profileConfidence}}\n\n---\n\n# 决策规则\n\n## 1. 积压紧急度判定\n\n计算：backlogDays = rawPoolSize / (dailyNewArticles || 1)\n\n- **正常**（< 1 天）：analysisIntervalMinutes = 45-60\n- **轻微积压**（1-3 天）：analysisIntervalMinutes = 30-45\n- **中度积压**（3-7 天）：analysisIntervalMinutes = 15-30\n- **严重积压**（> 7 天）：analysisIntervalMinutes = 5-10\n\n**高产特殊规则**：如果 dailyNewArticles > 100 且 backlogDays > 1.5，紧急度提升一级。\n\n## 2. 消费速度判定\n\n- **慢速**（< 2 篇/天）：cooldownMinutes = 120-180\n- **中速**（2-5 篇/天）：cooldownMinutes = 60-120\n- **快速**（5-10 篇/天）：cooldownMinutes = 40-60\n- **超快**（> 10 篇/天）：cooldownMinutes = 30-45\n\n## 3. 质量阈值调整\n\n计算质量指数：qualityIndex = (likeRate × 2 + (100 - dismissRate)) / 3\n\n基准阈值：\n- qualityIndex < 40：scoreThreshold = 7.0-7.5\n- qualityIndex 40-55：scoreThreshold = 7.2-7.7\n- qualityIndex 55-70：scoreThreshold = 7.5-8.0\n- qualityIndex > 70：scoreThreshold = 7.8-8.5\n\n**供给压力调整**：如果 candidatePoolSize < (avgReadSpeed × 2) 且 avgReadSpeed > 8，则 scoreThreshold -= 0.3\n\n## 4. 分析批次大小\n\n- rawPoolSize < 20：batchSize = 5-10\n- rawPoolSize 20-50：batchSize = 10-15\n- rawPoolSize > 50：batchSize = 15-20\n\n## 5. 推荐策略\n\n- **目标池大小**：targetPoolSize = min(avgReadSpeed × 1.5, 10)，范围 [3, 10]\n- **补充阈值**：refillThreshold = ceil(targetPoolSize / 3)，范围 [1, 5]\n- **每日上限**：dailyLimit = ceil(avgReadSpeed × 3)，范围 [5, 30]\n\n## 6. 候选池管理\n\n- **目标容量**：targetSize = avgReadSpeed × 7，范围 [10, 100]\n- **最大容量**：maxSize = targetSize × 2，范围 [20, 200]\n- **过期时间**：expiryHours = 168（7天），如果候选池 < 目标容量的 50%，延长至 336（14天）\n\n## 7. 循环优化\n\n- **循环次数**：loopIterations = min(ceil(rawPoolSize / batchSize), 10)，范围 [1, 10]\n- **推荐间隔**：recommendIntervalMinutes = cooldownMinutes / 2，范围 [1, 60]\n\n## 8. 策略元数据\n\n- **有效期**：validHours = 24（默认），如果系统稳定（拒绝率 < 15% 且候选池充足），延长至 48\n- **复审时间**：nextReviewHours = validHours / 2\n- **版本号**：\"v1.0\"\n\n---\n\n# 输出格式\n\n请严格按照以下 JSON 格式输出（不要包含 markdown 代码块标记）：\n\n{\n  \"analysis\": {\n    \"batchSize\": <number>,\n    \"scoreThreshold\": <number>\n  },\n  \"recommendation\": {\n    \"targetPoolSize\": <number>,\n    \"refillThreshold\": <number>,\n    \"dailyLimit\": <number>,\n    \"cooldownMinutes\": <number>\n  },\n  \"scheduling\": {\n    \"analysisIntervalMinutes\": <number>,\n    \"recommendIntervalMinutes\": <number>,\n    \"loopIterations\": <number>\n  },\n  \"candidatePool\": {\n    \"targetSize\": <number>,\n    \"maxSize\": <number>,\n    \"expiryHours\": <number>\n  },\n  \"meta\": {\n    \"validHours\": <number>,\n    \"generatedAt\": {{timestamp}},\n    \"version\": \"v1.0\",\n    \"nextReviewHours\": <number>\n  }\n}\n\n请根据上述规则和当前系统状态，生成合理的策略参数。\n\n# 系统说明\n\n推荐系统有两个独立机制：\n1. **推荐任务调度**：由系统自动控制，根据待推荐文章数动态调整（1-20分钟），你无需决策\n2. **推荐池补充策略**：你需要决策的是推荐池的容量和补充限流规则\n\n# 用户情况\n\n## 订阅源\n- 总数：{{feedCount}} 个\n- 活跃源：{{activeFeeds}} 个（最近7天有更新）\n- 总体更新速率：每 {{avgUpdateFrequency}} 小时产生 1 篇新文章（所有源合计）\n- 平均批量大小：每个源平均 {{avgBatchSize}} 篇\n\n## 文章量\n- 未读文章：{{unreadCount}} 篇\n- 最近7天日均：{{dailyAverage}} 篇\n- 昨天新增：{{yesterdayCount}} 篇\n\n## 用户行为（昨天）\n- 查看推荐：{{recommendationsShown}} 次\n- 点击阅读：{{clicked}} 次\n- 不想读：{{dismissed}} 次\n- 稍后阅读：{{saved}} 次\n- 平均阅读时长：{{avgReadTime}} 秒\n- 活跃时段：{{peakUsageHour}}:00\n\n## 当前策略\n- 推荐池容量：{{currentPoolSize}} 条\n- 补充冷却期：{{currentRefillInterval}} 分钟\n- 每日补充次数上限：{{currentMaxDailyRefills}} 次\n\n# 决策要求\n\n请决策推荐池的容量和补充限流规则：\n\n1. **poolSize**（推荐池容量）：3-20 条\n   - 含义：数据库中预存的推荐总数，弹窗每次显示其中一部分\n   - 考虑因素：用户消费速度、文章产出速度\n   - 原则：快速消费用户需要更大的池；慢速消费用户池可以小一些\n   \n2. **refillInterval**（补充冷却期）：15-120 分钟\n   - 含义：两次推荐池补充之间必须间隔的最短时间（防抖/限流）\n   - 考虑因素：文章产出速度、避免频繁 AI 调用\n   - 原则：高频更新源（如每小时多篇）→ 15-30分钟；低频更新源 → 60-120分钟\n   - 注意：这不是推荐任务的执行频率！推荐任务由系统自动调度（1-20分钟）\n   \n3. **maxDailyRefills**（每日补充次数上限）：3-10 次\n   - 含义：一天内最多允许补充推荐池的次数\n   - 考虑因素：用户活跃度、文章量、AI 成本控制\n   - 原则：活跃用户、高频更新 → 7-10次；轻度用户 → 3-5次\n   \n4. **triggerThreshold**（补充触发阈值）：0.2-0.5\n   - 含义：池容量低于此百分比时才触发补充（例如 0.3 表示池中剩余 < 30% 时触发）\n   - 考虑因素：平衡响应速度与频繁补充\n   - 原则：快速消费用户 → 0.3-0.4（提前补充）；慢速消费 → 0.2-0.3（节省 AI 成本）\n\n# 决策原则\n\n**基于用户类型**：\n- 轻度用户（<30篇/天）：小池容量（4-6条），长冷却期（60-90分钟），少补充次数（3-4次）\n- 中度用户（30-200篇/天）：中等池容量（6-10条），中等冷却期（30-60分钟），中等补充次数（5-7次）\n- 重度用户（>200篇/天）：大池容量（10-15条），短冷却期（15-30分钟），多补充次数（7-10次）\n\n**基于推荐质量反馈**：\n- 高点击率（>30%）且低拒绝率（<30%）：可适当增加池容量和补充次数\n- 低点击率（<20%）或高拒绝率（>50%）：减少池容量和补充次数，避免信息过载\n- 平均阅读时长接近0：推荐质量可能不佳，应保守设置\n\n**基于更新频率**：\n- 高频更新（如每0.5小时1篇）：短冷却期（15-30分钟），确保内容新鲜\n- 低频更新（如每6小时1篇）：长冷却期（60-120分钟），避免无效补充\n\n# 输出格式（JSON）\n\n{\n  \"poolSize\": 8,\n  \"refillInterval\": 45,\n  \"maxDailyRefills\": 6,\n  \"triggerThreshold\": 0.3,\n  \"reasoning\": \"用户是中度用户（日均96篇），但点击率18.75%、拒绝率37.5%、阅读时长0秒表明推荐质量不佳。建议适中池容量8条（避免过载），冷却期45分钟（匹配0.3小时/篇的更新速率），每日补充6次（覆盖活跃时段），触发阈值0.3（平衡响应与效率）。\",\n  \"confidence\": 0.85\n}\n\n字段说明：\n- poolSize: 3-20 之间的整数（推荐池总容量）\n- refillInterval: 15-120 之间的整数（补充冷却期，分钟）\n- maxDailyRefills: 3-10 之间的整数（每日补充次数上限）\n- triggerThreshold: 0.2-0.5 之间的小数（触发补充的容量阈值）\n- reasoning: 决策理由（100-150字，说明各参数如何匹配用户情况）\n- confidence: 决策置信度（0-1之间）\n\n只输出 JSON，不要其他内容。"
  },
  "feedPreScreening": {
    "user": "你是一个智能内容初筛助手。你的任务是从Feed中批量筛选出值得进行详细AI分析的文章。\n\n# 订阅源信息\n- **名称**: {{feedTitle}}\n- **链接**: {{feedLink}}\n\n{{#userProfile}}# 用户画像\n- **兴趣领域**: {{interests}}\n- **内容偏好**: {{preferences}}\n- **避免主题**: {{avoidTopics}}\n{{/userProfile}}\n\n# 文章列表\n{{feedArticles}}\n\n# 筛选原则\n\n## 核心规则：宁可多选不要漏选\n\n由于这是初筛，后续还会有详细分析，因此应该采用**宽松标准**：\n- **保留**：可能相关、有潜在价值、不确定的文章\n- **剔除**：明显无关、纯广告、重复内容、低质量内容\n\n## 具体筛选标准\n\n### 1. 内容相关性（如果有用户画像）\n{{#userProfile}}- 与用户兴趣领域相关或相近的主题 → 保留\n- 可能激发新兴趣的高质量内容 → 保留\n- 明确在避免主题列表中的 → 剔除\n- 不确定是否相关的 → 保留（宁可多选）{{/userProfile}}\n{{^userProfile}}- 内容丰富、有深度的技术、设计、商业类文章 → 保留\n- 时效性强的新闻、资讯 → 保留\n- 教程、指南、案例分析类 → 保留{{/userProfile}}\n\n### 2. 质量信号\n**保留**：\n- 标题清晰、描述详细\n- 有明确的主题和信息价值\n- 来自知名来源或专业博客\n- 原创性强、有独特见解\n\n**剔除**：\n- 标题党（过度夸张、误导性强）\n- 纯广告、营销内容\n- 极短的内容（如仅一句话）\n- 重复或过时的信息\n\n### 3. 特殊情况处理\n- **技术文章**：即使超出用户当前兴趣，也可保留（扩展视野）\n- **教程/指南**：优先保留（高价值内容）\n- **新闻资讯**：时效性强的保留，陈旧的剔除\n- **翻译/转载**：有价值的保留，但低于原创\n\n## 数量控制\n\n- 单个Feed文章 ≤ 10篇：保留 60-80%\n- 单个Feed文章 10-30篇：保留 40-60%\n- 单个Feed文章 > 30篇：保留 30-50%\n\n# 输出格式（JSON）\n\n{\n  \"selectedArticleLinks\": [\n    \"https://example.com/article1\",\n    \"https://example.com/article2\"\n  ],\n  \"reason\": \"简短说明筛选逻辑（30-50字）\",\n  \"stats\": {\n    \"totalArticles\": 20,\n    \"selectedCount\": 12,\n    \"selectionRate\": 0.60\n  }\n}\n\n字段说明：\n- selectedArticleLinks: 筛选通过的文章链接列表\n- reason: 筛选理由（说明主要保留了什么类型的文章，剔除了什么）\n- stats.totalArticles: 总文章数\n- stats.selectedCount: 筛选通过数\n- stats.selectionRate: 筛选率（0-1之间）\n\n只输出 JSON，不要其他内容。"
  }
}
