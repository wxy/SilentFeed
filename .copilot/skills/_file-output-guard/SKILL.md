---
name: _file-output-guard
description: 创建/输出文件的安全约束。禁止 HERE 文档创建文件；大文件输出需分段写入同一文件，避免会话超限。
---

# _file-output-guard

## 目标
- **创建文件**必须使用 `create_file` 工具，禁止 HERE 文档。
- **大文件输出**必须分段写入同一文件，避免会话输出过大导致失败。

## 适用范围
- 任何创建新文件的操作。
- 任何可能产生超长输出的内容（例如生成长文档、大型配置、长列表等）。

## 必须遵循的规则
### 1) 创建文件规则
- **必须**使用 `create_file` 创建新文件。
- **禁止**使用 HERE 文档（如 `cat > file << 'EOF'`）。
- **禁止**用终端命令创建内容文件（除非用户明确要求）。

### 2) 大文件分段写入规则
当内容可能超出单次回复或工具限制时：
1. **先创建文件**（第一段内容）使用 `create_file`。
2. **后续内容分段追加**：使用 `apply_patch` 将新段落追加到同一文件末尾。
3. **每段写入后**提供简短确认，不在聊天中重复输出大段正文。

### 3) 分段写入操作示例
**首次创建**：
```typescript
create_file({
  filePath: "/path/to/file.md",
  content: "第一段内容..."
})
```

**后续追加**（示意）：
```diff
*** Update File: /path/to/file.md
@@
 既有末尾内容
+第二段内容...
+第三段内容...
```

## 检查清单
- [ ] 新文件是否通过 `create_file` 创建？
- [ ] 是否避免使用 HERE 文档？
- [ ] 大文件是否分段输出并持续写入同一文件？
- [ ] 是否避免在聊天中重复输出大段内容？

## 与其他技能的关系
- 与 `_context-ack` 配合：在“已启用技能”中标注该约束已生效。
- 与 `_instruction-guard` 配合：在读取指令后执行文件输出约束。
