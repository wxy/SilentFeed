# åˆ†æ”¯è¦†ç›–ç‡æå‡æŒ‡å—

## ğŸ“Š å½“å‰çŠ¶æ€

- **åˆ†æ”¯è¦†ç›–ç‡**: 60.66% (2619/4317) âš ï¸
- **è¡Œè¦†ç›–ç‡**: 71.72% âœ…
- **å‡½æ•°è¦†ç›–ç‡**: 72.51% âœ…
- **è¯­å¥è¦†ç›–ç‡**: 70.72% âœ…

**é—®é¢˜**: åˆ†æ”¯è¦†ç›–ç‡æ˜¯å››é¡¹æŒ‡æ ‡ä¸­æœ€ä½çš„ï¼Œéœ€è¦é‡ç‚¹æå‡ã€‚

## ğŸ¯ ç›®æ ‡

- **çŸ­æœŸç›®æ ‡**: åˆ†æ”¯è¦†ç›–ç‡æå‡è‡³ **65%+**
- **ä¸­æœŸç›®æ ‡**: åˆ†æ”¯è¦†ç›–ç‡æå‡è‡³ **70%+**ï¼ˆä¸è¡Œè¦†ç›–ç‡æŒå¹³ï¼‰
- **é•¿æœŸç›®æ ‡**: åˆ†æ”¯è¦†ç›–ç‡æå‡è‡³ **75%+**

## ğŸ” ä½åˆ†æ”¯è¦†ç›–ç‡æ–‡ä»¶åˆ†æ

æ ¹æ®æµ‹è¯•æŠ¥å‘Šï¼Œä»¥ä¸‹æ–‡ä»¶çš„åˆ†æ”¯è¦†ç›–ç‡è¾ƒä½ï¼ˆ<50%ï¼‰ï¼š

### ğŸš¨ P0 - ä¸¥é‡ä¸è¶³ï¼ˆåˆ†æ”¯è¦†ç›–ç‡ < 30%ï¼‰

1. **`src/components/RecommendationView.tsx`** (23.45%)
   - ç»„ä»¶ï¼šæ¨èåˆ—è¡¨è§†å›¾
   - é—®é¢˜ï¼šå¤§é‡æ¡ä»¶æ¸²æŸ“åˆ†æ”¯æœªæµ‹è¯•
   - ä¼˜å…ˆçº§ï¼šâ­â­â­â­â­

2. **`src/components/settings/AIConfig.tsx`** (23.66%)
   - ç»„ä»¶ï¼šAI é…ç½®é¢æ¿
   - é—®é¢˜ï¼šå¤šç§ AI æä¾›å•†åˆ‡æ¢ã€è¡¨å•éªŒè¯åˆ†æ”¯æœªè¦†ç›–
   - ä¼˜å…ˆçº§ï¼šâ­â­â­â­â­

3. **`src/components/settings/RecommendationStats.tsx`** (6.87%)
   - ç»„ä»¶ï¼šæ¨èç»Ÿè®¡
   - é—®é¢˜ï¼šå‡ ä¹å®Œå…¨æœªæµ‹è¯•
   - ä¼˜å…ˆçº§ï¼šâ­â­â­â­â­

4. **`src/core/recommender/NotificationService.ts`** (27.55%)
   - åŠŸèƒ½ï¼šæ¨èé€šçŸ¥æœåŠ¡
   - é—®é¢˜ï¼šé€šçŸ¥æƒé™ã€é™é»˜æ—¶æ®µç­‰åˆ†æ”¯æœªæµ‹è¯•
   - ä¼˜å…ˆçº§ï¼šâ­â­â­â­

5. **`src/storage/db/index.ts`** (0%)
   - åŠŸèƒ½ï¼šæ•°æ®åº“ç´¢å¼•å¯¼å‡º
   - é—®é¢˜ï¼šå®Œå…¨æœªæµ‹è¯•
   - ä¼˜å…ˆçº§ï¼šâ­â­â­

### âš ï¸ P1 - éœ€è¦æ”¹è¿›ï¼ˆåˆ†æ”¯è¦†ç›–ç‡ 30-50%ï¼‰

6. **`src/components/settings/AIEngineAssignment.tsx`** (43.62%)
   - ç»„ä»¶ï¼šAI å¼•æ“åˆ†é…
   - é—®é¢˜ï¼šä¸åŒä»»åŠ¡ç±»å‹çš„å¼•æ“é€‰æ‹©åˆ†æ”¯

7. **`src/components/OnboardingView.tsx`** (39.2%)
   - ç»„ä»¶ï¼šå¼•å¯¼é¡µ
   - é—®é¢˜ï¼šå¤šæ­¥éª¤æµç¨‹çš„åˆ†æ”¯

8. **`src/core/ai/AICapabilityManager.ts`** (40.14%)
   - åŠŸèƒ½ï¼šAI èƒ½åŠ›ç®¡ç†
   - é—®é¢˜ï¼šå¤šæä¾›å•†èƒ½åŠ›æ£€æµ‹åˆ†æ”¯

9. **`src/core/recommender/pipeline.ts`** (49.35%)
   - åŠŸèƒ½ï¼šæ¨èç®¡é“
   - é—®é¢˜ï¼šå¤šé˜¶æ®µç­›é€‰é€»è¾‘åˆ†æ”¯

10. **`src/storage/db/db-stats.ts`** (36.84%)
    - åŠŸèƒ½ï¼šç»Ÿè®¡æ•°æ®å­˜å‚¨
    - é—®é¢˜ï¼šèšåˆæŸ¥è¯¢çš„å¤šç§æ¡ä»¶åˆ†æ”¯

## ğŸ’¡ æå‡ç­–ç•¥

### 1. ç»„ä»¶æµ‹è¯•ç­–ç•¥

#### âœ… è¦†ç›–æ¡ä»¶æ¸²æŸ“åˆ†æ”¯

```typescript
// âŒ å½“å‰æµ‹è¯•åªæµ‹äº†ä¸€ç§çŠ¶æ€
test('renders loading state', () => {
  render(<RecommendationView loading={true} />)
  expect(screen.getByText('Loading...')).toBeInTheDocument()
})

// âœ… åº”è¯¥æµ‹è¯•æ‰€æœ‰æ¡ä»¶åˆ†æ”¯
describe('RecommendationView', () => {
  test('renders loading state', () => {
    render(<RecommendationView loading={true} />)
    expect(screen.getByText('Loading...')).toBeInTheDocument()
  })

  test('renders empty state when no recommendations', () => {
    render(<RecommendationView loading={false} recommendations={[]} />)
    expect(screen.getByText('No recommendations')).toBeInTheDocument()
  })

  test('renders recommendations list', () => {
    const mockData = [...]
    render(<RecommendationView loading={false} recommendations={mockData} />)
    expect(screen.getAllByRole('article')).toHaveLength(mockData.length)
  })

  test('renders error state', () => {
    render(<RecommendationView error="Network error" />)
    expect(screen.getByText(/Network error/i)).toBeInTheDocument()
  })
})
```

#### âœ… è¦†ç›–ç”¨æˆ·äº¤äº’åˆ†æ”¯

```typescript
// âŒ åªæµ‹äº†ç‚¹å‡»æŒ‰é’®
test('handles click', async () => {
  render(<Component />)
  await userEvent.click(screen.getByRole('button'))
})

// âœ… æµ‹è¯•æ‰€æœ‰äº¤äº’è·¯å¾„
describe('User interactions', () => {
  test('handles successful submission', async () => {
    // æ­£å¸¸æµç¨‹
  })

  test('handles validation errors', async () => {
    // éªŒè¯å¤±è´¥åˆ†æ”¯
  })

  test('handles network errors', async () => {
    // ç½‘ç»œé”™è¯¯åˆ†æ”¯
  })

  test('handles empty input', async () => {
    // ç©ºè¾“å…¥åˆ†æ”¯
  })
})
```

### 2. ä¸šåŠ¡é€»è¾‘æµ‹è¯•ç­–ç•¥

#### âœ… è¦†ç›–è¾¹ç•Œæ¡ä»¶

```typescript
describe('NotificationService', () => {
  test('should not notify during quiet hours', async () => {
    const quietStart = 22
    const quietEnd = 8
    const currentHour = 23
    
    const service = new NotificationService({ quietStart, quietEnd })
    const result = await service.notify(mockRecommendation, currentHour)
    
    expect(result.sent).toBe(false)
    expect(result.reason).toBe('quiet_hours')
  })

  test('should notify outside quiet hours', async () => {
    const quietStart = 22
    const quietEnd = 8
    const currentHour = 10
    
    const service = new NotificationService({ quietStart, quietEnd })
    const result = await service.notify(mockRecommendation, currentHour)
    
    expect(result.sent).toBe(true)
  })

  test('should handle permission denied', async () => {
    // Mock permission denied
    global.Notification = { permission: 'denied' } as any
    
    const service = new NotificationService()
    const result = await service.notify(mockRecommendation)
    
    expect(result.sent).toBe(false)
    expect(result.reason).toBe('permission_denied')
  })
})
```

#### âœ… è¦†ç›–å¼‚å¸¸å¤„ç†åˆ†æ”¯

```typescript
describe('Error handling branches', () => {
  test('handles database connection failure', async () => {
    const mockDB = {
      getAll: vi.fn().mockRejectedValue(new Error('DB offline'))
    }
    
    const result = await service.fetchData(mockDB)
    
    expect(result.success).toBe(false)
    expect(result.error).toMatch(/DB offline/)
  })

  test('handles invalid data format', async () => {
    const invalidData = { malformed: 'data' }
    
    const result = await service.process(invalidData)
    
    expect(result.success).toBe(false)
    expect(result.error).toMatch(/Invalid format/)
  })
})
```

### 3. å¤šè·¯å¾„æµ‹è¯•ç­–ç•¥

#### âœ… ä½¿ç”¨æµ‹è¯•ç”¨ä¾‹è¡¨æ ¼

```typescript
describe.each([
  // [è¾“å…¥, é¢„æœŸè¾“å‡º, æè¿°]
  [null, false, 'null input'],
  [undefined, false, 'undefined input'],
  ['', false, 'empty string'],
  ['valid', true, 'valid input'],
  ['  spaces  ', true, 'trimmed input'],
])('Validator branches: %s', (input, expected, description) => {
  test(description, () => {
    expect(validator(input)).toBe(expected)
  })
})
```

#### âœ… å‚æ•°åŒ–æµ‹è¯•

```typescript
const testCases = [
  { provider: 'openai', hasKey: true, expected: 'available' },
  { provider: 'openai', hasKey: false, expected: 'not_configured' },
  { provider: 'ollama', hasKey: false, expected: 'checking' },
  { provider: 'chrome-ai', hasKey: false, expected: 'checking' },
]

testCases.forEach(({ provider, hasKey, expected }) => {
  test(`${provider} with ${hasKey ? '' : 'no '}key -> ${expected}`, () => {
    const result = checkProviderStatus(provider, hasKey)
    expect(result.status).toBe(expected)
  })
})
```

## ğŸ“‹ ä¼˜å…ˆæ”¹è¿›æ¸…å•

### Week 1: P0 æ–‡ä»¶ï¼ˆç›®æ ‡ï¼šåˆ†æ”¯è¦†ç›–ç‡ > 50%ï¼‰

- [ ] `RecommendationView.tsx` (23.45% â†’ 60%+)
  - [ ] æ·»åŠ åŠ è½½ã€ç©ºæ•°æ®ã€é”™è¯¯çŠ¶æ€æµ‹è¯•
  - [ ] æ·»åŠ æ¨èå¡ç‰‡äº¤äº’æµ‹è¯•ï¼ˆä¸æƒ³è¯»ã€ç¨åè¯»ï¼‰
  - [ ] æ·»åŠ ç¿»è¯‘å¼€å…³æµ‹è¯•

- [ ] `AIConfig.tsx` (23.66% â†’ 60%+)
  - [ ] æµ‹è¯•æ‰€æœ‰æä¾›å•†åˆ‡æ¢åˆ†æ”¯ï¼ˆOpenAIã€DeepSeekã€Ollamaï¼‰
  - [ ] æµ‹è¯• API Key éªŒè¯åˆ†æ”¯
  - [ ] æµ‹è¯•è¿æ¥æµ‹è¯•æˆåŠŸ/å¤±è´¥åˆ†æ”¯
  - [ ] æµ‹è¯•æ¨¡å‹é€‰æ‹©åˆ†æ”¯

- [ ] `RecommendationStats.tsx` (6.87% â†’ 60%+)
  - [ ] æ·»åŠ æ•°æ®åŠ è½½æµ‹è¯•
  - [ ] æ·»åŠ å›¾è¡¨æ¸²æŸ“æµ‹è¯•
  - [ ] æ·»åŠ ç©ºæ•°æ®å±•ç¤ºæµ‹è¯•

### Week 2: P1 æ–‡ä»¶ï¼ˆç›®æ ‡ï¼šåˆ†æ”¯è¦†ç›–ç‡ > 65%ï¼‰

- [ ] `NotificationService.ts` (27.55% â†’ 70%+)
  - [ ] æ·»åŠ é™é»˜æ—¶æ®µæµ‹è¯•
  - [ ] æ·»åŠ æƒé™æ£€æŸ¥æµ‹è¯•
  - [ ] æ·»åŠ é€šçŸ¥é¢‘ç‡é™åˆ¶æµ‹è¯•

- [ ] `pipeline.ts` (49.35% â†’ 70%+)
  - [ ] æµ‹è¯•æ‰€æœ‰ç­›é€‰é˜¶æ®µ
  - [ ] æµ‹è¯•é”™è¯¯æ¢å¤åˆ†æ”¯
  - [ ] æµ‹è¯•ç©ºæ•°æ®æµåˆ†æ”¯

### Week 3: å…¶ä»–ä½è¦†ç›–ç‡æ–‡ä»¶

- [ ] `db/index.ts` (0% â†’ 80%+)
- [ ] `i18n/language-backend.ts` (43.75% â†’ 70%+)
- [ ] `OnboardingView.tsx` (39.2% â†’ 65%+)

## ğŸ› ï¸ å®ç”¨å·¥å…·

### 1. æŸ¥çœ‹åˆ†æ”¯è¦†ç›–ç‡è¯¦æƒ…

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
open coverage/lcov-report/index.html

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„æœªè¦†ç›–åˆ†æ”¯
open coverage/lcov-report/src/components/RecommendationView.tsx.html
```

### 2. è¯†åˆ«æœªè¦†ç›–çš„åˆ†æ”¯

åœ¨è¦†ç›–ç‡ HTML æŠ¥å‘Šä¸­ï¼š
- ğŸŸ¢ ç»¿è‰²é«˜äº®ï¼šå·²è¦†ç›–
- ğŸŸ¡ é»„è‰²é«˜äº®ï¼šéƒ¨åˆ†è¦†ç›–ï¼ˆif/else åªæµ‹äº†ä¸€ä¸ªåˆ†æ”¯ï¼‰
- ğŸ”´ çº¢è‰²é«˜äº®ï¼šå®Œå…¨æœªè¦†ç›–

### 3. è¿è¡Œç‰¹å®šæ–‡ä»¶æµ‹è¯•

```bash
# åªè¿è¡Œç‰¹å®šæ–‡ä»¶çš„æµ‹è¯•
npm test -- RecommendationView.test.tsx

# æŸ¥çœ‹è¯¥æ–‡ä»¶çš„è¦†ç›–ç‡
npm run test:coverage -- RecommendationView.test.tsx
```

## ğŸ“ˆ ç›‘æ§è¿›åº¦

### è®¾ç½®è¦†ç›–ç‡é˜ˆå€¼

åœ¨ `vitest.config.ts` ä¸­ï¼š

```typescript
export default defineConfig({
  test: {
    coverage: {
      statements: 70,
      branches: 65,  // å½“å‰ç›®æ ‡
      functions: 70,
      lines: 70,
      
      // ä¸‹ä¸€é˜¶æ®µç›®æ ‡
      // branches: 70,
    }
  }
})
```

### CI/CD é›†æˆ

ç¡®ä¿ `pre-push` æ£€æŸ¥åŒ…å«åˆ†æ”¯è¦†ç›–ç‡ï¼š

```bash
# scripts/pre-push-check.sh
npm run test:coverage
# å¦‚æœåˆ†æ”¯è¦†ç›–ç‡ < 65%ï¼Œåˆ™å¤±è´¥
```

## ğŸ“ æœ€ä½³å®è·µ

1. **ä¼˜å…ˆæµ‹è¯•ä¸šåŠ¡å…³é”®è·¯å¾„**
   - æ¨èç”Ÿæˆé€»è¾‘
   - AI é…ç½®ä¸è°ƒç”¨
   - æ•°æ®æŒä¹…åŒ–

2. **ä½¿ç”¨è¦†ç›–ç‡æŠ¥å‘Šå®šä½ç›²ç‚¹**
   - æ¯å‘¨æŸ¥çœ‹ HTML æŠ¥å‘Š
   - ä¸“æ³¨äºé»„è‰²/çº¢è‰²é«˜äº®åŒºåŸŸ

3. **ç¼–å†™å¯æµ‹è¯•çš„ä»£ç **
   - å‡å°‘åµŒå¥—æ¡ä»¶
   - æå–å¤æ‚é€»è¾‘åˆ°çº¯å‡½æ•°
   - ä½¿ç”¨ä¾èµ–æ³¨å…¥ä¾¿äº mock

4. **å¢é‡æ”¹è¿›**
   - æ¯æ¬¡ PR è‡³å°‘æå‡ 1% åˆ†æ”¯è¦†ç›–ç‡
   - æ–°ä»£ç å¿…é¡»æœ‰ 70%+ åˆ†æ”¯è¦†ç›–ç‡

## ğŸ“š å‚è€ƒèµ„æº

- [Vitest Coverage æ–‡æ¡£](https://vitest.dev/guide/coverage.html)
- [React Testing Library - æ¡ä»¶æ¸²æŸ“æµ‹è¯•](https://testing-library.com/docs/react-testing-library/example-intro)
- [Testing JavaScript - Kent C. Dodds](https://testingjavascript.com/)
