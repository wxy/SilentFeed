# FeedAIMuter 渐进式开发计划

## 开发理念

**每一步都可见、可测、可用**

- ✅ 每个功能都有明确的验收标准
- ✅ 每个功能都可以在浏览器中直接体验
- ✅ 每个功能都有配套的测试
- ✅ 每个功能完成后更新文档

---

## 阶段 0: 基础框架 ✅ (已完成)

### 目标
建立项目基础和测试体系

### 已完成
- ✅ 项目初始化 (Plasmo + React + TypeScript)
- ✅ 测试体系 (Vitest + Testing Library)
- ✅ 开发规范 (copilot-instructions)
- ✅ 文档体系 (PRD, TDD, TESTING)
- ✅ 扩展可以构建和加载

### 验收标准
- ✅ `npm run build` 成功
- ✅ `npm test` 全部通过
- ✅ 可在 Chrome 中加载扩展

---

## 阶段 1: Hello World 扩展 ✅ (已完成)

### 目标
让用户能看到一个有基本 UI 的扩展

### 功能列表

#### 1.1 创建 Popup 界面 ✅ (已完成)
**文件**: `src/popup.tsx`

**功能**:
- 显示扩展名称和图标
- 显示欢迎消息
- 显示当前状态 (未初始化)
- 显示初始化进度 0/1000

**验收标准**:
- ✅ 点击扩展图标后弹出界面
- ✅ 界面显示 "Feed AI Muter" 标题
- ✅ 显示 🌱 图标和 "0/1000 页" 文字
- ✅ 界面自适应明暗主题
- ✅ 有测试覆盖（100%）

**实际实现**:
- ✅ 产品简称：RSS 静音器
- ✅ 大号图标（text-8xl）带脉动动画
- ✅ 进度条在下方，清晰可见
- ✅ 完整测试（21个测试用例）
- ✅ PR: #待创建

#### 1.1.5 国际化支持 ✅ (已完成)
**文件**: `src/i18n/*`, `scripts/translate.js`

**功能**:
- 使用 react-i18next 实现国际化
- 支持简体中文和英文
- 使用 _() 函数包裹用户可见文本
- 自动翻译脚本（DeepSeek API）
- 翻译跟踪系统

**验收标准**:
- ✅ 支持中英文切换
- ✅ 自动检测用户语言
- ✅ 提取脚本可用
- ✅ 翻译脚本可用
- ✅ 现有界面完全翻译
- ✅ 开发日志保持中文，用户消息国际化

**用户体验**:
```
┌─────────────────────────────┐
│  🌱 FeedAIMuter              │
├─────────────────────────────┤
│  欢迎使用智能 RSS 阅读器      │
│                              │
│  ╔═══════════════════════╗   │
│  ║ ░░░░░░░░░░░░░░░░░░░░░ ║ 0/1000 │
│  ╚═══════════════════════╝   │
│                              │
│  📖 开始浏览，我会学习你的    │
│     兴趣...                   │
│                              │
│  [设置]                       │
└─────────────────────────────┘
```

#### 1.2 创建设置页面 ✅ (已完成)
**文件**: `src/options.tsx`

**功能**:
- ✅ 语言选择下拉列表（跟随浏览器/中文/英文）
- ✅ 标签页布局（常规、RSS 源管理、AI、数据与隐私）
- ✅ 使用主题样式，自适应明暗主题
- ✅ 预留设置分区，显示禁用状态

**验收标准**:
- ✅ Popup 点击设置可跳转
- ✅ 语言选择下拉框正常工作
- ✅ 标签切换流畅，激活状态明显
- ✅ 自适应明暗主题
- ✅ 预留四个设置分区
- ✅ 测试覆盖率达标（21 个测试）

**设计规格**:
```
┌─────────────────────────────────────────────────┐
│  Feed AI Muter - 设置                             │
├─────────────┬───────────────────────────────────┤
│  ⚙️ 常规    │  常规设置                          │
│  📡 RSS 源  │  选择界面显示语言                   │
│  🤖 AI      │                                    │
│  🔒 隐私    │  语言: [下拉选择 ▼]                │
│             │                                    │
│             │                                    │
│             │                                    │
└─────────────┴───────────────────────────────────┘
```

#### 1.3 徽章进度系统 ✅ (已完成)
**文件**: `src/background.ts`

**功能**:
- 使用 Chrome Badge API 在图标上显示进度
- 徽章文本使用不同阶段的 emoji 代表进度
  - 🌱 (0-250 页): 探索者
  - 🌿 (251-600 页): 学习者
  - 🌳 (601-1000 页): 成长者
  - 🌲 (1000+ 页): 大师
- 暂时使用默认图标（未来可自定义）

**验收标准**:
- ✅ 扩展图标上显示徽章文本（emoji）
- ✅ 徽章随页面计数自动更新
- ✅ 不同阶段使用不同的 emoji
- ✅ 有测试覆盖

**实际实现**:
- ✅ Badge 文本设置函数
- ✅ 进度阶段计算逻辑
- ✅ 与 popup 进度同步
- ✅ PR: #待创建

### 本阶段完成总结

**Phase 1: Hello World 扩展** 已全部完成！🎉

完成的功能：
- ✅ Popup 界面（进度展示、欢迎消息）
- ✅ 国际化支持（中英双语）
- ✅ 设置页面（标签页布局、语言切换）
- ✅ 徽章系统（进度可视化）

技术指标：
- 测试覆盖率: > 70%
- 国际化覆盖: 100%
- 构建成功率: 100%

版本发布：
- **v0.1.0** - Phase 1 MVP Release
  - 基础 UI 框架
  - 国际化支持
  - 设置页面
  - 进度徽章系统

### 下一步
进入 **阶段 2: 页面访问监听**，开始收集用户浏览数据

---

## 阶段 2: 页面访问监听 🎯 (当前)

**预计时间**: 3-4 小时

### 目标
建立页面访问数据收集系统，为用户画像构建准备数据基础

### 功能列表

#### 2.1 Content Script 监听系统 ✅ (已完成)
**文件**: `src/contents/page-tracker.ts`

**功能**:
- 自动注入到所有 HTTP/HTTPS 页面
- 使用 DwellTimeCalculator 计算停留时间
- 监听用户交互（scroll, click, keypress, mousemove）
- 达到 30 秒阈值后保存到 confirmedVisits 表
- 提供详细的调试日志用于浏览器测试

**验收标准**:
- ✅ 访问网页时自动注入 Content Script
- ✅ 正确计算有效停留时间（激活 + 交互）
- ✅ 30 秒无交互停止计时
- ✅ 达到 30 秒阈值后保存到数据库
- ✅ 避免重复记录
- ✅ 有完整测试覆盖（99/99 测试通过）

**实际实现**:
- ✅ PageTracker Content Script（276 行）
- ✅ 集成 DwellTimeCalculator
- ✅ 保存到 confirmedVisits 表
- ✅ 详细日志系统（🚀 🔍 🎯 💾 ✅）
- ✅ 处理页面卸载
- ✅ 通知 background 更新徽章
- ✅ PR: #待创建

#### 2.2 DwellTimeCalculator（停留时间计算器）✅ (已完成)
**文件**: `src/core/tracker/DwellTimeCalculator.ts`

**功能**:
- 页面激活状态监听（visibilitychange）
- 用户交互检测（scroll, click, keypress, mousemove）
- 智能停留时间计算（激活 + 交互）
- 30 秒交互超时机制

**验收标准**:
- ✅ 正确计算有效停留时间
- ✅ 页面失活时停止计时
- ✅ 30 秒无交互停止计时
- ✅ 新交互后恢复计时
- ✅ 有完整测试覆盖（26 个单元测试）

**实际实现**:
- ✅ DwellTimeCalculator 类（161 行）
- ✅ 完整测试套件（419 行，26 个测试）
- ✅ 详细日志系统（🕐 👁️ 🙈 👆 ⏱️ 🔄）
- ✅ PR: #待创建

#### 2.3 动态停留阈值系统 ⏸️ (暂缓)
**文件**: `src/core/tracker/DwellTimeThresholdManager.ts`

**说明**: Phase 2.1/2.2 使用固定 30 秒阈值，动态阈值系统推迟到后续版本实现

**原设计**:
- 三阶段自适应算法
  - 阶段 1（0-100 页）: 固定 30 秒
  - 阶段 2（101-1000 页）: 自适应计算
  - 阶段 3（1000+ 页）: 持续优化
- 用户可配置范围（15-120 秒）
- 每 100 页重新计算一次

**当前实现**: 
- ✅ 使用固定 30 秒阈值
- ⏸️ 动态算法待实现

#### 2.4 页面过滤引擎 (进行中)
**文件**: `src/core/tracker/DwellTimeThresholdManager.ts`

**功能**:
- 三阶段自适应算法
  - 阶段 1（0-100 页）: 固定 30 秒
  - 阶段 2（101-1000 页）: 自适应计算
  - 阶段 3（1000+ 页）: 持续优化
- 用户可配置范围（15-120 秒）
- 每 100 页重新计算一次

**验收标准**:
- [ ] 前 100 页使用固定阈值 30 秒
- [ ] 100 页后基于中位数自动计算阈值
- [ ] 阈值限制在用户设定范围内
- [ ] 设置页显示当前计算值
- [ ] 有完整测试覆盖

#### 2.4 页面过滤引擎 (进行中)
**文件**: `src/core/tracker/PageFilter.ts`

**功能**:
- URL 模式过滤（内网、特殊协议）
- 域名黑名单（邮件、银行、医疗）
- 内容特征过滤（字数、标题、搜索结果页）
- 用户自定义排除规则

**验收标准**:
- [ ] 自动排除内网地址（localhost, 192.168.*, 10.*）
- [ ] 排除敏感域名（邮件、银行等）
- [ ] 排除非内容页面（登录页、404、搜索结果）
- [ ] 支持用户添加自定义排除规则
- [ ] 有完整测试覆盖

**当前状态**: 待实现（将在 PageTracker 中集成）

#### 2.5 内容提取和基础分析 (待开始)
**文件**: `src/core/tracker/PageFilter.ts`

**功能**:
- URL 模式过滤（内网、特殊协议）
- 域名黑名单（邮件、银行、医疗）
- 内容特征过滤（字数、标题、搜索结果页）
- 用户自定义排除规则

**验收标准**:
- [ ] 自动排除内网地址（localhost, 192.168.*, 10.*）
- [ ] 排除敏感域名（邮件、银行等）
- [ ] 排除非内容页面（登录页、404、搜索结果）
- [ ] 支持用户添加自定义排除规则
- [ ] 有完整测试覆盖

#### 2.5 内容提取和基础分析 (待开始)
**文件**: `src/core/extractor/`, `src/core/analyzer/`

**功能**:
- 元数据提取（title, description, keywords）
- 正文摘要提取（前 2000 字）
- TF-IDF 关键词提取（Top 20）
- 简单主题分类（规则引擎）
- 语言检测（中文/英文）

**验收标准**:
- [ ] 正确提取页面元数据
- [ ] 智能提取正文内容（article/main/启发式）
- [ ] 生成 Top 20 关键词
- [ ] 分类基础主题（技术、设计、科学等）
- [ ] 检测文本语言
- [ ] 有完整测试覆盖

#### 2.6 数据存储系统 ✅ (已完成)
**文件**: `src/storage/db.ts`, `src/storage/types.ts`, `src/storage/repositories/`

**功能**:
- IndexedDB（Dexie.js）4 张表
  - pendingVisits（临时记录）
  - confirmedVisits（正式记录）
  - settings（用户设置）
  - statistics（统计缓存）
- 数据生命周期管理
  - 原始内容 90 天后删除
  - 分析结果永久保留
- 用户数据控制
  - 清空访问历史
  - 重置画像（Phase 3）
  - 完全重置

**验收标准**:
- ✅ 数据库正确创建和初始化
- ✅ 类型定义完整（PendingVisit, ConfirmedVisit, UserSettings, Statistics）
- ✅ 提供辅助函数（getSettings, updateSettings, getPageCount）
- ✅ 有完整测试覆盖（12 个测试）

**实际实现**:
- ✅ FeedAIMuterDB 类（4 张表）
- ✅ 完整的类型系统
- ✅ 数据库初始化逻辑
- ✅ 测试覆盖率 100%

#### 2.7 实时反馈界面 (待开始)
**文件**: `src/core/extractor/`, `src/core/analyzer/`

**功能**:
- 元数据提取（title, description, keywords）
- 正文摘要提取（前 2000 字）
- TF-IDF 关键词提取（Top 20）
- 简单主题分类（规则引擎）
- 语言检测（中文/英文）

**验收标准**:
- [ ] 正确提取页面元数据
- [ ] 智能提取正文内容（article/main/启发式）
- [ ] 生成 Top 20 关键词
- [ ] 分类基础主题（技术、设计、科学等）
- [ ] 检测文本语言
- [ ] 有完整测试覆盖

#### 2.7 实时反馈界面 (待开始)
**更新**: `src/popup.tsx`, `src/options.tsx`

**功能**:
- Popup 显示统计信息
  - 实时页面计数
  - Top 3 主题分布
  - 进度百分比
- 设置页新增"数据统计"标签
  - 总访问数 / 有效数 / 排除数
  - 平均停留时间
  - 当前阈值
  - Top 域名列表
- 徽章实时更新（连接真实数据）

**验收标准**:
- [ ] Popup 实时显示页面计数（更新徽章）
- [ ] Popup 显示最近主题分布
- [ ] 设置页显示详细统计信息
- [ ] 设置页显示当前阈值和配置选项
- [ ] 用户可调整阈值范围
- [ ] 有完整测试覆盖

### 本阶段文档
- [x] `docs/PHASE_2_DESIGN.md` - 详细设计文档
- [x] `docs/PHASE_2_BROWSER_TESTING.md` - 浏览器测试指南
- [ ] 更新 `docs/DEVELOPMENT_PLAN.md` - 开发计划
- [ ] 更新 `docs/TDD.md` - 技术设计文档

### 完成标准
- [x] Phase 2.1 Content Script 系统（PageTracker）
- [x] Phase 2.2 DwellTimeCalculator
- [x] Phase 2.6 数据存储系统
- [ ] Phase 2.4 页面过滤引擎
- [ ] Phase 2.5 内容提取和分析
- [ ] Phase 2.7 实时反馈界面
- [ ] 所有验收标准通过
- [ ] 测试覆盖率 ≥ 70%
- [ ] 浏览器实测通过
- [ ] 代码已合并到 master
- [ ] 文档已更新
**文件**: `src/storage/db.ts`, `src/storage/repositories/`

**功能**:
- IndexedDB（Dexie.js）4 张表
  - pendingVisits（临时记录）
  - confirmedVisits（正式记录）
  - settings（用户设置）
  - statistics（统计缓存）
- 数据生命周期管理
  - 原始内容 90 天后删除
  - 分析结果永久保留
- 用户数据控制
  - 清空访问历史
  - 重置画像（Phase 3）
  - 完全重置

**验收标准**:
- [ ] 数据库正确创建和初始化
- [ ] 临时记录 5 分钟后自动清理
- [ ] 原始内容 90 天后自动删除（保留分析结果）
- [ ] 用户可手动清空历史数据
- [ ] 有完整测试覆盖

#### 2.6 实时反馈界面
**更新**: `src/popup.tsx`, `src/options.tsx`

**功能**:
- Popup 显示统计信息
  - 实时页面计数
  - Top 3 主题分布
  - 进度百分比
- 设置页新增"数据统计"标签
  - 总访问数 / 有效数 / 排除数
  - 平均停留时间
  - 当前阈值
  - Top 域名列表
- 徽章实时更新（连接真实数据）

**验收标准**:
- [ ] Popup 实时显示页面计数（更新徽章）
- [ ] Popup 显示最近主题分布
- [ ] 设置页显示详细统计信息
- [ ] 设置页显示当前阈值和配置选项
- [ ] 用户可调整阈值范围
- [ ] 有完整测试覆盖

### 本阶段文档
- [x] `docs/PHASE_2_DESIGN.md` - 详细设计文档
- [ ] 更新 `docs/DEVELOPMENT_PLAN.md` - 开发计划
- [ ] 更新 `docs/TDD.md` - 技术设计文档

### 完成标准
- [ ] 所有验收标准通过
- [ ] 测试覆盖率 ≥ 70%
- [ ] 浏览器实测通过
- [ ] 代码已合并到 master
- [ ] 文档已更新

---

## 阶段 3: 用户画像构建 (预计 3 小时)

### 目标
分析用户浏览行为，构建兴趣画像

### 功能列表

#### 3.1 文本分析引擎
**文件**: `src/core/analyzer/TextAnalyzer.ts`

**功能**:
- TF-IDF 关键词提取
- 中英文分词
- 停用词过滤

#### 3.2 用户画像构建器
**文件**: `src/core/profile/ProfileBuilder.ts`

**功能**:
- 从页面访问构建画像
- 主题分类
- 时间衰减

#### 3.3 画像可视化
**更新**: `src/popup.tsx`

**功能**:
- 显示 Top 3 兴趣主题
- 显示主题占比
- 显示分析进度

### 本阶段文档
- [ ] `docs/PHASE_3_PROFILING.md`

---

## 阶段 4: RSS 自动发现 (预计 2 小时)

### 目标
自动检测网页的 RSS 源并提示订阅

### 功能列表

#### 4.1 RSS 检测
**文件**: `src/contents/rss-detector.ts`

**功能**:
- 检测 `<link rel="alternate">` 标签
- 尝试常见 RSS URL 模式
- 验证 RSS 有效性

#### 4.2 订阅管理
**文件**: `src/core/rss/RSSManager.ts`

**功能**:
- OPML 导入/导出
- 源健康检测
- 自动订阅/取消

#### 4.3 订阅 UI
**更新**: `src/popup.tsx`

**功能**:
- 显示已订阅源列表
- 显示"发现新源"提示
- 一键订阅/取消订阅

### 本阶段文档
- [ ] `docs/PHASE_4_RSS_DISCOVERY.md`

---

## 阶段 5: AI 推荐引擎 (预计 4 小时)

### 目标
实现基础推荐算法和 AI 集成

### 功能列表

#### 5.1 规则引擎推荐
**文件**: `src/core/recommender/RuleBasedRecommender.ts`

**功能**:
- TF-IDF 相似度匹配
- 时效性评分
- 预筛选算法

#### 5.2 AI 适配器
**文件**: `src/core/ai/AIAdapter.ts`

**功能**:
- 支持 OpenAI API
- 支持 Anthropic API
- 支持 DeepSeek API
- Prompt 工程

#### 5.3 推荐展示
**更新**: `src/popup.tsx`

**功能**:
- 显示推荐列表
- 显示推荐理由
- 反馈按钮 (喜欢/忽略/稍后)

### 本阶段文档
- [ ] `docs/PHASE_5_RECOMMENDATION.md`

---

## 阶段 6: 通知机制 (预计 2 小时)

### 目标
智能推送重要内容

### 功能列表

#### 6.1 通知策略
**文件**: `src/core/notification/NotificationManager.ts`

**功能**:
- 重要性评分
- 用户状态检测
- 每日配额管理

#### 6.2 扩展图标状态
**文件**: `src/background/badge-manager.ts`

**功能**:
- 显示未读数字徽章
- 图标动画 (可选)

### 本阶段文档
- [ ] `docs/PHASE_6_NOTIFICATION.md`

---

## 阶段 7: 优化与发布 (预计 3 小时)

### 目标
完善体验，准备发布

### 功能列表

#### 7.1 性能优化
- 批量处理
- 缓存策略
- 懒加载

#### 7.2 用户引导
- 首次使用教程
- 帮助文档
- 反馈渠道

#### 7.3 Chrome Web Store 准备
- 截图和宣传图
- 商店描述
- 隐私政策

### 本阶段文档
- [ ] `docs/PHASE_7_POLISH.md`
- [ ] `docs/PUBLISHING.md`

---

## 开发节奏建议

### 每个阶段的流程

1. **开始前** (5 分钟)
   - 阅读阶段文档
   - 创建功能分支: `git checkout -b feature/phase-N`

2. **开发中** (主要时间)
   - 编写测试 (TDD)
   - 实现功能
   - 频繁提交: `git commit -m "feat: xxx"`

3. **完成后** (10 分钟)
   - 运行测试: `npm test`
   - 检查覆盖率: `npm run test:coverage`
   - 更新文档
   - 合并到 master: `git merge feature/phase-N`
   - 推送: `git push`

### 每日开发建议

- **每次 1-2 小时**: 完成一个小功能
- **立即验证**: 在浏览器中测试
- **及时提交**: 不积累太多未提交代码

---

## 当前状态

- ✅ **阶段 0**: 基础框架 (已完成)
- ✅ **阶段 1**: Hello World 扩展 (已完成) - **v0.1.0**
- 🎯 **阶段 2**: 页面访问监听 (进行中)
- ⏸️ **阶段 3-7**: 等待开始

---

## 估计时间

| 阶段 | 预计时间 | 累计时间 |
|------|---------|---------|
| 阶段 0 | 2 小时 | 2 小时 ✅ |
| 阶段 1 | 1 小时 | 3 小时 ✅ |
| 阶段 2 | 2 小时 | 5 小时 🎯 |
| 阶段 3 | 3 小时 | 8 小时 |
| 阶段 4 | 2 小时 | 10 小时 |
| 阶段 5 | 4 小时 | 14 小时 |
| 阶段 6 | 2 小时 | 16 小时 |
| 阶段 7 | 3 小时 | 19 小时 |

**MVP 总计**: 约 19 小时 (2-3 周业余时间)

---

## 下一步

准备好开始 **阶段 2: 页面访问监听** 了吗？

这个阶段将实现：
- 📝 Content Script 注入（监听页面）
- 💾 数据存储（IndexedDB）
- 📊 实时进度更新（与 popup 同步）

完成后扩展将能够：
- 自动收集浏览历史
- 实时显示学习进度
- 为用户画像构建准备数据！🚀
