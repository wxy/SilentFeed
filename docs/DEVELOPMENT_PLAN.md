# Silent Feed 渐进式开发计划

## 开发理念

**每一步都可见、可测、可用**

- ✅ 每个功能都有明确的验收标准
- ✅ 每个功能都可以在浏览器中直接体验
- ✅ 每个功能都有配套的测试
- ✅ 每个功能完成后更新文档

---

## 阶段 0: 基础框架 ✅ (已完成)

### 目标
建立项目基础和测试体系

### 已完成
- ✅ 项目初始化 (Plasmo + React + TypeScript)
- ✅ 测试体系 (Vitest + Testing Library)
- ✅ 开发规范 (copilot-instructions)
- ✅ 文档体系 (PRD, TDD, TESTING)
- ✅ 扩展可以构建和加载

### 验收标准
- ✅ `npm run build` 成功
- ✅ `npm test` 全部通过
- ✅ 可在 Chrome 中加载扩展

---

## 阶段 1: Hello World 扩展 ✅ (已完成)

### 目标
让用户能看到一个有基本 UI 的扩展

### 功能列表

#### 1.1 创建 Popup 界面 ✅ (已完成)
**文件**: `src/popup.tsx`

**功能**:
- 显示扩展名称和图标
- 显示欢迎消息
- 显示当前状态 (未初始化)
- 显示初始化进度 0/1000

**验收标准**:
- ✅ 点击扩展图标后弹出界面
- ✅ 界面显示 "Silent Feed" 标题
- ✅ 显示 🌱 图标和 "0/1000 页" 文字
- ✅ 界面自适应明暗主题
- ✅ 有测试覆盖（100%）

**实际实现**:
- ✅ 产品简称：RSS 静音器
- ✅ 大号图标（text-8xl）带脉动动画
- ✅ 进度条在下方，清晰可见
- ✅ 完整测试（21个测试用例）
- ✅ PR: #待创建

#### 1.1.5 国际化支持 ✅ (已完成)
**文件**: `src/i18n/*`, `scripts/translate.js`

**功能**:
- 使用 react-i18next 实现国际化
- 支持简体中文和英文
- 使用 _() 函数包裹用户可见文本
- 自动翻译脚本（DeepSeek API）
- 翻译跟踪系统

**验收标准**:
- ✅ 支持中英文切换
- ✅ 自动检测用户语言
- ✅ 提取脚本可用
- ✅ 翻译脚本可用
- ✅ 现有界面完全翻译
- ✅ 开发日志保持中文，用户消息国际化

**用户体验**:
```
┌─────────────────────────────┐
│  🌱 SilentFeed              │
├─────────────────────────────┤
│  欢迎使用智能 RSS 阅读器      │
│                              │
│  ╔═══════════════════════╗   │
│  ║ ░░░░░░░░░░░░░░░░░░░░░ ║ 0/1000 │
│  ╚═══════════════════════╝   │
│                              │
│  📖 开始浏览，我会学习你的    │
│     兴趣...                   │
│                              │
│  [设置]                       │
└─────────────────────────────┘
```

#### 1.2 创建设置页面 ✅ (已完成)
**文件**: `src/options.tsx`

**功能**:
- ✅ 语言选择下拉列表（跟随浏览器/中文/英文）
- ✅ 标签页布局（常规、RSS 源管理、AI、数据与隐私）
- ✅ 使用主题样式，自适应明暗主题
- ✅ 预留设置分区，显示禁用状态

**验收标准**:
- ✅ Popup 点击设置可跳转
- ✅ 语言选择下拉框正常工作
- ✅ 标签切换流畅，激活状态明显
- ✅ 自适应明暗主题
- ✅ 预留四个设置分区
- ✅ 测试覆盖率达标（21 个测试）

**设计规格**:
```
┌─────────────────────────────────────────────────┐
│  Silent Feed - 设置                             │
├─────────────┬───────────────────────────────────┤
│  ⚙️ 常规    │  常规设置                          │
│  📡 RSS 源  │  选择界面显示语言                   │
│  🤖 AI      │                                    │
│  🔒 隐私    │  语言: [下拉选择 ▼]                │
│             │                                    │
│             │                                    │
│             │                                    │
└─────────────┴───────────────────────────────────┘
```

#### 1.3 徽章进度系统 ✅ (已完成)
**文件**: `src/background.ts`

**功能**:
- 使用 Chrome Badge API 在图标上显示进度
- 徽章文本使用不同阶段的 emoji 代表进度
  - 🌱 (0-250 页): 探索者
  - 🌿 (251-600 页): 学习者
  - 🌳 (601-1000 页): 成长者
  - 🌲 (1000+ 页): 大师
- 暂时使用默认图标（未来可自定义）

**验收标准**:
- ✅ 扩展图标上显示徽章文本（emoji）
- ✅ 徽章随页面计数自动更新
- ✅ 不同阶段使用不同的 emoji
- ✅ 有测试覆盖

**实际实现**:
- ✅ Badge 文本设置函数
- ✅ 进度阶段计算逻辑
- ✅ 与 popup 进度同步
- ✅ PR: #待创建

### 本阶段完成总结

**Phase 1: Hello World 扩展** 已全部完成！🎉

完成的功能：
- ✅ Popup 界面（进度展示、欢迎消息）
- ✅ 国际化支持（中英双语）
- ✅ 设置页面（标签页布局、语言切换）
- ✅ 徽章系统（进度可视化）

技术指标：
- 测试覆盖率: > 70%
- 国际化覆盖: 100%
- 构建成功率: 100%

版本发布：
- **v0.1.0** - Phase 1 MVP Release
  - 基础 UI 框架
  - 国际化支持
  - 设置页面
  - 进度徽章系统

### 下一步
进入 **阶段 2: 页面访问监听**，开始收集用户浏览数据

---

## 阶段 2: 页面访问监听 ✅ (已完成)

**实际时间**: ~5 小时（含测试和 bug 修复）
**完成日期**: 2025-11-02
**版本**: v0.2.7

### 目标
建立页面访问数据收集系统，为用户画像构建准备数据基础

### 完成成果
- ✅ Content Script 监听系统（DwellTimeCalculator 集成）
- ✅ 数据存储系统（IndexedDB + Dexie.js）
- ✅ 两阶段 UI（冷启动 + 推荐）
- ✅ 徽章系统（进度和推荐数显示）
- ✅ 设置页扩展（5 个标签页）
- ✅ 推荐状态管理（Zustand）
- ✅ **架构修复**: Content Script → Background 消息传递
- ✅ **测试增强**: 143 个测试，覆盖率 77.94%
- ✅ **代码优化**: 移除 ~50 个调试语句

### 关键 Bug 修复
1. ⚠️ **CRITICAL**: Content Script IndexedDB 隔离问题（数据写入错误上下文）
2. ⚠️ **HIGH**: 数据库版本冲突导致数据删除
3. ⚠️ **MEDIUM**: RecommendationStats 接口字段不匹配

### 技术文档
- `docs/PHASE_2_BROWSER_TESTING_ISSUES.md`
- `docs/DATABASE_VERSION_INCIDENT.md`
- `docs/ARCHITECTURE_FIX_CONTENT_SCRIPT_DB.md`
- `docs/PHASE_2_FINAL_TESTING_GUIDE.md`
- `docs/PHASE_2.7_FINAL_SUMMARY.md`

### 功能列表

#### 2.1 Content Script 监听系统 ✅ (已完成)
**文件**: `src/contents/page-tracker.ts`

**功能**:
- 自动注入到所有 HTTP/HTTPS 页面
- 使用 DwellTimeCalculator 计算停留时间
- 监听用户交互（scroll, click, keypress, mousemove）
- 达到 30 秒阈值后保存到 confirmedVisits 表
- 提供详细的调试日志用于浏览器测试
- **生产优化**: 环境感知日志 + 资源清理系统

**验收标准**:
- ✅ 访问网页时自动注入 Content Script
- ✅ 正确计算有效停留时间（激活 + 交互）
- ✅ 30 秒无交互停止计时
- ✅ 达到 30 秒阈值后保存到数据库
- ✅ 避免重复记录
- ✅ 有完整测试覆盖（99/99 测试通过）
- ✅ 生产环境日志静默
- ✅ 记录后资源完全释放

**实际实现**:
- ✅ PageTracker Content Script（302 行）
- ✅ 集成 DwellTimeCalculator
- ✅ 保存到 confirmedVisits 表
- ✅ 环境感知日志系统（logger.ts）
- ✅ 资源清理机制（cleanup 函数）
- ✅ 处理页面卸载
- ✅ 通知 background 更新徽章
- ✅ PR: feature/phase-2.2-dwell-time (已合并)

#### 2.2 DwellTimeCalculator（停留时间计算器）✅ (已完成)
**文件**: `src/core/tracker/DwellTimeCalculator.ts`

**功能**:
- 页面激活状态监听（visibilitychange）
- 用户交互检测（scroll, click, keypress, mousemove）
- 智能停留时间计算（激活 + 交互）
- 30 秒交互超时机制
- **生产优化**: stop() 机制 + 环境感知日志

**验收标准**:
- ✅ 正确计算有效停留时间
- ✅ 页面失活时停止计时
- ✅ 30 秒无交互停止计时
- ✅ 新交互后恢复计时
- ✅ 有完整测试覆盖（26 个单元测试）
- ✅ 支持停止后不再计算

**实际实现**:
- ✅ DwellTimeCalculator 类（202 行）
- ✅ 完整测试套件（419 行，26 个测试）
- ✅ 环境感知日志（logger.debug）
- ✅ stop() 方法和 isStopped 标志
- ✅ PR: feature/phase-2.2-dwell-time (已合并)

#### 2.3 动态停留阈值系统 ⏸️ (暂缓)
**文件**: `src/core/tracker/DwellTimeThresholdManager.ts`

**说明**: Phase 2.1/2.2 使用固定 30 秒阈值，动态阈值系统推迟到后续版本实现

**原设计**:
- 三阶段自适应算法
  - 阶段 1（0-100 页）: 固定 30 秒
  - 阶段 2（101-1000 页）: 自适应计算
  - 阶段 3（1000+ 页）: 持续优化
- 用户可配置范围（15-120 秒）
- 每 100 页重新计算一次

**当前实现**: 
- ✅ 使用固定 30 秒阈值
- ⏸️ 动态算法待实现

#### 2.4 页面过滤引擎 (待开始)
**文件**: `src/core/tracker/PageFilter.ts`

**功能**:
- URL 模式过滤（内网、特殊协议）
- 域名黑名单（邮件、银行、医疗）
- 内容特征过滤（字数、标题、搜索结果页）
- 用户自定义排除规则

**验收标准**:
- [ ] 自动排除内网地址（localhost, 192.168.*, 10.*）
- [ ] 排除敏感域名（邮件、银行等）
- [ ] 排除非内容页面（登录页、404、搜索结果）
- [ ] 支持用户添加自定义排除规则
- [ ] 有完整测试覆盖

**当前状态**: 待实现（将在 PageTracker 中集成）

#### 2.5 内容提取和基础分析 (待开始)
**文件**: `src/core/extractor/`, `src/core/analyzer/`

**功能**:
- 元数据提取（title, description, keywords）
- 正文摘要提取（前 2000 字）
- TF-IDF 关键词提取（Top 20）
- 简单主题分类（规则引擎）
- 语言检测（中文/英文）

**验收标准**:
- [ ] 正确提取页面元数据
- [ ] 智能提取正文内容（article/main/启发式）
- [ ] 生成 Top 20 关键词
- [ ] 分类基础主题（技术、设计、科学等）
- [ ] 检测文本语言
- [ ] 有完整测试覆盖

#### 2.6 数据存储系统 ✅ (已完成)
**文件**: `src/storage/db.ts`, `src/storage/types.ts`, `src/storage/repositories/`

**功能**:
- IndexedDB（Dexie.js）4 张表
  - pendingVisits（临时记录）
  - confirmedVisits（正式记录）
  - settings（用户设置）
  - statistics（统计缓存）
- 数据生命周期管理
  - 原始内容 90 天后删除
  - 分析结果永久保留
- 用户数据控制
  - 清空访问历史
  - 重置画像（Phase 3）
  - 完全重置

**验收标准**:
- ✅ 数据库正确创建和初始化
- ✅ 类型定义完整（PendingVisit, ConfirmedVisit, UserSettings, Statistics）
- ✅ 提供辅助函数（getSettings, updateSettings, getPageCount）
- ✅ 有完整测试覆盖（12 个测试）

**实际实现**:
- ✅ SilentFeedDB 类（4 张表）
- ✅ 完整的类型系统
- ✅ 数据库初始化逻辑
- ✅ 测试覆盖率 100%

#### 2.7 实时反馈界面 (待开始)
**更新**: `src/popup.tsx`, `src/options.tsx`, `src/background.ts`

**设计理念**: 推荐是核心，数据收集是手段

**功能**:

##### Popup 界面（两个阶段）

**阶段 1: 冷启动阶段（0-1000 页）**
- 显示收集进度
  - 🌱🌿🌳🌲 成长树图标（随进度变化）
  - 进度条：`637/1000 页`
  - 提示文本："正在学习你的兴趣..."
- **不显示**主题分布（对用户意义不大）

**阶段 2: 推荐阶段（1000+ 页）**
- 显示推荐列表（倒序，最新在上）
  - 每条显示：标题、来源、推荐时间
  - 状态图标：✅ 已读 / 📌 未读
  - 点击打开原文
- 快速统计
  - "本周推荐 X 条，已读 Y 条（Z%）"
  - 一键"标记全部已读"

##### 徽章系统

**冷启动阶段（0-1000 页）**
- 显示成长树 emoji：🌱 → 🌿 → 🌳 → 🌲
- 表示收集进度

**推荐阶段（1000+ 页）**
- 显示数字徽章：`3/10`（已读/推荐）
- 表示未读推荐数

##### 设置页 - 数据统计标签

**推荐效果统计**（主要）
- 📊 推荐总数 / 已读数 / 阅读率
- 📈 近 7 天推荐趋势图（简单折线图）
- ⭐ 最受欢迎的推荐来源（Top 5）

**数据收集统计**（次要）
- 📚 累计分析页面数
- 💾 数据规模统计
  - 总记录数
  - 存储占用（MB）
  - 平均停留时间
- 🗂️ 按域名统计（Top 10）

**用户操作**
- 🧹 清空推荐历史
- 🔄 重置用户画像
- ⚠️ 清空所有数据

**验收标准**:
- [ ] Popup 在冷启动阶段显示进度和树图标
- [ ] Popup 在推荐阶段显示推荐列表
- [ ] 推荐条目可标记已读/未读
- [ ] 徽章在冷启动显示树，推荐阶段显示数字
- [ ] 设置页显示推荐效果统计（主要）
- [ ] 设置页显示数据收集统计（次要）
- [ ] 统计数据实时更新
- [ ] 有完整测试覆盖

**技术实现**:
- 使用 Zustand 管理状态（推荐列表、阅读状态）
- IndexedDB 新增表：`recommendations`
  - id, url, title, source, recommendedAt, isRead, clickedAt
- Background 定时更新徽章
- Popup 使用虚拟滚动（推荐列表可能很长）

**UI 设计原则**:
- 冷启动：鼓励用户继续浏览
- 推荐阶段：聚焦推荐内容，淡化数据收集
- 克制设计：不显示过多统计数据

### 本阶段文档
- [x] `docs/PHASE_2_DESIGN.md` - 详细设计文档
- [x] `docs/PHASE_2_BROWSER_TESTING.md` - 浏览器测试指南
- [x] `docs/PHASE_2_PRODUCTION_OPTIMIZATION.md` - 生产环境优化总结
- [x] 更新 `docs/DEVELOPMENT_PLAN.md` - 开发计划
- [ ] 更新 `docs/TDD.md` - 技术设计文档

### 完成标准
- [x] Phase 2.1 Content Script 系统（PageTracker）
- [x] Phase 2.2 DwellTimeCalculator
- [x] Phase 2.6 数据存储系统
- [ ] Phase 2.4 页面过滤引擎
- [ ] Phase 2.5 内容提取和分析
- [ ] Phase 2.7 实时反馈界面
- [ ] 所有验收标准通过
- [ ] 测试覆盖率 ≥ 70%
- [ ] 浏览器实测通过
- [ ] 代码已合并到 master
- [ ] 文档已更新

---

## 阶段 3: 用户画像构建 ✅ (已完成)

### 目标
分析用户浏览行为，构建兴趣画像

### 功能列表

#### 3.1 文本分析引擎 ✅ (已完成)
**文件**: `src/core/analyzer/TextAnalyzer.ts`

**功能**:
- ✅ TF-IDF 关键词提取
- ✅ 中英文分词（特别优化中文词组提取）
- ✅ 停用词过滤
- ✅ 语言检测

**验收标准**:
- ✅ 支持中英文内容分析
- ✅ 关键词提取准确率高
- ✅ 中文分词算法优化（词组级别）
- ✅ 有完整测试覆盖

#### 3.2 用户画像构建器 ✅ (已完成)
**文件**: `src/core/profile/ProfileBuilder.ts`, `src/core/profile/ProfileManager.ts`

**功能**:
- ✅ 从页面访问构建画像
- ✅ 主题分类（技术、生活、娱乐等）
- ✅ 时间衰减算法
- ✅ 兴趣权重计算

**验收标准**:
- ✅ 画像数据结构完善
- ✅ 主题分类准确
- ✅ 权重计算合理
- ✅ 支持增量更新

#### 3.3 画像可视化 ✅ (已完成)
**文件**: `src/components/settings/UserProfileDisplay.tsx`

**功能**:
- ✅ 显示主导兴趣主题
- ✅ 显示主题占比和权重
- ✅ 三层优势策略（绝对、相对、领先）
- ✅ 关键词云展示
- ✅ 分析进度显示

**验收标准**:
- ✅ 界面清晰易懂
- ✅ 数据可视化效果好
- ✅ 支持明暗主题
- ✅ 响应式设计

#### 3.4 兴趣演化追踪 ✅ (超出计划完成)
**文件**: `src/core/profile/InterestSnapshotManager.ts`

**功能**:
- ✅ 兴趣变化检测
- ✅ 历史快照记录
- ✅ 演化时间线展示
- ✅ 变化原因分析

#### 3.5 智能自动更新 ✅ (超出计划完成)
**文件**: `src/core/profile/ProfileUpdateScheduler.ts`

**功能**:
- ✅ 智能更新调度
- ✅ 性能优化策略
- ✅ 避免频繁计算
- ✅ 优先级管理

### 本阶段文档
- ✅ 已更新 `docs/DEVELOPMENT_PLAN.md`
- ✅ 代码内文档完善
- ✅ 测试文档完整

---

## 阶段 4: AI 能力集成 ✅ (已完成)

**目标**：建立灵活的 AI 分析能力，支持远程 API 和降级策略

**完成日期**: 2025-11-09
**版本**: v0.4.0
**PR**: [#8](https://github.com/wxy/SilentFeed/pull/8)

**开发原则**：
1. ✅ **UI 优先** - 先做配置界面，能看到变化
2. ✅ **远程 API 优先** - OpenAI/Anthropic/DeepSeek
3. ✅ **渐进测试** - 每个功能都能立即测试
4. ✅ **不考虑迁移** - 丢弃旧数据，重新开始

**实际时间**: 10 天

---

### Sprint 1: UI 基础（2-3天）✅ 已完成

#### 4.1 AI 配置界面 ✅
**文件**: `src/components/settings/AIConfig.tsx`

**验收标准**:
- ✅ 能看到 AI 配置界面
- ✅ 能选择 AI 提供商
- ✅ 能输入和保存 API Key
- ✅ 测试连接按钮正常工作
- ✅ 数据加密存储

#### 4.2 AI 状态卡片 ✅
**文件**: `src/components/settings/CollectionStats.tsx`

**验收标准**:
- ✅ 能看到 AI 状态卡片
- ✅ 显示当前提供商和连接状态
- ✅ 显示使用统计

---

### Sprint 2-4: AI 集成 ✅ 已完成

- ✅ OpenAI Provider
- ✅ Anthropic Provider  
- ✅ DeepSeek Provider
- ✅ AICapabilityManager
- ✅ 集成到 page-tracker

---

### Sprint 5-6: 画像升级与成本控制 ✅ 已完成

- ✅ ProfileBuilder AI 概率云
- ✅ 多货币成本追踪（USD/CNY）
- ✅ AI 质量统计 UI
- ✅ 兴趣演化历程优化
- ✅ UI 布局重构

---

### Phase 4 完成总结

**完成功能**:
- ✅ 3 个 AI Provider（OpenAI/Anthropic/DeepSeek）
- ✅ 智能降级机制
- ✅ AI 配置和状态 UI
- ✅ 成本追踪（支持 USD/CNY）
- ✅ 用户画像 AI 增强

**技术指标**:
- ✅ 测试覆盖: 464/464 通过
- ✅ 构建成功
- ✅ 所有 Sprint 完成

**文档**:
- ✅ PR #8 已创建
- ✅ 开发计划已更新

---

## 阶段 5: RSS 自动发现与智能订阅 🎯 (当前阶段)

**目标**: 建立智能 RSS 发现和订阅系统

**核心理念**: "静默发现 + 智能筛选 + 用户决策"
- 🔒 **隐私优先** - 只分析本地数据
- 🎯 **质量优先** - 先验证质量和相关性
- 👤 **用户控制** - 最终决策权在用户

**预计时间**: 6-8 天

---

### UI 改进：主题系统简化 ✅ (已完成)

**完成日期**: 2025-11-10
**分支**: feature/ui-theme-improvements
**PR**: 待创建

#### 变更概述
采用**方案 A**（仅跟随系统主题），移除手动主题选择功能，简化主题系统。

#### 主要修改
- ✅ Tailwind 配置: `darkMode: 'media'` → `'class'`
- ✅ 删除 ThemeMode 类型和主题选择相关代码
- ✅ 简化 useTheme Hook 为仅系统主题跟随
- ✅ 移除设置页主题选择下拉框
- ✅ 清理重复文件和 i18n 翻译
- ✅ 更新测试: 568 个测试全部通过

#### 设计理念
- 符合"克制设计"原则
- 减少用户选择疲劳
- 与 Chrome 扩展生态一致
- 代码更简单可靠

---

### 设计原则

#### RSS 来源策略
1. **手动管理** - 用户主动添加/OPML 导入（基础功能）
2. **自动发现** - 从浏览页面静默发现 RSS（核心功能）
3. **AI 推荐** - 基于用户画像主动推荐（可选功能，Phase 6）

#### 三层架构

```
第一层：自动发现（静默）
用户浏览页面 → 检测 RSS → 添加到候选池 → 试探性抓取

第二层：智能筛选  
候选源 → 质量检查 → 相关性分析 → 晋升为推荐源

第三层：用户决策
推荐源 → 非侵入式提示 → 用户选择订阅/忽略/稍后
```

---

### Phase 5 Sprint 1: RSS 基础设施与 UI ✅ (已完成)

**完成日期**: 2025-11-11
**分支**: feature/phase-5-sprint-1-ui (已合并到 master)
**用时**: 2 天

#### 5.1 RSS 检测器 ✅
**文件**: `src/contents/rss-detector.ts`

**功能**:
- Content Script 检测 RSS 链接
  - `<link rel="alternate" type="application/rss+xml">`
  - `<link rel="alternate" type="application/atom+xml">`
- 尝试常见 URL 模式
  - `/feed`, `/rss`, `/atom.xml`, `/index.xml`
  - 域名根目录: `feed.xml`, `rss.xml`
- 发送到 background 进行验证

**验收标准**:
- ✅ 检测到 RSS 链接
- ✅ 支持 RSS 和 Atom 格式
- ✅ 尝试常见路径
- ✅ 有完整测试覆盖（14 个测试）

#### 5.2 RSS 验证器 ✅
**文件**: `src/core/rss/RSSValidator.ts`

**功能**:
- 验证 RSS/Atom 格式
- 检查 XML 结构
- 提取基本信息（title, description, link）

**验收标准**:
- ✅ 验证 RSS 2.0 格式
- ✅ 验证 Atom 1.0 格式
- ✅ 提取元数据
- ✅ 错误处理完善（17 个测试）

#### 5.3 发现源数据模型 ✅
**文件**: `src/storage/types.ts`, `src/storage/db.ts`

**功能**:
- 新增 `discoveredFeeds` 表
- 定义 `DiscoveredFeed` 类型
- 状态机：candidate → recommended → subscribed/ignored

**数据模型**:
```typescript
interface DiscoveredFeed {
  id: string
  url: string
  title: string
  description?: string
  discoveredFrom: string  // 发现来源页面 URL
  discoveredAt: number
  status: 'candidate' | 'recommended' | 'subscribed' | 'ignored'
  
  // 质量评估（稍后填充）
  quality?: {
    updateFrequency: number  // 篇/周
    formatValid: boolean
    reachable: boolean
    lastChecked: number
  }
  
  // 相关性分析（稍后填充）
  relevance?: {
    matchScore: number  // 0-100
    matchedTopics: Topic[]
    sampleArticles: {
      title: string
      matchScore: number
    }[]
  }
}
```

**验收标准**:
- ✅ 数据表创建成功（数据库版本 5）
- ✅ 类型定义完整
- ✅ CRUD 操作正常（9 个测试）

**技术指标**:
- 新增测试: 40 个（14+17+9）
- 测试总数: 513 → 553
- 测试通过率: 100%
- 代码行数: +1085

#### 待完成任务

##### 5.1.6 完整元数据与订阅管理 ✅ (已完成)

**完成日期**: 2025-11-10
**分支**: feature/phase-5-sprint-1-ui

**实现内容**:

1. **增强 RSS 验证器** ✅
   - 扩展 `FeedMetadata` 类型添加完整元数据字段
   - `RSSValidator` 提取：语言、分类、发布日期、条目数、生成器
   - 新增 `validateURL()` 方法从网络获取并验证 RSS

2. **优化源列表 UI** ✅
   - 三行布局：
     * 第一行：RSS/ATOM 徽章（#FF6600 橙色+白字） + 标题链接
     * 第二行：元数据（📅 发布日期 | 🏷️ 分类 | 🌐 语言 | 📄 条目数）
     * 第三行：来源信息 + 订阅来源标签 + 操作按钮
   - 标题格式：`RSS标题 - 域名`

3. **订阅来源追踪** ✅
   - `DiscoveredFeed` 新增 `subscriptionSource` 字段
   - 三种来源：`discovered`（自动发现）| `manual`（手动订阅）| `imported`（OPML导入）
   - UI 显示来源标签（绿色高亮）

4. **手动订阅功能** ✅
   - 输入框 + 订阅按钮
   - URL 验证和去重
   - 自动提取完整元数据
   - 直接加入订阅列表（标记 `manual`）

5. **OPML 导入功能** ✅
   - 创建 `OPMLImporter.ts` 工具类
   - 支持解析 OPML XML 格式
   - 批量导入并订阅（标记 `imported`）
   - 显示导入结果统计

6. **数据流程完善** ✅
   - `background.ts` 使用验证结果的元数据
   - 标题组合：`RSS标题 - 源域名`
   - 保存完整元数据到数据库
   - 订阅来源自动标记

**技术指标**:
- 新增文件: `OPMLImporter.ts` (150 行)
- 修改文件: `RSSValidator.ts`, `types.ts`, `FeedManager.ts`, `RSSManager.tsx`, `background.ts`
- 构建成功: 2117ms
- 类型检查: 通过

**用户体验提升**:
- ✅ RSS 列表显示更多有用信息（语言、分类、条目数）
- ✅ 橙色 RSS 徽章更符合行业标准
- ✅ 可追溯订阅来源（发现 vs 手动 vs 导入）
- ✅ 支持从其他阅读器迁移（OPML 导入）
- ✅ 手动添加源的快速入口

##### 5.1.7 国际化集成与测试 ✅ (已完成)

**完成日期**: 2025-11-10
**分支**: feature/phase-5-sprint-1-ui
**提交**: 3e41bc8

**实现内容**:

1. **RSSManager 组件国际化** ✅
   - 导入 react-i18next 的 `useTranslation` hook
   - 所有硬编码中文文本替换为 `_()` 函数调用
   - 支持中英双语动态切换
   - 国际化覆盖率 100%

2. **翻译文件更新** ✅
   - 新增 27 个翻译 key：
     * `loading`, `discoveredFrom`, `subscribedAt`
     * `discoveredFeeds`, `subscribedFeeds`, `ignoredFeeds`
     * `clickToToggle`, `expand`, `collapse`
     * 9 种语言名称（en, ja, ko, fr, de, es, ru, pt, it）
     * 错误消息：`validationFailed`, `subscribeFailed`, `importFailed`
     * 成功消息：`importedWithErrors`
   - DeepSeek API 自动翻译成英文
   - 翻译质量验证通过

3. **OPML 导入器单元测试** ✅
   - 12 个测试用例全部通过
   - 测试覆盖：
     * 标准 OPML 解析
     * 带分类/描述的 OPML
     * 嵌套分类处理
     * title/text 属性优先级
     * 特殊字符处理
     * UTF-8 编码支持
     * 错误处理
   - 测试通过率: 100% (12/12)

**技术指标**:
- 新增测试文件: `OPMLImporter.test.ts` (180 行)
- 修改文件: `RSSManager.tsx`, `zh-CN/translation.json`, `en/translation.json`
- 新增翻译: 27 keys (zh-CN) + 27 keys (en)
- 构建成功: 2332ms
- 类型检查: 通过
- 测试通过: 12/12

**质量保证**:
- ✅ 组件支持多语言
- ✅ 翻译完整无遗漏
- ✅ OPML 解析器稳定可靠
- ✅ 代码风格一致

#### Sprint 1 总结

**完成功能**:
1. ✅ RSS 检测器（Content Script）
2. ✅ RSS 验证器（支持 RSS 2.0/Atom 1.0）
3. ✅ 发现源数据模型（discoveredFeeds 表）
4. ✅ RSS 管理器 UI（完整的订阅管理界面）
5. ✅ 手动订阅功能
6. ✅ OPML 导入/导出功能
7. ✅ 国际化集成（27 个新翻译 key）
8. ✅ 单元测试（OPMLImporter 12/12 + 其他测试）

**技术指标**:
- 新增文件: 6 个核心文件
- 新增测试: 52 个（14+17+9+12）
- 测试通过: 565/565 (100%)
- 覆盖率: 80.97%
- 代码行数: +1500 行

**用户价值**:
- ✅ 可以手动添加 RSS 源
- ✅ 可以导入 OPML 订阅列表
- ✅ 可以查看发现的 RSS 源
- ✅ 可以管理订阅状态（订阅/忽略/删除）
- ✅ 支持中英文界面

**已合并到 master** ✓

---

### Phase 5 Sprint 2: RSS 内容抓取与质量分析 ✅ (已完成)

**目标**: 实现 RSS 内容抓取和质量评估系统
**完成日期**: 2025-11-11
**分支**: feature/phase-5-sprint-2-fetcher
**用时**: 2 天

#### 完成成果

**核心功能**:
- ✅ RSS 抓取器（RSSFetcher）- 支持 RSS 2.0/Atom 1.0
- ✅ 质量分析器（FeedQualityAnalyzer）- 多维度评分系统
- ✅ FeedManager 集成 - 自动质量分析和缓存
- ✅ 后台自动分析 - 定时验证和自动清理
- ✅ UI 增强 - 质量分数显示、文章预览、删除功能
- ✅ 手动订阅优化 - 质量分析结果自动更新、成功反馈

**技术指标**:
- 新增测试: 54 个（14+20+20 FeedManager）
- 测试通过: 621/621 (100%)
- 覆盖率: 81.53% (行), 87.91% (函数)
- 构建成功: 3470ms
- 代码行数: +800 行

**用户体验提升**:
- ✅ 质量评分可视化（0-100分，颜色编码）
- ✅ 更新频率显示（篇/周）
- ✅ 文章预览功能（最新5篇）
- ✅ HTML 实体解码
- ✅ RSS/ATOM 格式徽章
- ✅ 忽略列表删除按钮
- ✅ 手动订阅成功提示
- ✅ 质量分析结果自动刷新

#### 核心任务

##### 5.2.1 RSS 抓取器 ✅
**文件**: `src/core/rss/RSSFetcher.ts`

**功能**:
- Background 抓取 RSS 内容
- 解析 RSS/Atom XML
- 提取文章列表（最新 5-10 篇）
- 错误处理和重试
- 超时控制（10秒默认）

**验收标准**:
- ✅ 成功抓取 RSS 内容（15 个测试）
- ✅ 解析文章列表（支持 content:encoded, dc:creator）
- ✅ 处理网络错误和超时
- ✅ 有测试覆盖（90.9% 语句覆盖率）

##### 5.2.2 内容质量分析器 ✅
**文件**: `src/core/rss/FeedQualityAnalyzer.ts`

**功能**:
- 更新频率检测（基于发布时间）
- RSS 格式规范性检查
- 可达性检测
- 质量评分（0-100）

**验收标准**:
- ✅ 正确计算更新频率（20 个测试）
- ✅ 检测格式问题
- ✅ 评分算法合理
- ✅ 有完整测试覆盖（100% 语句覆盖率）

**质量评分算法**:
```typescript
质量分数 = (
  更新频率得分 (40%) +
  内容完整度得分 (30%) +
  格式规范性得分 (20%) +
  可达性得分 (10%)
)

更新频率得分:
- 每天更新: 100 分
- 每周 3-7 次: 80 分
- 每周 1-2 次: 60 分
- 每月更新: 40 分
- 更新不规律: 20 分

内容完整度:
- 有标题+描述+链接: 100 分
- 缺少描述: 80 分
- 缺少内容: 60 分
```

##### 5.2.3 FeedManager 集成 ✅
**文件**: `src/core/rss/managers/FeedManager.ts`

**功能**:
- `analyzeFeed(id, forceRefresh)` - 单个源分析，24h 缓存
- `analyzeCandidates(limit)` - 批量分析，最多5个并发
- `getFeed(id)` - 获取源信息（用于轮询）
- 质量数据缓存机制

**验收标准**:
- ✅ 分析结果正确保存（20 个测试）
- ✅ 缓存机制有效（避免重复分析）
- ✅ 批量分析限流（并发控制）
- ✅ 错误处理完善

##### 5.2.4 后台自动分析 ✅
**文件**: `src/background.ts`

**功能**:
- RSS 发现后自动触发质量分析
- 分析失败自动删除源
- 定时重新验证忽略的源

**验收标准**:
- ✅ 发现后自动分析
- ✅ 质量为0时自动删除
- ✅ 异常时自动清理
- ✅ 日志完整

##### 5.2.5 UI 增强 ✅
**文件**: `src/components/settings/RSSManager.tsx`

**功能**:
- 质量分数显示（颜色编码：绿/黄/红）
- 更新频率显示
- 文章预览（展开/折叠）
- HTML 实体解码
- RSS/ATOM 格式徽章
- 忽略列表删除按钮
- 手动订阅成功提示
- 质量分析结果自动刷新

**验收标准**:
- ✅ 质量分数可视化
- ✅ 文章预览功能
- ✅ 删除操作正常
- ✅ 手动订阅体验优化
- ✅ 响应式设计

#### Sprint 2 开发总结

**第 1 天**: RSS 抓取器
- ✅ 创建 `RSSFetcher.ts` 核心类
- ✅ 实现 fetch 和 parse 方法
- ✅ 编写单元测试（15 个测试用例）
- ✅ 浏览器测试验证

**第 2 天**: 质量分析器 + 集成
- ✅ 创建 `FeedQualityAnalyzer.ts`
- ✅ 实现更新频率计算算法
- ✅ 实现质量评分系统
- ✅ FeedManager 集成
- ✅ Background 集成
- ✅ UI 增强
- ✅ 编写测试（20+20 个测试用例）

**验收标准**:
- ✅ 所有测试通过（621/621）
- ✅ 覆盖率 ≥ 70%（实际 81.53%）
- ✅ 构建成功
- ✅ 用户体验优化完成

**技术亮点**:
1. **智能缓存**: 24小时缓存避免重复分析
2. **并发控制**: 批量分析最多5个并发
3. **自动清理**: 失败源自动删除
4. **质量可视化**: 直观的评分显示
5. **用户反馈**: 成功/失败提示完善

**已完成的改进**:
- ✅ 自动删除策略（代替忽略）
- ✅ HTML 实体解码
- ✅ RSS/ATOM 按钮重新设计
- ✅ 手动订阅质量分析
- ✅ OPML 导入质量分析
- ✅ 忽略列表删除功能
- ✅ 手动订阅成功提示
- ✅ 质量分析结果自动刷新

---

### Phase 5 Sprint 3: UI 增强与自动化 ✅ (已完成)

**目标**: 完善 RSS 管理 UI，显示质量和相关性信息
**预计时间**: 2 天
**实际时间**: 2 天
**完成时间**: 2025-11-11
**PR**: #13

#### 核心任务

##### 5.3.1 RSS 管理页面增强 ✅ (已完成)
**文件**: `src/components/settings/RSSManager.tsx`

**功能**:
- 设置页"RSS 源"标签
- 三个列表展示：
  1. **已订阅源**（可开启/暂停/取消订阅）
  2. **发现的源**（可订阅/忽略）
  3. **忽略的源**（可订阅/删除）

**实际实现**:
- ✅ 三行紧凑布局（信息密度提升 25%）
- ✅ 文本图标系统（替代 emoji，兼容性更好）
- ✅ 智能时间计算（下次抓取预测）
- ✅ 按钮分行显示（提升操作清晰度）
- ✅ 质量文本标签（优质/中等/较低）
- ✅ 订阅来源标识（手动/导入/发现）

**UI 改进**:
```
第一行：RSS 属性
  [RSS/ATOM] [语言] 标题 [质量] [类别]

第二行：订阅/发现信息 + 主要操作
  📌/🔍 时间信息 • 来源标签 • 状态 [按钮组]

第三行：统计信息 + 次要操作
  已订阅：📰 数量 • ⏱️ 时间 • 📊 频率
  候选/忽略：📄 发现时条目数 • 📊 预估频率
```

**验收标准**:
- [x] 三个列表正常显示
- [x] 显示质量评分（文本标签）
- [x] 显示文章统计（总数、未读数）
- [x] 显示时间信息（订阅、发现、上次抓取、下次抓取）
- [x] 订阅/取消订阅操作正常
- [x] 源状态切换（开启/暂停）
- [x] 响应式设计
- [x] 明暗主题适配

**业务逻辑优化**:
- ✅ 取消订阅 → 忽略列表（而非候选列表）
- ✅ 订阅列表移除删除按钮（只能取消订阅）
- ✅ 发现/忽略列表显示发现时条目数和预估频率

##### 5.3.2 OPML 导出功能 ⏸️ (待开始)
**文件**: `src/core/rss/OPMLImporter.ts` (已实现导入，待添加导出)

**功能**:
- ✅ OPML 导入（已完成）
- [ ] OPML 导出（待实现）
- [ ] 导出所有已订阅源
- [ ] 导出时保留分类信息

**验收标准**:
- [ ] OPML 导出成功
- [ ] 导出文件格式正确
- [ ] 可被其他 RSS 阅读器导入

##### 5.3.3 Popup 推荐提示 ⏸️ (待开始)
**文件**: `src/popup.tsx`

**功能**:
- 显示发现的推荐源数量
- 点击跳转到设置页
- 非侵入式设计

**UI 设计**:
```
┌─────────────────────────────┐
│  📰 发现 2 个相关 RSS 源     │
│                              │
│  • TechCrunch (技术 85%)     │
│  • Hacker News (技术 78%)    │
│                              │
│  [查看详情]  [稍后]          │
└─────────────────────────────┘
```

**验收标准**:
- [ ] 显示推荐源提示
- [ ] 点击跳转正常
- [ ] 稍后功能正常

##### 5.3.4 后台调度器 ✅ (已完成)
**文件**: `src/background/feed-scheduler.ts`

**功能**:
- 定时抓取订阅源（6-24 小时，根据更新频率）
- 智能调度策略
- 更新文章数和未读数

**智能调度算法**:
```typescript
frequency >= 7 篇/周 → 6 小时间隔
frequency 3-6 篇/周 → 12 小时间隔
frequency 1-2 篇/周 → 24 小时间隔
frequency < 1 篇/周 → 不自动抓取
```

**数据模型扩展**:
- ✅ `isActive`: 启用状态（替代 `enabled`）
- ✅ `lastFetchedAt`: 最后抓取时间戳
- ✅ `articleCount`: 文章总数
- ✅ `unreadCount`: 未读数量

**验收标准**:
- [x] 根据更新频率调整抓取间隔
- [x] 暂停的源跳过抓取
- [x] 抓取后更新文章数和未读数
- [x] 性能优化（避免频繁抓取）
- [x] 所有测试通过

**测试覆盖**:
- ✅ 所有测试通过（621/621, 100%）
- ✅ 覆盖率达标：行 80.59%, 分支 87.14%

---

### Phase 5 Sprint 4: 图标系统重新设计 ✅ (已完成)

#### 目标
重新设计扩展图标系统,采用 PNG 组件化方案,支持高DPI屏幕和多种动态状态

#### 背景
原有的徽章(badge)方案存在以下问题:
- 32×32 图标在高DPI屏幕上模糊
- 徽章数字不够直观,信息传递不清晰
- 缺乏动态反馈,用户感知不强
- 难以表达复杂状态(如学习进度、RSS发现等)

#### 核心功能

##### 5.4.1 图标组合引擎 ✅
**文件**: `src/utils/IconComposer.ts` (331行)

**功能**:
- PNG 图片预加载(5个文件,128×128)
- 使用 OffscreenCanvas 进行图层叠加
- 实现 Canvas 特效:
  - 灰度滤镜(暂停状态)
  - 透明度控制(呼吸动画)
  - 垂直遮罩(学习进度)
  - 红色叠加(错误状态)
- 支持强制刷新图片缓存

**PNG 资源** (`assets/icons/128/`):
- `base-static.png` - 橙色背景 + 白色圆点 + 3条灰白波纹
- `base-paused.png` - 灰色背景(暂停状态专用)
- `overlays/wave-1-lit.png` - 第1条波纹点亮
- `overlays/wave-2-lit.png` - 第2条波纹点亮
- `overlays/wave-3-lit.png` - 第3条波纹点亮
- `overlays/learning-mask.png` - 学习进度圆角遮罩

**技术亮点**:
- 使用 ffmpeg Lanczos3 算法预缩放,保证图标质量
- ImageBitmap 预加载,避免重复解码
- OffscreenCanvas 在 Service Worker 中渲染,不阻塞主线程

**测试**: `src/utils/IconComposer.test.ts` (395行, 27个测试)
- ✅ 图片预加载测试
- ✅ 状态组合测试
- ✅ 滤镜效果测试
- ✅ 遮罩绘制测试
- ✅ 资源清理测试
- ✅ 覆盖率: 92.78% (行), 88.13% (函数)

##### 5.4.2 图标状态管理器 ✅
**文件**: `src/utils/IconManager.ts` (333行)

**功能**:
- 状态优先级调度系统
- 动画生命周期管理
- 与 chrome.action API 集成
- 支持状态叠加(如错误状态可叠加到任何状态)

**状态优先级** (从高到低):
1. `discover` - RSS 发现动画(最高优先级)
2. `paused` - 暂停状态
3. `fetching` - 后台抓取
4. `recommend` - 推荐阅读
5. `learning` - 学习进度
6. `static` - 静态图标

**动画控制**:
- RSS 发现: 4帧动画(0→1→2→3波纹),每帧500ms,循环3次,总时长6秒
- 后台抓取: 三波纹呼吸,1.5秒周期,透明度0.2-1.0
- 错误状态: 红色背景闪动,1秒周期,透明度0.2-0.6

**测试**: `src/utils/IconManager.test.ts` (369行, 20个测试)
- ✅ 初始化测试
- ✅ 状态更新测试
- ✅ 优先级调度测试
- ✅ 动画控制测试
- ✅ 资源清理测试
- ✅ 覆盖率: 92.13% (行), 80.64% (函数)

##### 5.4.3 图标状态展示 ✅

**学习进度状态** (0-1000页):
- 垂直遮罩从上到下填充
- 0页: 完全遮罩(灰色)
- 500页: 遮罩一半
- 1000页: 无遮罩(完全显示)

**推荐阅读状态** (1-3条):
- 根据推荐数量点亮对应数量的波纹
- 1条推荐: 点亮第1条波纹
- 2条推荐: 点亮前2条波纹
- 3条推荐: 点亮全部3条波纹

**RSS 发现动画**:
- 0波纹 → 1波纹 → 2波纹 → 3波纹
- 每帧500ms,循环3次
- 总时长6秒后自动停止

**后台抓取呼吸**:
- 三条波纹同时呼吸
- 1.5秒周期(从2秒优化)
- 透明度0.2-1.0(从0.3-1.0增强)

**错误状态**:
- 整个图标背景变红闪动
- 1秒周期,前500ms亮,后500ms暗
- 可叠加到任何状态上

**暂停状态**:
- 使用 base-paused.png 灰色背景
- 应用灰度滤镜
- 优先级高于推荐/抓取/学习

##### 5.4.4 Background 集成 ✅
**修改文件**: `src/background.ts`

**集成内容**:
- 在 Service Worker 启动时初始化 IconManager
- 监听各种事件并更新图标状态:
  - 学习进度变化 → 更新 learning 状态
  - 新推荐产生 → 更新 recommend 状态
  - RSS 发现成功 → 启动 discover 动画
  - 后台抓取开始 → 启动 fetching 呼吸
  - 错误发生 → 显示 error 闪动
  - 用户暂停 → 切换 paused 状态

#### 验收标准

**功能完成**:
- [x] IconComposer 实现并测试通过
- [x] IconManager 实现并测试通过
- [x] 6种图标状态全部实现
- [x] 动画效果流畅自然
- [x] 与 background 集成成功

**技术指标**:
- [x] 所有测试通过(669/669)
- [x] 覆盖率达标: 行 81.56%, 分支 87.67%
- [x] 核心模块覆盖率 >92%
- [x] 构建成功,无错误无警告

**用户价值**:
- [x] 图标在高DPI屏幕上清晰显示
- [x] 学习进度可视化(0-1000页渐进)
- [x] 推荐数量直观展示(1-3条波纹)
- [x] RSS发现有明确动画反馈(6秒)
- [x] 后台抓取有呼吸提示
- [x] 错误状态醒目提醒
- [x] 暂停状态明确区分

**代码质量**:
- [x] 清除所有调试日志
- [x] 删除无用资源(dot-pulse.png, error-badge.png)
- [x] TypeScript 严格模式
- [x] 完整的 JSDoc 注释
- [x] 遵循项目代码规范

#### 技术决策

**为什么选择 PNG 组件化?**
1. **灵活性**: 通过组合不同图层实现多种状态,而非预渲染所有组合
2. **可维护性**: 修改某个状态只需替换对应图层
3. **性能**: ImageBitmap 预加载,Canvas 合成速度快
4. **质量**: 128×128 原始素材,无运行时缩放损失

**为什么升级到 128×128?**
1. **高DPI支持**: Chrome 最大支持 128×128,在 Retina 屏幕上完美显示
2. **未来扩展**: 为更复杂的图标效果预留空间
3. **质量保证**: 使用专业算法预缩放,避免模糊

**为什么使用 OffscreenCanvas?**
1. **非阻塞**: 在 Service Worker 中渲染,不影响页面性能
2. **兼容性**: Chrome MV3 Service Worker 不支持普通 Canvas
3. **高效**: 直接操作 ImageData,无需 DOM

#### 开发时间
- **预估**: 4 小时
- **实际**: ~6 小时
- **主要时间消耗**:
  - 图标设计和素材准备: 1.5 小时
  - IconComposer 开发和测试: 2 小时
  - IconManager 开发和测试: 1.5 小时
  - 集成和调试: 0.5 小时
  - 浏览器测试和优化: 0.5 小时

#### 本阶段文档
- [x] 更新 `docs/DEVELOPMENT_PLAN.md`
- [ ] 更新 `docs/TDD.md` (补充图标系统设计)
- [x] 完整的代码注释和 JSDoc
- [x] 测试覆盖率报告

#### PR 信息
- ✅ **PR #14**: feat: 图标系统重新设计 - 升级到128×128高清图标与PNG组件化
- ✅ 16 个文件修改,1881 行新增代码
- ✅ 所有测试通过,覆盖率达标
- ✅ 浏览器测试通过

---

### Phase 5 完成标准

**功能完成度**:
- [x] Sprint 1: RSS 检测与基础 UI ✅
- [x] Sprint 2: 内容抓取与质量分析 ✅
- [x] Sprint 3: UI 增强与自动化 ✅

**技术指标**:
- [x] 所有测试通过（621/621）
- [x] 覆盖率 ≥ 70%（行 80.59%, 分支 87.14%）
- [x] 构建成功
- [ ] 浏览器实测通过 ⏸️

**用户价值**:
- [x] 可以管理 RSS 订阅
- [x] 可以查看源质量评分
- [x] 可以预览文章内容
- [x] 可以手动订阅和 OPML 导入
- [x] 智能时间显示和抓取预测
- [x] 紧凑清晰的三行布局
- [ ] 自动发现相关 RSS 源
- [ ] 智能推荐优质源
- [ ] 自动抓取和更新

---

### 本阶段文档
- [ ] `docs/PHASE_5_RSS_DISCOVERY.md` - 详细设计文档
- [x] 更新 `docs/DEVELOPMENT_PLAN.md` (Sprint 1 完成)
- [ ] 更新 `docs/TDD.md`

---

## 阶段 6: AI 推荐引擎 (预计 4-6 天) ⏸️

### 目标
实现基于用户画像的智能推荐系统

### 功能列表

#### 6.1 推荐算法引擎
**文件**: `src/core/recommender/RuleBasedRecommender.ts`

**功能**:
- TF-IDF 相似度匹配
- 时效性评分
- 预筛选算法

#### 6.2 AI 适配器
**文件**: `src/core/ai/AIAdapter.ts`

**功能**:
- 支持 OpenAI API
- 支持 Anthropic API
- 支持 DeepSeek API
- Prompt 工程

#### 6.3 推荐展示
**更新**: `src/popup.tsx`

**功能**:
- 显示推荐列表
- 显示推荐理由
- 反馈按钮 (喜欢/忽略/稍后)

### 本阶段文档
- [ ] `docs/PHASE_6_RECOMMENDATION.md`

---

## 阶段 7: 系统优化与重构 ✅ (已完成)

**目标**: 优化系统架构，提升代码质量

**完成日期**: 2025-11-18
**分支**: feature/phase-7-optimization
**PR**: 待创建

### Bug 修复 ✅

根据 `docs/bugs` 文件修复了以下问题：

#### 7.1 降低学习阈值 ✅
- 冷启动学习页面数从 1000 页降低到 100 页
- 新增 `src/constants/progress.ts` 统一管理阈值常量
- 更新相关文档和翻译文件
- 修改文件: 28 个

#### 7.2 推荐任务定时执行 ✅
- 添加 Chrome Alarms API 每 20 分钟自动生成推荐
- 仅在学习期完成后执行（页面数 ≥ 100）
- 修改文件: `src/background.ts`

#### 7.3 推理日志优化 ✅
- DeepSeek Reasoner 推理日志只输出长度，不输出完整内容
- 减少日志噪音，提升可读性
- 修改文件: `src/core/ai/providers/DeepSeekReasonerProvider.ts`

#### 7.4 目录结构分析 ✅
- 分析了 `src/storage` 和 `src/stores` 的职责分工
- 确认设计合理，无需合并
- 文档记录: `docs/bugs`

### 系统重构 ✅

#### 7.5 类型系统重构 ✅
- 将分散的类型定义迁移到 `src/types/` 目录统一管理
- 新增文件：
  - `ai.ts` - AI 相关类型
  - `ai-strategy.ts` - AI 策略类型
  - `analyzer.ts` - 分析器类型
  - `config.ts` - 配置类型
  - `database.ts` - 数据库类型
  - `extractor.ts` - 提取器类型
  - `profile.ts` - 用户画像类型
  - `recommendation.ts` - 推荐类型
  - `rss.ts` - RSS 类型
- 删除冗余类型定义，提升可维护性

#### 7.6 错误处理增强 ✅
- 新增 `src/utils/error-handler.ts` 统一错误处理机制
- 完整的单元测试覆盖（316 个测试用例）
- 测试文件: `src/utils/error-handler.test.ts`

#### 7.7 日志系统统一 ✅
- 17 个文件迁移到新的 Logger 工具
- 统一日志格式和级别管理
- 环境感知日志（开发/生产模式）

### 技术指标

**代码变更**:
- 103 个文件变更
- +2605 行添加
- -2373 行删除

**测试质量**:
- 879 个测试全部通过 ✅
- 覆盖率达标
- TypeScript 编译无错误

**提交历史**:
- 19 个提交
- 包含 bug 修复和系统重构

### PR 信息

- **标题**: Phase 7 优化：降低学习阈值、完善推荐机制和统一日志系统
- **描述**: 修复 4 个 bug + 类型系统重构 + 错误处理增强 + 日志系统统一
- **状态**: 待创建

### 本阶段文档
- [x] 更新 `docs/DEVELOPMENT_PLAN.md`
- [x] 更新 `docs/bugs`（标记所有 bug 已完成）
- [ ] 更新 `docs/TDD.md`（补充系统架构变更）

---

## 阶段 8: AI 画像系统与推荐精准度优化 ✅ (已完成)

**目标**: 实现 AI 画像生成、兴趣演化追踪和推荐精准度优化

**完成日期**: 2025-11-25
**分支**: feature/semantic-profile
**PR**: [#35](https://github.com/wxy/SilentFeed/pull/35)

**预计时间**: 4-6 天
**实际时间**: 6 天

---

### Phase 8.1: AI 画像生成与管理 ✅ (已完成)

**目标**: 建立 AI 驱动的用户画像系统

#### 8.1.1 AI 画像生成 ✅
**文件**: `src/core/profile/ProfileManager.ts`, `src/core/profile/SemanticProfileBuilder.ts`

**功能**:
- ✅ AI 画像自动生成（支持 DeepSeek/OpenAI）
- ✅ 智能触发机制（≥10 页 OR ≥3 阅读 OR ≥3 拒绝）
- ✅ 画像数据结构完善（摘要、主题、兴趣点）
- ✅ 错误处理和降级机制
- ✅ 概率云合并算法

**验收标准**:
- ✅ AI 画像自动触发生成
- ✅ 生成完整的兴趣摘要
- ✅ 提取主要主题和兴趣点
- ✅ 降级到关键词画像
- ✅ 有完整测试覆盖

#### 8.1.2 画像数据模型 ✅
**文件**: `src/types/profile.ts`, `src/storage/db.ts`

**数据模型**:
```typescript
interface UserProfile {
  id: string  // 'singleton'
  totalPages: number
  totalDwellTime: number
  topics: Record<Topic, number>  // 主题权重分布
  keywords: Record<string, number>  // 关键词权重
  
  // AI 画像（可选）
  aiProfile?: {
    summary: string  // 兴趣摘要（100-200字）
    topics: Topic[]  // AI 识别的主导主题
    interests: string[]  // 具体兴趣点
    generatedAt: number
    provider: 'deepseek' | 'openai'
    cost: number  // 成本追踪
  }
  
  createdAt: number
  updatedAt: number
}
```

**验收标准**:
- ✅ 数据模型定义完整
- ✅ 数据库表创建成功
- ✅ CRUD 操作正常
- ✅ 类型安全保证

---

### Phase 8.2: 兴趣演化追踪 + 配色优化 ✅ (已完成)

**目标**: 追踪用户兴趣变化，优化 UI 配色

**完成日期**: 2025-11-24
**提交**: 7b4437b, 之前多个提交

#### 8.2.1 兴趣快照系统 ✅
**文件**: `src/core/profile/InterestSnapshotManager.ts`, `src/storage/db.ts`

**功能**:
- ✅ 兴趣快照记录（`interestSnapshots` 表）
- ✅ 主导兴趣检测（绝对/相对/显著领先）
- ✅ 变化触发机制
  - 首次创建画像
  - 主导兴趣变化
  - 用户主动重建
  - AI 画像首次生成
- ✅ 变化历史查询

**主导兴趣计算策略**:
```typescript
1. 绝对主导（Absolute）: 分数 > 33.3%
2. 相对主导（Relative）: 分数 > 20% 且比第二名多 50%+
3. 显著领先（Significant）: 分数 > 25% 且比平均值高 2 倍+
```

**验收标准**:
- ✅ 检测主导兴趣变化
- ✅ 记录快照完整信息
- ✅ 变化历史正确排序
- ✅ 有完整测试覆盖（16 个测试）

#### 8.2.2 UI 配色优化 ✅
**文件**: `src/options.tsx`, Tailwind 配置

**优化内容**:
- ✅ 深色模式背景柔和（zinc-900 → slate-900）
- ✅ 卡片对比度降低（zinc-800 → slate-800/700）
- ✅ 文字颜色优化（gray-300 → slate-300）
- ✅ 强调色统一（blue-500 系列）
- ✅ 边框颜色调整（slate-700/600）

**设计理念**:
- 克制设计，避免过度对比
- 舒适的长时间阅读体验
- 深浅模式一致性

**验收标准**:
- ✅ 深色模式更柔和
- ✅ 视觉层次清晰
- ✅ 无刺眼对比
- ✅ 响应式设计良好

#### 8.2.3 AI 画像演化追踪展示 ✅
**文件**: `src/components/settings/ProfileSettings.tsx`

**功能**:
- ✅ 显示主导兴趣变化历史
- ✅ 时间轴展示
- ✅ 变化原因说明
- ✅ 主导级别标识（绝对/相对/显著）
- ✅ AI 摘要对比

**验收标准**:
- ✅ 演化历史正确显示
- ✅ 时间格式化友好
- ✅ 变化原因清晰
- ✅ 响应式设计

---

### Phase 8.3: AI 推荐精准度优化 ✅ (已完成)

**目标**: 提升 AI 推荐的实时性和准确性

**完成日期**: 2025-11-25
**提交**: 8a78b61
**PR**: [#35](https://github.com/wxy/SilentFeed/pull/35)

#### 核心改进

##### 8.3.1 用户行为立即反馈机制 ✅
**文件**: `src/core/profile/ProfileUpdateScheduler.ts`, `src/storage/db.ts`

**功能**:
- ✅ 添加 `forceUpdateProfile(trigger: string)` 方法
- ✅ 用户阅读推荐后立即触发画像更新
- ✅ 用户拒绝推荐后立即触发画像更新
- ✅ 防止并发更新冲突（`isUpdating` 检查）
- ✅ 详细日志记录用户行为触发点

**实现细节**:
```typescript
// ProfileUpdateScheduler.ts
static async forceUpdateProfile(trigger: string): Promise<void> {
  console.log(`[ProfileScheduler] 🚀 用户行为触发立即更新: ${trigger}`)
  
  if (this.schedule.isUpdating) {
    console.log('[ProfileScheduler] ⏭️ 画像正在更新中，跳过本次触发')
    return
  }
  
  await this.executeUpdate(trigger)
}

// db.ts - markAsRead()
ProfileUpdateScheduler.forceUpdateProfile('user_read').catch(error => {
  dbLogger.error('❌ 用户阅读后画像更新失败:', error)
})

// db.ts - dismissRecommendations()
ProfileUpdateScheduler.forceUpdateProfile('user_dismiss').catch(error => {
  dbLogger.error('❌ 用户拒绝后画像更新失败:', error)
})
```

**效果对比**:
| 指标 | 优化前 | 优化后 | 提升 |
|-----|-------|-------|------|
| 反馈生效时间 | 6-24 小时 | < 1 秒 | **99.9%+** ⚡ |
| 推荐精准度 | 滞后反映变化 | 实时响应 | **显著提升** ✨ |

**验收标准**:
- ✅ 用户阅读后画像立即更新
- ✅ 用户拒绝后画像立即更新
- ✅ 并发控制正确
- ✅ 错误处理完善
- ✅ 所有测试通过

##### 8.3.2 降低 AI 画像生成门槛 ✅
**文件**: `src/core/profile/ProfileManager.ts`

**调整内容**:
- ✅ 页面访问门槛：~~20 页~~ → **10 页**
- ✅ 阅读行为门槛：~~5 次~~ → **3 次**
- ✅ 拒绝行为门槛：~~5 次~~ → **3 次**

**代码变更**:
```typescript
// 修改前
const shouldGenerate = 
  totalPages >= 20 ||   
  readCount >= 5 ||     
  dismissCount >= 5

// 修改后
const shouldGenerate = 
  totalPages >= 10 ||   // 浏览 ≥10 页（降低门槛：更快生成 AI 画像）
  readCount >= 3 ||     // 阅读 ≥3 篇（降低门槛）
  dismissCount >= 3     // 拒绝 ≥3 篇（降低门槛）
```

**效果**:
- ✅ 新用户更快体验 AI 推荐功能
- ✅ AI 画像生成触发更灵敏
- ✅ 减少冷启动等待时间

**验收标准**:
- ✅ 门槛值正确修改
- ✅ 触发逻辑正常工作
- ✅ 所有测试通过

---

### Phase 8 完成总结

**核心功能**:
- ✅ AI 画像生成与管理（Phase 8.1）
- ✅ 兴趣演化追踪系统（Phase 8.2）
- ✅ UI 配色优化（Phase 8.2）
- ✅ 推荐精准度优化（Phase 8.3）⭐

**技术指标**:
- ✅ 测试通过：1193/1194 (99.9%)
- ✅ 覆盖率达标：行 74.86% | 函数 75.89% | 分支 66.57%
- ✅ 生产构建成功
- ✅ CI 检查通过

**用户价值**:
- ✅ AI 驱动的个性化画像
- ✅ 兴趣变化可视化追踪
- ✅ 舒适的深色模式体验
- ✅ **实时响应用户偏好**（Phase 8.3）⚡
- ✅ **更快体验 AI 推荐**（Phase 8.3）🚀

**代码变更**:
- 新增文件：InterestSnapshotManager.ts, SemanticProfileBuilder.ts
- 修改文件：ProfileManager.ts, ProfileUpdateScheduler.ts, db.ts, ProfileSettings.tsx
- 新增测试：InterestSnapshotManager.test.ts (16 个)
- 总代码行数：+1200 行

**PR 信息**:
- **PR #35**: feat(Phase 8): AI 画像系统 + 精准度优化
- **包含功能**：
  - Phase 8.1: AI 画像生成与管理
  - Phase 8.2: 兴趣演化追踪 + 配色优化
  - Phase 8.3: AI 推荐精准度优化（新增）⭐
- **状态**: 已提交，CI 运行中

### 本阶段文档
- ✅ `docs/PHASE_8.2_COMPLETION.md` - Phase 8.2 完成总结
- ✅ `docs/PHASE_8.2c_HORIZONTAL_CARD_DESIGN.md` - 横向卡片设计方案
- ✅ 更新 `docs/DEVELOPMENT_PLAN.md`
- [ ] 更新 `docs/TDD.md`

---

## 阶段 9: 优化与发布 (预计 3 小时) ⏸️

### 目标
完善体验，准备发布

### 功能列表

#### 9.1 性能优化
- 批量处理
- 缓存策略
- 懒加载

#### 9.2 用户引导
- 首次使用教程
- 帮助文档
- 反馈渠道

#### 9.3 Chrome Web Store 准备
- 截图和宣传图
- 商店描述
- 隐私政策

### 本阶段文档
- [ ] `docs/PHASE_9_POLISH.md`
- [ ] `docs/PUBLISHING.md`

---

## 开发节奏建议

### 每个阶段的流程

1. **开始前** (5 分钟)
   - 阅读阶段文档
   - 创建功能分支: `git checkout -b feature/phase-N`

2. **开发中** (主要时间)
   - 编写测试 (TDD)
   - 实现功能
   - 频繁提交: `git commit -m "feat: xxx"`

3. **完成后** (10 分钟)
   - 运行测试: `npm test`
   - 检查覆盖率: `npm run test:coverage`
   - 更新文档
   - 合并到 master: `git merge feature/phase-N`
   - 推送: `git push`

### 每日开发建议

- **每次 1-2 小时**: 完成一个小功能
- **立即验证**: 在浏览器中测试
- **及时提交**: 不积累太多未提交代码

---

## 当前状态

- ✅ **阶段 0**: 基础框架 (已完成)
- ✅ **阶段 1**: Hello World 扩展 (已完成) - **v0.1.0**
- ✅ **阶段 2**: 页面访问监听 (已完成) - **v0.2.7**
- ✅ **阶段 3**: 用户画像构建 (已完成) - **v0.3.4**
- ✅ **阶段 4**: AI 能力集成 (已完成) - **v0.4.0 / PR #8**
- ✅ **阶段 5**: RSS 自动发现与智能订阅 (已完成) - **PR #13, #14**
  - ✅ Sprint 1: RSS 基础设施与 UI
  - ✅ Sprint 2: 内容抓取与质量分析
  - ✅ Sprint 3: UI 优化与智能调度
  - ✅ Sprint 4: 图标系统重新设计
- ✅ **阶段 7**: 系统优化与重构 (已完成) - **PR 待创建**
  - ✅ Bug 修复（4 个）
  - ✅ 类型系统重构
  - ✅ 错误处理增强
  - ✅ 日志系统统一
- ✅ **阶段 8**: AI 画像系统与推荐精准度优化 (已完成) - **PR #35** 🎉
  - ✅ Phase 8.1: AI 画像生成与管理
  - ✅ Phase 8.2: 兴趣演化追踪 + 配色优化
  - ✅ Phase 8.3: AI 推荐精准度优化⭐
- ⏸️ **阶段 6**: AI 推荐引擎 (下一步)
- ⏸️ **阶段 9**: 通知机制与优化发布 (等待开始)

---

## 估计时间

| 阶段 | 预计时间 | 累计时间 | 状态 |
|------|---------|---------|------|
| 阶段 0 | 2 小时 | 2 小时 | ✅ |
| 阶段 1 | 1 小时 | 3 小时 | ✅ |
| 阶段 2 | 2 小时 | 5 小时 | ✅ (实际 ~5 小时) |
| 阶段 3 | 3 小时 | 8 小时 | ✅ (实际 ~4 小时) |
| 阶段 4 | 7 天 | 15 小时 | ✅ (实际 ~10 天, PR #8) |
| 阶段 5 | 6 小时 | 21 小时 | ✅ (实际 ~10 小时, PR #13, #14) |
| 阶段 7 | 4 小时 | 25 小时 | ✅ (实际 ~4 小时, 系统优化) |
| 阶段 8 | 4-6 天 | 31 小时 | ✅ (实际 ~6 天, PR #35) 🎉 |
| 阶段 6 | 5 天 | 36 小时 | ⏸️ (AI 推荐引擎) |
| 阶段 9 | 3 小时 | 39 小时 | ⏸️ (通知机制+优化发布) |

**MVP 总计**: 约 39 小时 (5-6 周业余时间)
**已完成**: 31 小时 (79%) 🎉

---

## 下一步

**Phase 8: AI 画像系统与推荐精准度优化 已完成！** ✅ 🎉

### Phase 8 完成总结

**核心成就**:
- ✅ AI 画像生成与管理（DeepSeek/OpenAI）
- ✅ 兴趣演化追踪系统（16 个测试）
- ✅ UI 配色优化（深色模式柔和化）
- ✅ **用户行为立即反馈**（6-24小时 → <1秒）⚡
- ✅ **降低 AI 画像门槛**（20/5/5 → 10/3/3）🚀

**技术指标**:
- 1193/1194 测试通过（99.9%）
- 覆盖率：行 74.86% | 函数 75.89% | 分支 66.57%
- 代码量：+1200 行
- PR #35: 已提交，CI 运行中

**突出亮点**:
- ⚡ **实时反馈**：用户阅读/拒绝后画像立即更新（< 1 秒）
- 🚀 **更快触发**：AI 画像生成门槛降低 50%
- 📊 **演化追踪**：完整的兴趣变化历史记录
- 🎨 **配色优化**：舒适的深色模式体验

### 当前待办事项

**Phase 8 收尾**:
1. ⏸️ 等待 PR #35 CI 通过
2. ⏸️ 浏览器测试验证用户反馈实时性
3. ⏸️ 合并到 master

### 下一个阶段: Phase 6 - AI 推荐引擎 🤖

**核心目标**: 基于用户画像智能推荐 RSS 文章

**主要功能**:
1. 🎯 **个性化推荐** - 基于用户画像的相关性匹配
2. 🔍 **TF-IDF 算法** - 关键词相似度计算
3. ⏰ **时效性评分** - 新鲜内容优先
4. 🤖 **AI 增强** - 生成推荐理由（可选）
5. 📱 **Popup 展示** - 推荐列表界面
6. 👍 **用户反馈** - 喜欢/忽略/稍后

**预计时间**: 4-6 天

**开发路径**:
1. 实现 TF-IDF 推荐算法（RuleBasedRecommender）
2. 集成用户画像匹配（ProfileManager）
3. 添加时效性评分（RecencyScorer）
4. AI 推荐理由生成（可选，使用现有 AICapabilityManager）
5. Popup 界面重构（推荐列表展示）
6. 用户反馈机制（更新画像）

**技术亮点**:
- 💡 **混合推荐**：TF-IDF（快速） + AI 分析（精准）
- 🔄 **实时更新**：用户反馈立即影响推荐（Phase 8.3 已实现）
- 📊 **质量优先**：结合 RSS 源质量评分
- ⚡ **性能优化**：批量处理 + 缓存机制
