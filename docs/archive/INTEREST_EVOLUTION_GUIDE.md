# 兴趣演化功能使用指南

## 📊 功能概述

兴趣演化功能会自动追踪用户的兴趣变化，在以下情况创建快照：

1. **首次创建画像** - 建立基准兴趣快照
2. **主导兴趣变化** - 当主要兴趣话题发生改变时（例如：技术 → 商业）
3. **手动重建画像** - 用户主动点击"重建画像"按钮时

## 🎨 展示设计

### 当前实现

- **展示位置**：设置页面 → 用户画像 → 底部
- **展示数量**：最近 **5 次**兴趣变化
- **视觉设计**：时间线形式，带渐变背景和动态标记
- **信息展示**：
  - 📅 变化时间
  - 📊 基于多少页面
  - ➡️ 兴趣转变（从 → 到）
  - 📝 变化描述

### 空状态提示

当没有兴趣变化时，会显示友好的空状态提示：
- 已有1个快照：提示继续浏览等待兴趣变化
- 没有快照：提示开始使用扩展

## 🧪 测试功能

### 方法 1：使用调试工具生成测试数据

我们提供了便捷的测试数据生成工具：

```typescript
// 1. 在浏览器控制台中运行
__generateInterestChanges(5)  // 生成5个兴趣变化快照

// 2. 清除测试数据
__clearInterestSnapshots()  // 清除所有快照

// 3. 重新生成新数据
__generateInterestChanges(3)  // 生成3个快照
```

### 方法 2：自然积累数据

正常使用扩展，浏览不同类型的页面：

1. **初期（技术类）**：浏览编程、开发相关页面
2. **过渡期**：开始浏览财经、商业类页面
3. **等待画像更新**：系统会定期更新画像（每天1次）
4. **查看变化**：当主导兴趣从"技术"变为"商业"时，会自动记录

## 📈 数据说明

### 快照创建逻辑

```typescript
// InterestSnapshotManager.handleProfileUpdate() 的判断逻辑：

1. 没有历史快照 → 创建首个快照
2. 主导兴趣发生变化 → 创建变化快照
3. 用户重建画像 → 创建重建快照
4. 其他情况 → 不创建快照（保持主导兴趣稳定）
```

### 主导兴趣判断标准

主导兴趣需要满足以下条件之一：
- **绝对主导**：分数 ≥ 0.35（35%）
- **相对主导**：分数 ≥ 0.25 且超过第二名 10%
- **领先主导**：分数最高且 > 0

## 🎯 使用建议

### 展示策略

当前的 **5条时间线** 设计适合大多数场景：
- ✅ 简洁不拥挤
- ✅ 关注最近变化
- ✅ 性能友好

### 可选增强（未来）

如果需要更丰富的展示，可以考虑：

1. **统计卡片**
   ```tsx
   - 总变化次数
   - 当前兴趣持续时间
   - 最稳定的兴趣话题
   ```

2. **可调节展示数量**
   ```tsx
   - 最近 5 次（默认）
   - 最近 10 次
   - 全部历史
   ```

3. **可视化图表**
   ```tsx
   - 兴趣分布饼图
   - 兴趣变化趋势线
   - 话题词云
   ```

## 🔧 开发调试

### 生成测试数据

```bash
# 1. 运行开发服务器
npm run dev

# 2. 加载扩展到浏览器
# 3. 打开浏览器控制台（F12）
# 4. 运行调试命令
__generateInterestChanges(5)
```

生成的数据模拟真实的兴趣演化路径：
```
技术 → 技术 → 商业 → 娱乐 → 技术
```

### 查看生成的数据

```typescript
// 在控制台中查看
const { getInterestHistory } = await import('./storage/db')
const history = await getInterestHistory(10)
console.table(history)
```

## 📝 相关代码

| 文件 | 说明 |
|------|------|
| `src/components/settings/UserProfileDisplay.tsx` | 兴趣演化展示 UI |
| `src/core/profile/InterestSnapshotManager.ts` | 快照管理逻辑 |
| `src/debug/generate-interest-changes.ts` | 测试数据生成工具 |
| `src/storage/db.ts` | 数据库操作 |

## ❓ 常见问题

### Q1: 为什么看不到兴趣演化历程？

**原因**：
- 只有 1 个快照（首次创建），需要至少 2 个才能显示"变化"
- 主导兴趣一直保持稳定，没有发生变化

**解决**：
- 继续浏览不同类型的页面，等待自动更新
- 使用 `__generateInterestChanges(5)` 生成测试数据

### Q2: 多久会更新一次画像？

**更新频率**：
- 定期更新：每天 1 次（ProfileUpdateScheduler）
- 手动更新：点击"重建画像"按钮
- 首次创建：安装后浏览 1000 页后

### Q3: 如何触发主导兴趣变化？

**方法**：
1. 集中浏览某一类型的页面（例如：财经）
2. 等待画像更新（或手动重建）
3. 系统检测到主导兴趣从旧话题变为新话题
4. 自动创建快照并记录变化

### Q4: 展示 5 条够用吗？

**设计考虑**：
- ✅ 用户主要关注最近的兴趣变化
- ✅ 5 条已经覆盖约 5 周的变化历史
- ✅ 避免信息过载，保持页面简洁
- 📊 如需更多，可以后续添加"查看全部"功能

## 🚀 快速开始

```bash
# 1. 生成测试数据
__generateInterestChanges(5)

# 2. 打开设置页面
# 点击扩展图标 → 设置 → 用户画像 → 滚动到底部

# 3. 查看兴趣演化历程
# 应该能看到 5 个兴趣变化的时间线

# 4. 清除数据（重新开始）
__clearInterestSnapshots()
```

## 📚 延伸阅读

- [PRD.md](./PRD.md) - 产品需求文档
- [TDD.md](./TDD.md) - 技术设计文档
- [TESTING.md](./TESTING.md) - 测试指南
