# Phase 5 Sprint 3: åå°å®šæ—¶æŠ“å–ä¸çŠ¶æ€ç®¡ç†

**ç›®æ ‡**: å®ç°æ™ºèƒ½ RSS å†…å®¹å®šæ—¶æŠ“å–å’Œè®¢é˜…æºçŠ¶æ€ç®¡ç†

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

---

## ğŸ“‹ æ ¸å¿ƒä»»åŠ¡

### 1. åå°å®šæ—¶è°ƒåº¦å™¨ âœ…

**æ–‡ä»¶**: `src/background/feed-scheduler.ts`

**åŠŸèƒ½**:
- æ™ºèƒ½è°ƒåº¦ç­–ç•¥ï¼ˆæ ¹æ®æ›´æ–°é¢‘ç‡ï¼‰
  - æ¯å¤©æ›´æ–°æº: 6 å°æ—¶æŠ“å–ä¸€æ¬¡
  - æ¯å‘¨ 3-7 æ¬¡: 12 å°æ—¶æŠ“å–ä¸€æ¬¡
  - æ¯å‘¨ 1-2 æ¬¡: 24 å°æ—¶æŠ“å–ä¸€æ¬¡
  - ä½é¢‘æº: ä¸è‡ªåŠ¨æŠ“å–ï¼ˆæ‰‹åŠ¨åˆ·æ–°ï¼‰
- æŠ“å–æ–°æ–‡ç« å¹¶ä¿å­˜åˆ°æ•°æ®åº“
- ç»Ÿè®¡æœªè¯»æ–‡ç« æ•°é‡
- æ›´æ–°æºçš„ `lastFetchedAt` å’Œ `articleCount`
- è·³è¿‡æš‚åœçš„æº

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ ¹æ®æ›´æ–°é¢‘ç‡è‡ªåŠ¨è°ƒåº¦
- [ ] æŠ“å–æˆåŠŸåæ›´æ–°æ•°æ®åº“
- [ ] è·³è¿‡ `isActive: false` çš„æº
- [ ] æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†
- [ ] æœ‰æµ‹è¯•è¦†ç›–

---

### 2. æ•°æ®æ¨¡å‹æ‰©å±• âœ…

**æ–‡ä»¶**: `src/storage/types.ts`, `src/storage/db.ts`

**æ–°å¢å­—æ®µ**:
```typescript
interface DiscoveredFeed {
  // ç°æœ‰å­—æ®µ...
  
  // æ–°å¢å­—æ®µ
  isActive: boolean              // æ˜¯å¦å¯ç”¨ï¼ˆé»˜è®¤ trueï¼‰
  lastFetchedAt?: number         // æœ€åæŠ“å–æ—¶é—´
  articleCount: number           // æ–‡ç« æ€»æ•°ï¼ˆé»˜è®¤ 0ï¼‰
  unreadCount: number            // æœªè¯»æ–‡ç« æ•°ï¼ˆé»˜è®¤ 0ï¼‰
  
  // æŠ“å–ç»“æœï¼ˆä» RSSFetcher è·å–ï¼‰
  latestArticles?: FeedArticle[] // æœ€æ–°æ–‡ç« åˆ—è¡¨
}

interface FeedArticle {
  id: string                     // å”¯ä¸€ IDï¼ˆURL hashï¼‰
  title: string
  link: string
  description?: string
  pubDate?: number
  author?: string
  isRead: boolean                // æ˜¯å¦å·²è¯»ï¼ˆé»˜è®¤ falseï¼‰
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ•°æ®åº“ç‰ˆæœ¬å‡çº§ï¼ˆv5 â†’ v6ï¼‰
- [ ] ç±»å‹å®šä¹‰å®Œæ•´
- [ ] é»˜è®¤å€¼æ­£ç¡®
- [ ] æœ‰æµ‹è¯•è¦†ç›–

---

### 3. è®¢é˜…æºçŠ¶æ€ç®¡ç† âœ…

**æ–‡ä»¶**: `src/core/rss/managers/FeedManager.ts`

**æ–°å¢æ–¹æ³•**:
```typescript
class FeedManager {
  /**
   * åˆ‡æ¢è®¢é˜…æºçš„å¯ç”¨çŠ¶æ€
   * @param feedId - æº ID
   * @returns æ–°çš„çŠ¶æ€
   */
  async toggleActive(feedId: string): Promise<boolean>
  
  /**
   * è·å–æ‰€æœ‰å¯ç”¨çš„è®¢é˜…æº
   */
  async getActiveSubscriptions(): Promise<DiscoveredFeed[]>
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] `toggleActive()` æ­£ç¡®åˆ‡æ¢çŠ¶æ€
- [ ] `getActiveSubscriptions()` åªè¿”å› `isActive: true` çš„æº
- [ ] æœ‰æµ‹è¯•è¦†ç›–

---

### 4. UI å¢å¼º - æŠ“å–ç»Ÿè®¡æ˜¾ç¤º âœ…

**æ–‡ä»¶**: `src/components/settings/RSSManager.tsx`

**æ–°å¢æ˜¾ç¤º**:
```
å·²è®¢é˜…æºåˆ—è¡¨ï¼š

XML/RSS  TechCrunch - techcrunch.com
ğŸ“… 2025-11-01 | ğŸ·ï¸ æŠ€æœ¯ | ğŸŒ è‹±æ–‡ | ğŸ“„ 10 æ¡
è´¨é‡: ğŸŸ¢ 85 åˆ† (ä¼˜è´¨) - 12 ç¯‡/å‘¨
ğŸ“° å…± 125 ç¯‡æ–‡ç« ï¼Œ5 ç¯‡æœªè¯» | æœ€åæŠ“å–: 2å°æ—¶å‰
æ¥æº: techcrunch.com | è®¢é˜…æ¥æº: æ‰‹åŠ¨è®¢é˜…
[æŸ¥çœ‹æœ€æ–°æ–‡ç«  â–¼] [â¸ æš‚åœ] [ğŸ—‘ åˆ é™¤]
```

**æ–°å¢åŠŸèƒ½**:
- æ˜¾ç¤ºæ–‡ç« ç»Ÿè®¡ï¼ˆæ€»æ•°ã€æœªè¯»æ•°ï¼‰
- æ˜¾ç¤ºæœ€åæŠ“å–æ—¶é—´ï¼ˆç›¸å¯¹æ—¶é—´ï¼‰
- å¼€å¯/æš‚åœæŒ‰é’®ï¼ˆâ¸/â–¶ï¼‰
- æš‚åœçš„æºæ˜¾ç¤ºç°è‰²æ ·å¼

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç»Ÿè®¡æ•°æ®æ­£ç¡®æ˜¾ç¤º
- [ ] æš‚åœ/æ¢å¤æ“ä½œæ­£å¸¸
- [ ] æš‚åœçš„æºæ ·å¼åŒºåˆ†æ˜æ˜¾
- [ ] å“åº”å¼è®¾è®¡

---

## ğŸ¯ è°ƒæ•´è¯´æ˜

**ç›¸æ¯”åŸè®¡åˆ’çš„å˜åŒ–**:
1. âœ… **ä¿ç•™**: åå°å®šæ—¶è°ƒåº¦å™¨ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
2. âœ… **ä¿ç•™**: è®¢é˜…æºå¼€å¯/æš‚åœ
3. âŒ **å–æ¶ˆ**: OPML å¯¼å‡ºï¼ˆæš‚æ—¶ä¸éœ€è¦ï¼‰
4. âŒ **å–æ¶ˆ**: Popup æ¨èæç¤ºï¼ˆå·²æœ‰å¾½ç« ç³»ç»Ÿï¼‰
5. âœ… **æ–°å¢**: UI æ˜¾ç¤ºæŠ“å–ç»Ÿè®¡

**è®¾è®¡åŸåˆ™**:
- ğŸ”• **ä¸å‘é€šçŸ¥** - æŠ“å–ååªæ›´æ–°æ•°æ®ï¼Œä¸å¼¹çª—
- ğŸ“Š **æ•°æ®å‡†å¤‡** - ä¸º Phase 6 AI æ¨èå‡†å¤‡æ•°æ®
- ğŸ‘¤ **ç”¨æˆ·æ§åˆ¶** - å¯ä»¥æš‚åœä¸æƒ³æŠ“å–çš„æº
- ğŸ“ˆ **å¯è§†åé¦ˆ** - åœ¨ UI æ˜¾ç¤ºæŠ“å–è¿›åº¦å’Œç»Ÿè®¡

---

## ğŸ“Š æŠ€æœ¯å®ç°ç»†èŠ‚

### æ™ºèƒ½è°ƒåº¦ç®—æ³•

```typescript
function calculateNextFetchInterval(feed: DiscoveredFeed): number {
  const quality = feed.quality
  if (!quality) return 24 * 60 * 60 * 1000 // é»˜è®¤ 24 å°æ—¶
  
  const frequency = quality.updateFrequency // ç¯‡/å‘¨
  
  if (frequency >= 7) {
    return 6 * 60 * 60 * 1000  // æ¯å¤©æ›´æ–° â†’ 6 å°æ—¶æŠ“å–
  } else if (frequency >= 3) {
    return 12 * 60 * 60 * 1000 // æ¯å‘¨ 3-7 æ¬¡ â†’ 12 å°æ—¶æŠ“å–
  } else if (frequency >= 1) {
    return 24 * 60 * 60 * 1000 // æ¯å‘¨ 1-2 æ¬¡ â†’ 24 å°æ—¶æŠ“å–
  } else {
    return 0 // ä½é¢‘æºä¸è‡ªåŠ¨æŠ“å–
  }
}
```

### æ–‡ç« å»é‡ç­–ç•¥

```typescript
function getArticleId(article: FeedArticle): string {
  // ä½¿ç”¨ URL çš„ hash ä½œä¸ºå”¯ä¸€ ID
  return article.link
}

function mergeArticles(
  existing: FeedArticle[],
  newArticles: FeedArticle[]
): FeedArticle[] {
  const map = new Map<string, FeedArticle>()
  
  // ä¿ç•™æ—§æ–‡ç« çš„ isRead çŠ¶æ€
  existing.forEach(a => map.set(getArticleId(a), a))
  
  // æ·»åŠ æ–°æ–‡ç« ï¼ˆisRead: falseï¼‰
  newArticles.forEach(a => {
    const id = getArticleId(a)
    if (!map.has(id)) {
      map.set(id, { ...a, isRead: false })
    }
  })
  
  return Array.from(map.values())
}
```

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### FeedScheduler æµ‹è¯•ï¼ˆ15 ä¸ªæµ‹è¯•ï¼‰
- [ ] è®¡ç®—æŠ“å–é—´éš”ï¼ˆ4 ç§é¢‘ç‡ï¼‰
- [ ] è·³è¿‡æš‚åœçš„æº
- [ ] æŠ“å–æˆåŠŸæ›´æ–°æ•°æ®åº“
- [ ] æŠ“å–å¤±è´¥é”™è¯¯å¤„ç†
- [ ] æ–‡ç« å»é‡é€»è¾‘
- [ ] æœªè¯»æ•°ç»Ÿè®¡

### FeedManager æµ‹è¯•ï¼ˆ5 ä¸ªæµ‹è¯•ï¼‰
- [ ] `toggleActive()` åˆ‡æ¢çŠ¶æ€
- [ ] `getActiveSubscriptions()` è¿‡æ»¤
- [ ] æš‚åœåä¸å‚ä¸æŠ“å–

### UI æµ‹è¯•ï¼ˆ5 ä¸ªæµ‹è¯•ï¼‰
- [ ] ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
- [ ] æš‚åœ/æ¢å¤æŒ‰é’®
- [ ] æš‚åœæºæ ·å¼

**æ€»è®¡**: 25 ä¸ªæ–°æµ‹è¯•

---

## ğŸ“ æ–‡ä»¶å˜æ›´é¢„ä¼°

### æ–°å¢æ–‡ä»¶
- `src/background/feed-scheduler.ts` (~200 è¡Œ)
- `src/background/feed-scheduler.test.ts` (~300 è¡Œ)

### ä¿®æ”¹æ–‡ä»¶
- `src/storage/types.ts` (+30 è¡Œ)
- `src/storage/db.ts` (+10 è¡Œï¼Œæ•°æ®åº“ç‰ˆæœ¬å‡çº§)
- `src/core/rss/managers/FeedManager.ts` (+50 è¡Œ)
- `src/core/rss/managers/FeedManager.test.ts` (+100 è¡Œ)
- `src/components/settings/RSSManager.tsx` (+100 è¡Œ)
- `src/background.ts` (+20 è¡Œï¼Œé›†æˆ FeedScheduler)
- `public/locales/zh-CN/translation.json` (+10 keys)
- `public/locales/en/translation.json` (+10 keys)

**é¢„è®¡æ–°å¢ä»£ç **: ~800 è¡Œ

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] å®šæ—¶æŠ“å–æ­£å¸¸å·¥ä½œ
- [ ] æ ¹æ®æ›´æ–°é¢‘ç‡æ™ºèƒ½è°ƒåº¦
- [ ] æš‚åœ/æ¢å¤åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ç« ç»Ÿè®¡å‡†ç¡®
- [ ] æœªè¯»æ•°ç»Ÿè®¡å‡†ç¡®

### æŠ€æœ¯æŒ‡æ ‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆé¢„è®¡ 646/646ï¼‰
- [ ] è¦†ç›–ç‡ â‰¥ 70%
- [ ] æ„å»ºæˆåŠŸ
- [ ] æ—  TypeScript é”™è¯¯

### ç”¨æˆ·ä½“éªŒ
- [ ] æŠ“å–ä¸å½±å“æµè§ˆ
- [ ] UI å®æ—¶æ›´æ–°ç»Ÿè®¡
- [ ] æš‚åœæºæ ·å¼åŒºåˆ†æ˜æ˜¾
- [ ] å“åº”å¼è®¾è®¡

---

## ğŸš€ å¼€å‘é¡ºåº

1. **æ•°æ®æ¨¡å‹æ‰©å±•** (30 åˆ†é’Ÿ)
   - ä¿®æ”¹ `types.ts` å’Œ `db.ts`
   - æ•°æ®åº“ç‰ˆæœ¬å‡çº§
   - ç¼–å†™è¿ç§»é€»è¾‘

2. **FeedManager æ‰©å±•** (1 å°æ—¶)
   - å®ç° `toggleActive()`
   - å®ç° `getActiveSubscriptions()`
   - ç¼–å†™æµ‹è¯•

3. **åå°è°ƒåº¦å™¨** (2-3 å°æ—¶)
   - å®ç° `FeedScheduler` ç±»
   - æ™ºèƒ½è°ƒåº¦ç®—æ³•
   - æ–‡ç« å»é‡å’Œç»Ÿè®¡
   - ç¼–å†™æµ‹è¯•

4. **UI å¢å¼º** (1 å°æ—¶)
   - æ·»åŠ ç»Ÿè®¡æ˜¾ç¤º
   - æ·»åŠ æš‚åœ/æ¢å¤æŒ‰é’®
   - æ ·å¼è°ƒæ•´

5. **é›†æˆæµ‹è¯•** (30 åˆ†é’Ÿ)
   - æµè§ˆå™¨æµ‹è¯•
   - éªŒè¯å®šæ—¶æŠ“å–
   - éªŒè¯çŠ¶æ€åˆ‡æ¢

6. **æ–‡æ¡£æ›´æ–°** (30 åˆ†é’Ÿ)
   - æ›´æ–° `DEVELOPMENT_PLAN.md`
   - åˆ›å»º `PHASE_5_SPRINT_3_SUMMARY.md`

**æ€»è®¡**: 6-7 å°æ—¶ï¼ˆ1-2 å¤©ï¼‰

---

## ğŸ“ ä¸‹ä¸€æ­¥

Sprint 3 å®Œæˆåï¼š
- é€‰æ‹© A: ç»§ç»­ä¼˜åŒ– RSS åŠŸèƒ½ï¼ˆæœç´¢ã€åˆ†ç±»ç­‰ï¼‰
- é€‰æ‹© B: è¿›å…¥ **Phase 6: AI æ¨èå¼•æ“** ğŸ¯
  - åŸºäºç”¨æˆ·ç”»åƒçš„æ–‡ç« æ¨è
  - æ™ºèƒ½é€šçŸ¥æœºåˆ¶
  - æ¨èç†ç”±è§£é‡Š

**å»ºè®®**: ç›´æ¥è¿›å…¥ Phase 6ï¼Œè®© AI æ¨èç³»ç»Ÿæ¶ˆè´¹ Sprint 3 å‡†å¤‡çš„æ•°æ®ã€‚
