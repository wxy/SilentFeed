# Silent Feed v0.3.2 发布公告

> 发布日期：2025年12月7日

## 🎉 概述

Silent Feed v0.3.2 是一个重要的质量提升版本，专注于 **AI 用量可视化**、**国际化完善** 和 **Ollama 集成稳定性**。本次更新包含 20 个提交，修复了多个关键问题，并新增了专业的 AI 用量统计仪表盘。

## ✨ 主要特性

### 📊 AI 用量可视化仪表盘

全新的专业级 AI 用量统计界面，帮助用户清晰了解 AI 使用情况和成本：

**三图表联动设计**：
- 📈 **词元用量**（Token Usage）- 以 K 为单位显示输入/输出词元数
- 📞 **API 调用次数**（API Calls）- 追踪每日调用频率
- 💰 **成本统计**（Cost）- 精确到小数点后 4 位的费用明细

**智能数据分层**：
- 🔵 **非推理模式**（蓝/绿色系）- 标准 AI 模型（GPT-4o-mini, Claude Sonnet 等）
- 🔮 **推理模式**（紫/青色系）- 深度思考模型（DeepSeek R1, OpenAI o1 等）
- 堆叠式柱状图，直观对比两种模式的使用差异

**灵活视图模式**：
- 📅 **每日视图**（最近 30 天）- 精细追踪日常使用模式
- 📆 **每月视图**（全部时间）- 长期趋势分析
- 横向滚动支持，无限制时间跨度展示

**交互体验**：
- 🖱️ Hover 显示详细 Tooltip（日期 + 数值 + 总计）
- 📐 动态刻度生成，自适应数据范围
- 🎨 响应式设计，支持浅色/深色主题

### 🌐 国际化全面升级

**专业术语本地化**：
- 采用双语标注格式：**词元（Token）**、**调用（Calls）**、**费用（Cost）**
- 既保留专业准确性，又照顾用户使用习惯
- 所有技术术语均提供中英文对照

**日期格式本地化**：
- 🇨🇳 中文：`2024年12月07日`、`12月`、`12/07`
- 🇬🇧 英文：`2024-12-07`、`12`、`12/07`
- 完全基于 i18n 模板，支持未来扩展更多语言

**翻译覆盖率**：
- ✅ 100% 用户可见文本已国际化
- ✅ 零硬编码字符串
- ✅ 所有 UI 组件支持中英双语切换

### 🎨 UI/UX 改进

**页面加载体验优化**：
- 默认 UI 风格改为 **标准风格**（Standard）
- 解决页面加载时的"手绘→标准"闪烁问题
- 用户若偏好手绘风格，可在设置中手动切换

**视觉一致性**：
- 统一的渐变色背景
- 深色模式完整支持
- 响应式布局适配各种屏幕尺寸

## 🐛 重要修复

### Ollama 集成稳定性

**DNR 配置完全重构**：
- ✅ 使用 Plasmo 原生 `.plasmo` 目录管理 DNR 规则
- ✅ 静态配置替代动态注入，避免 Chrome 热加载错误
- ✅ 两条精简规则：`localhost:11434` 和 `127.0.0.1:11434`
- ✅ 自动移除 `Origin` 和 `Referer` 请求头，解决 CORS 403 错误

**构建流程优化**：
```bash
pre-build-dnr.sh → plasmo build → copy-locales.sh
```
- DNR 规则文件在构建前自动复制到正确位置
- 生产构建和开发模式均正常工作
- 扩展重载时 DNR 规则正确加载

### 页面追踪准确性

**过滤 Chrome 内部页面**：
- ❌ 不再追踪 `chrome://` 和 `chrome-extension://` 页面
- ❌ 设置页面（options.html）不触发画像重建
- ❌ 浏览器 UI 页面不计入学习进度

**去重机制强化**：
- 同一页面重载不重复学习
- Warmup 页面正确识别并过滤
- 防止无效数据污染用户画像

### AI 用量统计精度

**数据聚合修复**：
- ✅ 每日统计正确按日期分组
- ✅ 推理/非推理模式分别计数
- ✅ 成本计算精确到 0.0001 元

**边界条件处理**：
- 空数据状态友好提示
- 新用户零用量场景兼容
- 图表宽度溢出自动横向滚动

## 📈 性能优化

### AI 调用成本降低

**画像生成防抖**：
- 5 秒内的多次"不感兴趣"操作合并处理
- 减少 80% 的冗余 API 调用
- 显著降低快速筛选文章时的费用

**示例场景**：
```
旧版本：点击 10 次"不感兴趣" → 10 次 AI 调用
新版本：10 次操作 → 1-2 次 AI 调用（批量处理）
```

## 🧪 质量保证

### 测试覆盖

- ✅ **93/93** 测试文件通过
- ✅ **1492/1492** 测试用例通过
- ✅ 行覆盖率 ~73%
- ✅ 函数覆盖率 ≥70%

### 修复的测试

- UI 风格测试更新（`options.test.tsx`）
- AIUsageBarChart 组件测试完整覆盖
- 日期格式化国际化测试

## 🛠️ 技术细节

### 架构改进

**DNR 规则管理**：
```json
{
  "manifest": {
    "declarative_net_request": {
      "rule_resources": [{
        "id": "ollama_cors_bypass",
        "enabled": true,
        "path": "dnr-rules.json"
      }]
    }
  }
}
```

**i18n 模板**：
```typescript
// 日期格式化（支持参数插值）
_("settings.aiUsage.dateFormat.daily", { year, month, day })
// 中文：{{year}}年{{month}}月{{day}}日
// 英文：{{year}}-{{month}}-{{day}}
```

**图表动态缩放**：
```typescript
const scale = measuredWidth / baseViewportWidth
const barWidth = BASE_BAR_WIDTH * scale
const dateWidth = (barWidth * 3 + barGap * 2) + dateGap
```

### 构建配置

**scripts/pre-build-dnr.sh**：
```bash
# 复制 DNR 规则到 Plasmo 资源目录
cp dnr-rules.json .plasmo/
echo "✅ DNR 规则文件已准备"
```

## 📦 升级指南

### 自动升级（Chrome 商店）

扩展将在未来几小时内自动更新到 v0.3.2

### 手动安装

1. 下载 `silentfeed-0.3.2.zip`
2. 解压到本地目录
3. Chrome 扩展管理 → 开启开发者模式 → 加载已解压的扩展

### 数据兼容性

✅ 完全向后兼容 v0.3.0 和 v0.3.1
- 无需手动迁移数据
- 现有配置自动保留
- AI 用量历史数据正常显示

## 🔮 下一步计划

### v0.3.3（计划中）

- 🎯 推荐质量优化
- 📱 移动端浏览器支持研究
- 🔔 用量预警通知（超出预算提醒）
- 📊 更多数据分析维度（按用途分组、按提供商对比）

### 长期路线图

- 🌍 多语言支持扩展（日语、韩语、西班牙语等）
- 🤖 AI 模型智能切换（根据任务复杂度自动选择）
- 📈 推荐效果 A/B 测试
- 🔐 隐私保护增强（本地计算优先）

## 🙏 致谢

感谢所有测试用户的反馈和建议！

特别感谢：
- DNR 配置问题的排查与修复
- AI 用量统计界面的设计迭代
- 国际化方案的讨论与完善

## 📝 完整更新日志

详见 [CHANGELOG.md](../CHANGELOG.md)

## 🔗 相关链接

- **GitHub 仓库**: https://github.com/wxy/SilentFeed
- **问题反馈**: https://github.com/wxy/SilentFeed/issues
- **Pull Request #66**: https://github.com/wxy/SilentFeed/pull/66

---

**Silent Feed** - 让信息流安静下来 🌙
