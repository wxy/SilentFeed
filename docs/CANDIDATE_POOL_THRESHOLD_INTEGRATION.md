# å€™é€‰æ± å‡†å…¥é˜ˆå€¼ AI ç­–ç•¥é›†æˆ

## ğŸ“‹ æ¦‚è¿°

å°†å€™é€‰æ± å‡†å…¥é˜ˆå€¼ï¼ˆentryThresholdï¼‰çº³å…¥ AI ç­–ç•¥å†³ç­–ç³»ç»Ÿï¼Œå®ç°åŠ¨æ€è‡ªé€‚åº”è°ƒæ•´ï¼Œè§£å†³å€™é€‰æ± æ–‡ç« æ•°é‡æ¿€å¢é—®é¢˜ã€‚

## ğŸ¯ ç›®æ ‡

- âœ… å°†å€™é€‰æ± å‡†å…¥é˜ˆå€¼ä»å›ºå®šå€¼ 0.7 æ”¹ä¸º AI åŠ¨æ€å†³ç­–ï¼ˆèŒƒå›´ 0.5-0.9ï¼‰
- âœ… AI æ ¹æ®å€™é€‰æ± çŠ¶æ€ï¼ˆå……è¶³/ä¸è¶³/é€‚ä¸­ï¼‰å’Œè®¢é˜…æºè´¨é‡è‡ªåŠ¨è°ƒæ•´é˜ˆå€¼
- âœ… ä¿æŒå‘åå…¼å®¹ï¼Œæœªé…ç½® AI ç­–ç•¥æ—¶ä½¿ç”¨é…ç½®é»˜è®¤å€¼

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### å®Œæ•´å·¥ä½œæµç¨‹

```
åå°è°ƒåº¦å™¨ (StrategyReviewScheduler)
  â†“ (æ¯24å°æ—¶æ£€æŸ¥ç­–ç•¥æœ‰æ•ˆæ€§)
StrategyDecisionService.generateNewStrategy()
  â†“ (è°ƒç”¨ AIï¼Œä¼ å…¥ç³»ç»ŸçŠ¶æ€)
AI è¿”å›ç­–ç•¥ (åŒ…å« candidatePool.entryThreshold: 0.5-0.9)
  â†“
ä¿å­˜åˆ° Local Storage (strategy-storage.ts)
  â†“
RecommendationService.generateRecommendations()
  â”œâ”€ getCurrentStrategy() è¯»å–ç­–ç•¥
  â”œâ”€ ä¼˜å…ˆä½¿ç”¨ strategy.candidatePool.entryThreshold
  â””â”€ å›é€€åˆ° config.qualityThreshold æˆ– 0.7
  â†“
ä¼ é€’ç»™ Pipeline (é€šè¿‡ config.qualityThreshold)
  â†“
Pipeline.processArticle() ä½¿ç”¨ entryThreshold
  â†“
saveArticleAnalysis() åˆ¤æ–­æ–‡ç« è¿›å…¥å€™é€‰æ± æˆ–ä¸åˆæ ¼æ± 
```

### AI å†³ç­–é€»è¾‘

AI ä¼šæ ¹æ®ä»¥ä¸‹å› ç´ å†³å®š entryThresholdï¼ˆå†™å…¥ Prompt æ¨¡æ¿ï¼‰ï¼š

1. **å€™é€‰æ± å……è¶³** (> targetSize Ã— 0.8)
   - æé«˜å‡†å…¥é˜ˆå€¼ï¼ˆ0.75-0.9ï¼‰
   - ç›®çš„ï¼šæ‹©ä¼˜ç­›é€‰ï¼Œä¿æŒé«˜è´¨é‡

2. **å€™é€‰æ± ä¸è¶³** (< targetSize Ã— 0.5)
   - é™ä½å‡†å…¥é˜ˆå€¼ï¼ˆ0.6-0.75ï¼‰
   - ç›®çš„ï¼šåŠ é€Ÿè¡¥å……ï¼Œé¿å…æ¨èæ± æ¯ç«­

3. **å€™é€‰æ± é€‚ä¸­**
   - ä¿æŒæ ‡å‡†é˜ˆå€¼ï¼ˆ0.7-0.8ï¼‰
   - ç›®çš„ï¼šå¹³è¡¡è´¨é‡ä¸æ•°é‡

4. **ç»¼åˆè€ƒè™‘**
   - è®¢é˜…æºæ•´ä½“è´¨é‡é«˜ï¼šå¯æé«˜é—¨æ§›
   - è®¢é˜…æºæ•´ä½“è´¨é‡ä½ï¼šéœ€æ”¾å®½æ ‡å‡†

### é˜ˆå€¼ä¼˜å…ˆçº§

```
AIç­–ç•¥çš„ entryThreshold 
  â†“ (å¦‚æœä¸å­˜åœ¨)
é…ç½®çš„ qualityThreshold 
  â†“ (å¦‚æœä¸å­˜åœ¨)
é»˜è®¤å€¼ 0.7
```

## ğŸ“ ä»£ç ä¿®æ”¹

### 1. ç±»å‹å®šä¹‰æ‰©å±• (src/types/strategy.ts)

```typescript
export interface RecommendationStrategy {
  // ... å…¶ä»–å­—æ®µ ...
  candidatePool: {
    targetSize: number       // ç›®æ ‡å¤§å° [10, 100]
    maxSize: number          // æœ€å¤§å¤§å° [20, 200]
    expiryHours: number      // è¿‡æœŸæ—¶é—´ [24, 336]
    entryThreshold: number   // ğŸ†• å‡†å…¥é˜ˆå€¼ [0.5, 0.9]ï¼ŒAI åŠ¨æ€å†³ç­–
  }
}
```

### 2. éªŒè¯é€»è¾‘ (src/core/strategy/StrategyDecisionService.ts)

```typescript
candidatePool: {
  // ... å…¶ä»–å­—æ®µ ...
  entryThreshold: this.clamp(
    strategy.candidatePool.entryThreshold ?? 0.7, 
    0.5, 0.9
  )
}
```

### 3. AI Prompt æ¨¡æ¿ (src/core/ai/prompts/templates/zh-CN.json)

åœ¨ç¬¬6èŠ‚"å€™é€‰æ± ç®¡ç†"ä¸­æ·»åŠ å‡†å…¥é˜ˆå€¼å†³ç­–è§„åˆ™ï¼š

```json
{
  "section": "6. å€™é€‰æ± ç®¡ç† (candidatePool)",
  "rules": [
    "å€™é€‰æ± å……è¶³ (> targetSize Ã— 0.8): æé«˜å‡†å…¥é˜ˆå€¼ (0.75-0.9)",
    "å€™é€‰æ± ä¸è¶³ (< targetSize Ã— 0.5): é™ä½å‡†å…¥é˜ˆå€¼ (0.6-0.75)",
    "å€™é€‰æ± é€‚ä¸­: ä¿æŒæ ‡å‡†é˜ˆå€¼ (0.7-0.8)",
    "ç»¼åˆè€ƒè™‘è®¢é˜…æºæ•´ä½“è´¨é‡è°ƒæ•´å‡†å…¥é—¨æ§›"
  ],
  "output": {
    "entryThreshold": "<number> [0.5, 0.9] å€™é€‰æ± å‡†å…¥é˜ˆå€¼"
  }
}
```

### 4. Pipeline é›†æˆ (src/core/recommender/pipeline.ts)

```typescript
// Phase 16: å€™é€‰æ± å‡†å…¥é˜ˆå€¼ - ä¼˜å…ˆä½¿ç”¨ AI ç­–ç•¥å†³ç­–ï¼Œå›é€€åˆ°é…ç½®å€¼
// TODO: é›†æˆ AI ç­–ç•¥ç³»ç»Ÿåï¼Œä» context.strategy?.candidatePool.entryThreshold è¯»å–åŠ¨æ€é˜ˆå€¼
const entryThreshold = context.config.qualityThreshold ?? 0.7
```

### 5. æ¨èæœåŠ¡é›†æˆ (src/core/recommender/RecommendationService.ts)

```typescript
// å¯¼å…¥ç­–ç•¥è¯»å–å‡½æ•°
import { getCurrentStrategy } from '@/storage/strategy-storage'

// åœ¨ç”Ÿæˆæ¨èæ—¶è¯»å–ç­–ç•¥
const currentStrategy = await getCurrentStrategy()
const entryThreshold = currentStrategy?.candidatePool?.entryThreshold 
  ?? recommendationConfig.qualityThreshold 
  ?? 0.7

recLogger.info('ğŸ¯ å€™é€‰æ± å‡†å…¥é˜ˆå€¼:', {
  æ¥æº: currentStrategy ? 'AIç­–ç•¥' : 'é…ç½®é»˜è®¤å€¼',
  é˜ˆå€¼: entryThreshold,
  ç­–ç•¥ID: currentStrategy?.meta?.decisionId
})

// ä¼ é€’ç»™ Pipeline
const config: RecommendationConfig = {
  // ...
  qualityThreshold: entryThreshold, // ä½¿ç”¨ç­–ç•¥å†³ç­–çš„å‡†å…¥é˜ˆå€¼
  // ...
}
```

## âœ… æµ‹è¯•éªŒè¯

### è‡ªåŠ¨åŒ–æµ‹è¯•

```bash
npm run test:run
```

ç»“æœï¼š126 ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œ2143 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ…

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

1. **æ‰“å¼€ Service Worker æ§åˆ¶å°**
   - è®¿é—® `chrome://extensions`
   - æ‰¾åˆ° Silent Feed æ‰©å±•
   - ç‚¹å‡» "Service Worker" é“¾æ¥

2. **è¿è¡Œé›†æˆæµ‹è¯•è„šæœ¬**
   ```javascript
   // å¤åˆ¶å¹¶ç²˜è´´ scripts/test-strategy-integration.js çš„å†…å®¹
   ```

3. **æ£€æŸ¥è¾“å‡º**
   - âœ… æ˜¯å¦æœ‰å½“å‰ç­–ç•¥
   - âœ… ç­–ç•¥ä¸­æ˜¯å¦åŒ…å« entryThreshold å­—æ®µ
   - âœ… ç­–ç•¥å®¡æŸ¥å®šæ—¶å™¨æ˜¯å¦è®¾ç½®
   - âœ… é›†æˆæµ‹è¯•æ˜¯å¦é€šè¿‡

4. **è§‚å¯Ÿæ¨èæ—¥å¿—**
   - ç­‰å¾…æ¨èæœåŠ¡è¿è¡Œï¼ˆrecommendation alarmï¼‰
   - æŸ¥çœ‹æ—¥å¿—ä¸­çš„ï¼š`ğŸ¯ å€™é€‰æ± å‡†å…¥é˜ˆå€¼: { æ¥æº: 'AIç­–ç•¥', é˜ˆå€¼: X.X, ... }`
   - ç¡®è®¤é˜ˆå€¼æ¥æºä¸º"AIç­–ç•¥"è€Œé"é…ç½®é»˜è®¤å€¼"

## ğŸ“Š æ•ˆæœéªŒè¯

### æœŸæœ›æ•ˆæœ

1. **åŠ¨æ€è°ƒæ•´é˜ˆå€¼**
   - å€™é€‰æ± æ–‡ç« è¿‡å¤šæ—¶ï¼ŒAI è‡ªåŠ¨æé«˜é˜ˆå€¼ï¼ˆå¦‚ 0.8ã€0.85ï¼‰
   - å€™é€‰æ± æ–‡ç« ä¸è¶³æ—¶ï¼ŒAI è‡ªåŠ¨é™ä½é˜ˆå€¼ï¼ˆå¦‚ 0.65ã€0.7ï¼‰

2. **æ—¥å¿—å¯è§‚æµ‹æ€§**
   - æ¯æ¬¡ç”Ÿæˆæ¨èæ—¶ï¼Œæ˜ç¡®æ˜¾ç¤ºé˜ˆå€¼æ¥æºå’Œå€¼
   - ä¾¿äºè°ƒè¯•å’Œç›‘æ§ç­–ç•¥æ˜¯å¦ç”Ÿæ•ˆ

3. **å‘åå…¼å®¹**
   - å¦‚æœç­–ç•¥å°šæœªç”Ÿæˆæˆ–ä¸åŒ…å« entryThresholdï¼Œè‡ªåŠ¨å›é€€åˆ°é…ç½®é»˜è®¤å€¼
   - ä¸ä¼šå½±å“ç°æœ‰ç³»ç»Ÿæ­£å¸¸è¿è¡Œ

### ç›‘æ§æŒ‡æ ‡

- **å€™é€‰æ± å¤§å°**ï¼šè§‚å¯Ÿæ˜¯å¦åœ¨ targetSize é™„è¿‘æ³¢åŠ¨ï¼ˆä¸å†æ¿€å¢ï¼‰
- **æ¨èæ± è¡¥å……é€Ÿåº¦**ï¼šç¡®ä¿æ¨èæ± èƒ½ç¨³å®šè¡¥å……ï¼ˆä¸æ¯ç«­ï¼‰
- **ç­–ç•¥æ›´æ–°é¢‘ç‡**ï¼šæ¯24å°æ—¶è‡ªåŠ¨å®¡æŸ¥å¹¶æ›´æ–°ç­–ç•¥

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šç­–ç•¥ä¸­æ²¡æœ‰ entryThreshold å­—æ®µ

**åŸå› **ï¼šå½“å‰ç­–ç•¥æ˜¯æ—§ç‰ˆæœ¬ï¼Œåœ¨ AI Prompt æ›´æ–°ä¹‹å‰ç”Ÿæˆçš„ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç­‰å¾…24å°æ—¶ï¼Œç­–ç•¥å®¡æŸ¥è°ƒåº¦å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆæ–°ç­–ç•¥
2. æˆ–æ‰‹åŠ¨è§¦å‘ç­–ç•¥é‡ç½®ï¼š
   ```javascript
   // åœ¨ Service Worker æ§åˆ¶å°è¿è¡Œ
   // å¤åˆ¶å¹¶è¿è¡Œ scripts/reset-strategy-system.js
   ```

### é—®é¢˜2ï¼šæ¨èæ—¥å¿—æ˜¾ç¤º"é…ç½®é»˜è®¤å€¼"è€Œé"AIç­–ç•¥"

**åŸå› **ï¼š
- `getCurrentStrategy()` è¿”å› nullï¼ˆç­–ç•¥ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸï¼‰
- ç­–ç•¥ä¸­æ²¡æœ‰ `candidatePool.entryThreshold` å­—æ®µ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `chrome.storage.local` ä¸­æ˜¯å¦æœ‰ `current_strategy` é”®
2. æ£€æŸ¥ç­–ç•¥æ˜¯å¦è¿‡æœŸï¼ˆ`validUntil` < å½“å‰æ—¶é—´ï¼‰
3. ç­‰å¾…ç­–ç•¥ç”Ÿæˆæˆ–æ‰‹åŠ¨é‡ç½®

### é—®é¢˜3ï¼šç­–ç•¥å®¡æŸ¥å®šæ—¶å™¨æœªè®¾ç½®

**åŸå› **ï¼šæ‰©å±•æœªå®Œå…¨å¯åŠ¨æˆ–è°ƒåº¦å™¨å¯åŠ¨å¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é‡æ–°åŠ è½½æ‰©å±•ï¼ˆchrome://extensions â†’ é‡æ–°åŠ è½½ï¼‰
2. æ£€æŸ¥ `chrome.alarms.getAll()` æ˜¯å¦åŒ…å« `strategy-review` alarm
3. æŸ¥çœ‹ Service Worker æ—¥å¿—æ˜¯å¦æœ‰å¯åŠ¨é”™è¯¯

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [AI ç­–ç•¥æ¶æ„](./AI_ARCHITECTURE.md)
- [æ¨èç³»ç»Ÿè®¾è®¡](./RECOMMENDATION_SYSTEM_REDESIGN.md)
- [å€™é€‰æ± ç®¡ç†](./ARTICLE_POOL_STATUS.md)
- [æµ‹è¯•æ–‡æ¡£](./TESTING.md)

## ğŸ”— ç›¸å…³ Commit

- `3dd5d55`: ç±»å‹æ‰©å±• + AI Prompt æ›´æ–° + éªŒè¯é€»è¾‘ + Pipeline é¢„ç•™
- `58517a5`: RecommendationService ç­–ç•¥é›†æˆï¼Œè®© entryThreshold ç”Ÿæ•ˆ

## âœ¨ æ€»ç»“

é€šè¿‡å°†å€™é€‰æ± å‡†å…¥é˜ˆå€¼çº³å…¥ AI ç­–ç•¥å†³ç­–ç³»ç»Ÿï¼Œå®ç°äº†ï¼š

1. **è‡ªé€‚åº”è°ƒæ•´**ï¼šæ ¹æ®å€™é€‰æ± çŠ¶æ€åŠ¨æ€è°ƒæ•´é˜ˆå€¼
2. **ç«¯åˆ°ç«¯é›†æˆ**ï¼šä»ç­–ç•¥ç”Ÿæˆ â†’ å­˜å‚¨ â†’ è¯»å– â†’ ä½¿ç”¨çš„å®Œæ•´æµç¨‹
3. **å‘åå…¼å®¹**ï¼šä¿ç•™é…ç½®é»˜è®¤å€¼ä½œä¸ºå›é€€
4. **å¯è§‚æµ‹æ€§**ï¼šæ—¥å¿—æ¸…æ™°æ˜¾ç¤ºé˜ˆå€¼æ¥æº

å€™é€‰æ± æ–‡ç« æ•°é‡æ¿€å¢é—®é¢˜å·²ä»æ ¹æœ¬ä¸Šè§£å†³ ğŸ‰
