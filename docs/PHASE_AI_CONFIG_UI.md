# AI 配置界面优化

## 功能目标

优化 AI 配置界面，提供直观的状态展示和快捷配置入口。

## 核心功能

### 1. AI Provider 状态卡片

**展示内容**：
- Provider 类型（DeepSeek/OpenAI/Ollama）
- 状态图标（✅ 可用 / ⚠️ 未配置 / ❌ 不可用）
- 连接延迟（如：120ms）
- 推理能力（🧠 基础 / 🚀 高级）
- 最后检测时间

**交互行为**：
- 点击卡片：展开配置面板
- 启用/禁用切换
- 重新检测按钮

### 2. 配置浮层

**快捷配置**：
- API Key 输入
- 模型选择
- 推理能力切换
- 端点配置（Ollama）

### 3. 智能检测

**自动检测**：
- 5 分钟缓存
- 配置变更时立即检测
- 后台异步更新

**推理能力检测**：
- 发送测试 prompt 检测推理质量
- 自动判断基础/高级能力

## 技术实现

### 数据流

```
用户配置 → AI Config Storage
    ↓
AI Capability Manager → 初始化 Provider
    ↓
Provider Status Storage ← 检测结果缓存
    ↓
UI 组件 ← 状态展示
```

### 组件结构

```
AIConfigPanel/
  ├── AIProviderCard (卡片组件)
  │   ├── 状态图标
  │   ├── 延迟显示
  │   └── 推理能力标识
  ├── AIProviderConfig (配置浮层)
  │   ├── API Key 输入
  │   ├── 模型选择
  │   └── 能力切换
  └── useAIProviderStatus (状态 Hook)
      ├── 获取缓存状态
      ├── 触发检测
      └── 监听状态变化
```

## UI 设计

### 卡片布局

```
┌─────────────────────────────────┐
│ 🤖 DeepSeek          ✅ 可用    │
│                                 │
│ 延迟: 120ms                     │
│ 推理: 🚀 高级                   │
│                                 │
│ 最后检测: 2分钟前               │
│                                 │
│ [重新检测] [配置]               │
└─────────────────────────────────┘
```

### 状态指示

- ✅ **可用**：绿色，Provider 正常工作
- ⚠️ **未配置**：黄色，缺少 API Key 或配置
- ❌ **不可用**：红色，连接失败或错误
- 🔄 **检测中**：灰色，正在进行可用性检测

## 验收标准

- [ ] 卡片正确显示 Provider 状态
- [ ] 点击卡片展开配置面板
- [ ] 配置变更后自动重新检测
- [ ] 延迟显示准确（ms 级别）
- [ ] 推理能力自动检测并显示
- [ ] 缓存机制正常工作（5 分钟）
- [ ] 错误状态友好提示
- [ ] 支持启用/禁用切换

## 实现步骤

1. ✅ 创建 `ai-provider-status.ts`（已完成）
2. [ ] 创建 `AIProviderCard` 组件
3. [ ] 创建 `AIProviderConfig` 配置浮层
4. [ ] 实现 `useAIProviderStatus` Hook
5. [ ] 集成到 Options 页面
6. [ ] 添加推理能力检测逻辑
7. [ ] 编写组件测试
8. [ ] 浏览器测试验证

## 注意事项

- 检测操作应该是异步的，不阻塞 UI
- 缓存失效后自动重新检测
- API Key 输入需要安全处理（不明文显示）
- 错误信息要清晰（网络问题/认证失败/服务不可用）
