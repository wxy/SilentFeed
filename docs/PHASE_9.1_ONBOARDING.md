# Phase 9.1: é¦–æ¬¡ä½¿ç”¨å¼•å¯¼ï¼ˆOnboardingï¼‰

**å¼€å§‹æ—¶é—´**: 2025-11-25  
**é¢„è®¡å®Œæˆ**: 2025-11-25  
**å®é™…å·¥ä½œé‡**: TBD  
**çŠ¶æ€**: è¿›è¡Œä¸­ â³

---

## ğŸ“‹ åŠŸèƒ½ç›®æ ‡

å®ç°å®Œæ•´çš„é¦–æ¬¡ä½¿ç”¨å¼•å¯¼æµç¨‹ï¼Œç¡®ä¿ç”¨æˆ·åœ¨å®‰è£…æ‰©å±•åï¼š
1. **ç†è§£äº§å“ä»·å€¼**ï¼šAI é©±åŠ¨çš„æ™ºèƒ½ RSS ç­›é€‰å™¨
2. **å®Œæˆ AI é…ç½®**ï¼šè®¾ç½® DeepSeek/OpenAI APIï¼ˆå¿…éœ€ï¼‰
3. **æ·»åŠ  RSS æº**ï¼šæ‰‹åŠ¨æ·»åŠ æˆ–å¯¼å…¥ OPML
4. **è¿›å…¥å­¦ä¹ é˜¶æ®µ**ï¼šå¼€å§‹æµè§ˆå†å²é‡‡é›†å’Œç”»åƒæ„å»º

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### äº§å“å®šä½ï¼ˆæ¥è‡ª PRDï¼‰
- **æ ¸å¿ƒä»·å€¼**ï¼šAI ä½œä¸º"ä¿¡æ¯å®ˆé—¨å‘˜"ï¼Œè‡ªåŠ¨ç­›é€‰å†…å®¹
- **å¿…é¡»ä¾èµ– AI**ï¼šæ²¡æœ‰ AI é…ç½®ï¼Œæ‰©å±•æ— æ³•å‘æŒ¥çœŸæ­£ä½œç”¨
- **ç”¨æˆ·ç—›ç‚¹**ï¼šä¿¡æ¯è¿‡è½½éœ€è¦ AI è§£å†³

### å½“å‰é—®é¢˜
1. âŒ ç”¨æˆ·å¯èƒ½ä¸çŸ¥é“éœ€è¦é…ç½® AI
2. âŒ æœªé…ç½® AI æ—¶ä»é‡‡é›†æ•°æ®ï¼ˆæµªè´¹èµ„æºï¼‰
3. âŒ ç¼ºå°‘é¦–æ¬¡ä½¿ç”¨å¼•å¯¼
4. âŒ æ— æ³•åŒºåˆ†"å‡†å¤‡é˜¶æ®µ"å’Œ"å­¦ä¹ é˜¶æ®µ"

---

## ğŸ—ï¸ æŠ€æœ¯è®¾è®¡

### 1. çŠ¶æ€æœºè®¾è®¡

```typescript
// æ‰©å±•è¿è¡ŒçŠ¶æ€
type OnboardingState = 'setup' | 'learning' | 'ready'

// setup: æœªé…ç½® AIï¼Œæ˜¾ç¤ºå¼•å¯¼ç•Œé¢
// learning: å·²é…ç½® AIï¼Œæ­£åœ¨å­¦ä¹ ï¼ˆå†·å¯åŠ¨é˜¶æ®µï¼‰
// ready: å­¦ä¹ å®Œæˆï¼Œå¯ä»¥æ¨èï¼ˆpageCount >= 1000ï¼‰
```

**çŠ¶æ€è½¬æ¢è§„åˆ™**ï¼š
```
setup â†’ learning:
  - æ¡ä»¶ï¼šAI å·²é…ç½® && RSS æºå·²æ·»åŠ 
  - è§¦å‘ï¼šç”¨æˆ·å®Œæˆå¼•å¯¼æµç¨‹

learning â†’ ready:
  - æ¡ä»¶ï¼špageCount >= 1000
  - è§¦å‘ï¼šè‡ªåŠ¨ï¼ˆç°æœ‰é€»è¾‘ï¼‰

ready â†’ setup:
  - æ¡ä»¶ï¼šç”¨æˆ·ç¦ç”¨ AI é…ç½®
  - è§¦å‘ï¼šåœ¨ Options é¡µé¢ç¦ç”¨ AI
```

### 2. å¼•å¯¼æµç¨‹è®¾è®¡

#### Step 1: æ¬¢è¿é¡µ
- **ç›®æ ‡**ï¼šä»‹ç»äº§å“ä»·å€¼
- **å†…å®¹**ï¼š
  - äº§å“åç§°å’Œ Sloganï¼š"è®©ä¿¡æ¯æµå®‰é™ä¸‹æ¥"
  - æ ¸å¿ƒåŠŸèƒ½ï¼šAI é©±åŠ¨çš„æ™ºèƒ½ç­›é€‰
  - éšç§æ‰¿è¯ºï¼šæœ¬åœ°å¤„ç†ï¼Œæ•°æ®ä¸ä¸Šä¼ 
- **æ“ä½œ**ï¼šç‚¹å‡»"å¼€å§‹é…ç½®"è¿›å…¥ä¸‹ä¸€æ­¥

#### Step 2: é…ç½® AI
- **ç›®æ ‡**ï¼šè®¾ç½® AI Provider å’Œ API Key
- **å†…å®¹**ï¼š
  - æä¾›å•†é€‰æ‹©ï¼šDeepSeekï¼ˆæ¨èï¼Œå›½å†…å‹å¥½ï¼‰/ OpenAI
  - API Key è¾“å…¥æ¡†
  - è·å– API Key çš„å¸®åŠ©é“¾æ¥
  - æµ‹è¯•è¿æ¥æŒ‰é’®
- **éªŒè¯**ï¼š
  - API Key æ ¼å¼æ£€æŸ¥
  - è¿æ¥æµ‹è¯•æˆåŠŸ
- **æ“ä½œ**ï¼šé…ç½®æˆåŠŸåè¿›å…¥ä¸‹ä¸€æ­¥

#### Step 3: æ·»åŠ  RSS æº
- **ç›®æ ‡**ï¼šæ·»åŠ è‡³å°‘ 1 ä¸ª RSS æº
- **å†…å®¹**ï¼š
  - æ‰‹åŠ¨æ·»åŠ ï¼ˆURL è¾“å…¥ï¼‰
  - å¯¼å…¥ OPMLï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰
  - æä¾›ç¤ºä¾‹æºï¼ˆå¯é€‰ï¼Œå¦‚é˜®ä¸€å³°çš„åšå®¢ï¼‰
- **éªŒè¯**ï¼šè‡³å°‘æ·»åŠ  1 ä¸ªæœ‰æ•ˆæº
- **æ“ä½œ**ï¼šå®Œæˆåè¿›å…¥å­¦ä¹ é˜¶æ®µ

#### Step 4: å®Œæˆå¼•å¯¼
- **ç›®æ ‡**ï¼šç¡®è®¤å¼•å¯¼å®Œæˆï¼Œå¼€å§‹æ•°æ®é‡‡é›†
- **å†…å®¹**ï¼š
  - æ˜¾ç¤º"å‡†å¤‡å®Œæˆ"
  - è¯´æ˜æ¥ä¸‹æ¥ä¼šé‡‡é›†æµè§ˆå†å²ï¼ˆéœ€è¦ 1000 é¡µï¼‰
  - é¢„è®¡æ—¶é—´æç¤ºï¼ˆæ ¹æ®æµè§ˆä¹ æƒ¯ï¼‰
- **æ“ä½œ**ï¼š
  - ä¿å­˜çŠ¶æ€ä¸º 'learning'
  - å…³é—­å¼•å¯¼ç•Œé¢
  - å¼€å§‹æ•°æ®é‡‡é›†

### 3. æ•°æ®å­˜å‚¨

```typescript
// src/storage/onboarding-state.ts
interface OnboardingStatus {
  state: 'setup' | 'learning' | 'ready'
  completedAt?: number  // å¼•å¯¼å®Œæˆæ—¶é—´
  currentStep?: number  // å½“å‰æ­¥éª¤ï¼ˆ1-3ï¼‰
}
```

å­˜å‚¨ä½ç½®ï¼š`chrome.storage.local`ï¼ˆæœ¬åœ°ï¼Œä¸åŒæ­¥ï¼‰

### 4. ç»„ä»¶ç»“æ„

```
src/components/OnboardingView.tsx
â”œâ”€â”€ WelcomeStep.tsx       // Step 1: æ¬¢è¿é¡µ
â”œâ”€â”€ AIConfigStep.tsx      // Step 2: é…ç½® AI
â”œâ”€â”€ RSSSetupStep.tsx      // Step 3: æ·»åŠ  RSS
â””â”€â”€ CompletionStep.tsx    // Step 4: å®Œæˆå¼•å¯¼
```

---

## ğŸ”§ å®æ–½æ­¥éª¤

### Task 1: åˆ›å»ºçŠ¶æ€ç®¡ç†æ¨¡å— âœ…
- æ–‡ä»¶ï¼š`src/storage/onboarding-state.ts`
- åŠŸèƒ½ï¼š
  - `getOnboardingState()` - è·å–å½“å‰çŠ¶æ€
  - `setOnboardingState()` - æ›´æ–°çŠ¶æ€
  - `completeOnboarding()` - å®Œæˆå¼•å¯¼
  - `resetOnboarding()` - é‡ç½®ï¼ˆç”¨äºæµ‹è¯•ï¼‰

### Task 2: åˆ›å»º Onboarding ç»„ä»¶ âœ…
- æ–‡ä»¶ï¼š`src/components/OnboardingView.tsx`
- åŠŸèƒ½ï¼š
  - å¤šæ­¥éª¤å¯¼èˆªï¼ˆè¿›åº¦æ¡ï¼‰
  - æ­¥éª¤åˆ‡æ¢é€»è¾‘
  - è¡¨å•éªŒè¯
  - ä¸ AI Config é›†æˆ
  - ä¸ RSS Manager é›†æˆ

### Task 3: ä¿®æ”¹ Popup å…¥å£é€»è¾‘ âœ…
- æ–‡ä»¶ï¼š`src/popup.tsx`
- æ”¹åŠ¨ï¼š
  ```typescript
  // 1. æ£€æŸ¥ Onboarding çŠ¶æ€
  const [onboardingState, setOnboardingState] = useState<OnboardingState>('setup')
  
  useEffect(() => {
    const checkState = async () => {
      const state = await getOnboardingState()
      setOnboardingState(state.state)
    }
    checkState()
  }, [])
  
  // 2. æ ¹æ®çŠ¶æ€æ¸²æŸ“ä¸åŒç•Œé¢
  if (onboardingState === 'setup') {
    return <OnboardingView />
  }
  
  // 3. learning å’Œ ready çŠ¶æ€èµ°ç°æœ‰é€»è¾‘
  const isColdStart = pageCount !== null && pageCount < COLD_START_THRESHOLD
  return isColdStart ? <ColdStartView /> : <RecommendationView />
  ```

### Task 4: ä¿®æ”¹ Background é‡‡é›†é€»è¾‘ âœ…
- æ–‡ä»¶ï¼š`src/background.ts`
- æ”¹åŠ¨ï¼š
  ```typescript
  // é¡µé¢è®¿é—®ç›‘å¬å™¨
  chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
    if (message.type === 'PAGE_VISIT') {
      // æ£€æŸ¥ Onboarding çŠ¶æ€
      const onboarding = await getOnboardingState()
      if (onboarding.state === 'setup') {
        console.log('[Background] å‡†å¤‡é˜¶æ®µï¼Œè·³è¿‡æ•°æ®é‡‡é›†')
        return
      }
      
      // ç»§ç»­ç°æœ‰é€»è¾‘...
    }
  })
  ```

### Task 5: æ›´æ–°å†·å¯åŠ¨ç•Œé¢ âœ…
- æ–‡ä»¶ï¼š`src/components/ColdStartView.tsx`
- æ”¹åŠ¨ï¼š
  - æ·»åŠ  AI é…ç½®çŠ¶æ€æ£€æµ‹
  - æ˜¾ç¤º"AI é…ç½®å®Œæˆ"æç¤º
  - æä¾›"ç®¡ç† AI é…ç½®"é“¾æ¥

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
1. **onboarding-state.ts**
   - âœ… é»˜è®¤çŠ¶æ€ä¸º 'setup'
   - âœ… çŠ¶æ€è½¬æ¢é€»è¾‘
   - âœ… å®Œæˆå¼•å¯¼åçŠ¶æ€ä¸º 'learning'
   - âœ… é‡ç½®åŠŸèƒ½

2. **OnboardingView.tsx**
   - âœ… æ­¥éª¤åˆ‡æ¢
   - âœ… è¡¨å•éªŒè¯
   - âœ… AI é…ç½®é›†æˆ
   - âœ… RSS æ·»åŠ é›†æˆ
   - âœ… å®Œæˆæµç¨‹

### é›†æˆæµ‹è¯•
1. **Popup çŠ¶æ€æ£€æµ‹**
   - âœ… setup çŠ¶æ€æ˜¾ç¤º OnboardingView
   - âœ… learning çŠ¶æ€æ˜¾ç¤º ColdStartView
   - âœ… ready çŠ¶æ€æ˜¾ç¤º RecommendationView

2. **Background é‡‡é›†é€»è¾‘**
   - âœ… setup çŠ¶æ€è·³è¿‡é‡‡é›†
   - âœ… learning çŠ¶æ€å¼€å§‹é‡‡é›†
   - âœ… çŠ¶æ€å˜åŒ–æ—¶é‡‡é›†è¡Œä¸ºæ­£ç¡®

### æµè§ˆå™¨æµ‹è¯•
1. **é¦–æ¬¡å®‰è£…æµç¨‹**
   - â³ å®‰è£…åè‡ªåŠ¨æ‰“å¼€å¼•å¯¼
   - â³ å®Œæˆæ‰€æœ‰æ­¥éª¤
   - â³ è¿›å…¥å­¦ä¹ é˜¶æ®µ

2. **è¾¹ç•Œæƒ…å†µ**
   - â³ ä¸­é€”å…³é—­å¼•å¯¼ï¼ˆä¸‹æ¬¡æ‰“å¼€ç»§ç»­ï¼‰
   - â³ ç¦ç”¨ AI åé‡æ–°å¼•å¯¼
   - â³ OPML å¯¼å…¥å¤±è´¥å¤„ç†

---

## ğŸ“Š éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… é¦–æ¬¡å®‰è£…åæ˜¾ç¤ºå¼•å¯¼ç•Œé¢
- âœ… å¼•å¯¼æµç¨‹å®Œæ•´ï¼ˆæ¬¢è¿ â†’ AI â†’ RSS â†’ å®Œæˆï¼‰
- âœ… AI é…ç½®éªŒè¯ï¼ˆæ ¼å¼ + è¿æ¥æµ‹è¯•ï¼‰
- âœ… RSS æºæ·»åŠ æˆåŠŸ
- âœ… å®Œæˆåè¿›å…¥å­¦ä¹ é˜¶æ®µ
- âœ… æœªå®Œæˆå¼•å¯¼æ—¶ä¸é‡‡é›†æ•°æ®

### ç”¨æˆ·ä½“éªŒ
- âœ… ç•Œé¢ç®€æ´æ¸…æ™°
- âœ… æ­¥éª¤å¯¼èˆªæ˜ç¡®
- âœ… é”™è¯¯æç¤ºå‹å¥½
- âœ… å¯ä»¥è·³è¿‡éå¿…éœ€æ­¥éª¤ï¼ˆä»… RSS å¯è·³è¿‡ï¼‰

### ä»£ç è´¨é‡
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 70%
- âœ… TypeScript ä¸¥æ ¼æ¨¡å¼
- âœ… æ‰€æœ‰æ–‡æœ¬å›½é™…åŒ–ï¼ˆ_() å‡½æ•°ï¼‰
- âœ… éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ

---

## ğŸ” å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### Q1: å¦‚ä½•åœ¨å¼€å‘æ—¶æŸ¥çœ‹å¼•å¯¼ç•Œé¢ï¼Ÿ

**A**: åœ¨å¼€å‘è€…å·¥å…· Console ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤é‡ç½®çŠ¶æ€ï¼š

```javascript
// é‡ç½®åˆ° setup é˜¶æ®µï¼ˆæ˜¾ç¤ºå¼•å¯¼é¡µé¢ï¼‰
chrome.storage.local.set({ 
  onboardingStatus: { 
    state: 'setup',
    currentStep: 1
  } 
}, () => {
  console.log('âœ… å·²é‡ç½®åˆ° setup é˜¶æ®µ')
  location.reload()
})
```

æ›´å¤šè°ƒè¯•å‘½ä»¤å‚è§ï¼š[å¼€å‘è€…å·¥å…·æ–‡æ¡£](./DEV_TOOLS.md)

### Q2: ç”»åƒæ„å»ºæ˜¯å¦æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åå°è°ƒåº¦ä»»åŠ¡ï¼Ÿ

**A**: **ä¸æ˜¯**ã€‚ç”»åƒæ„å»ºæ˜¯**äº‹ä»¶é©±åŠ¨**çš„ï¼Œç”±é¡µé¢è®¿é—®è§¦å‘ï¼š

1. **è§¦å‘æµç¨‹**ï¼š
   - ç”¨æˆ·æµè§ˆé¡µé¢ â†’ content script è®°å½•
   - å‘é€ `SAVE_PAGE_VISIT` æ¶ˆæ¯åˆ° background
   - background ä¿å­˜åˆ°æ•°æ®åº“ â†’ è§¦å‘ `ProfileUpdateScheduler`
   - æ ¹æ®ç­–ç•¥å†³å®šæ˜¯å¦æ›´æ–°ç”»åƒ

2. **æ›´æ–°ç­–ç•¥**ï¼š
   - é¦–æ¬¡ï¼šâ‰¥10 é¡µç«‹å³æ„å»º
   - å¢é‡ï¼šæ¯æ–°å¢ 5 é¡µæ›´æ–°ä¸€æ¬¡
   - å®šæœŸï¼š6 å°æ—¶ + æœ‰æ–°å†…å®¹
   - å¼ºåˆ¶ï¼š24 å°æ—¶å¿…æ›´æ–°

3. **åœ¨ Onboarding å„é˜¶æ®µçš„è¡Œä¸º**ï¼š
   - **setup**: `SAVE_PAGE_VISIT` æ¶ˆæ¯è¢«æ‹¦æˆªï¼Œä¸é‡‡é›†æ•°æ®ï¼Œä¸æ„å»ºç”»åƒ
   - **learning**: æ­£å¸¸é‡‡é›†é¡µé¢ â†’ è§¦å‘ç”»åƒæ„å»º
   - **ready**: æ­£å¸¸é‡‡é›†é¡µé¢ â†’ è§¦å‘ç”»åƒæ„å»º

4. **åå°è°ƒåº¦å™¨åªæœ‰ä¸¤ä¸ª**ï¼š
   - `feedScheduler`: RSS æŠ“å–ï¼ˆlearning + readyï¼‰
   - `recommendationScheduler`: æ¨èç”Ÿæˆï¼ˆä»… readyï¼‰

### Q3: çŠ¶æ€è½¬æ¢æ—¶åå°ä»»åŠ¡å¦‚ä½•æ§åˆ¶ï¼Ÿ

**A**: é€šè¿‡æ¶ˆæ¯é€šä¿¡æœºåˆ¶åŠ¨æ€é‡é…ç½®ï¼š

```typescript
// popup.tsx - çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥ background
chrome.runtime.sendMessage({ 
  type: 'ONBOARDING_STATE_CHANGED', 
  state: 'ready' 
})

// background.ts - æ¥æ”¶å¹¶é‡æ–°é…ç½®è°ƒåº¦å™¨
case 'ONBOARDING_STATE_CHANGED':
  await reconfigureSchedulersForState(state)
```

**å„é˜¶æ®µè¿è¡Œçš„ä»»åŠ¡**ï¼š
- **setup**: æ— ä»»ä½•åå°ä»»åŠ¡
- **learning**: feedSchedulerï¼ˆRSS æŠ“å–ï¼‰
- **ready**: feedScheduler + recommendationScheduler

---

## ğŸ”— ç›¸å…³æ–‡æ¡£
- [PRD - äº§å“å®šä½](./PRD.md)
- [TDD - AI é…ç½®](./TDD.md)
- [å¼€å‘è®¡åˆ’](./DEVELOPMENT_PLAN.md)

---

## ğŸ“ å®æ–½æ—¥å¿—

### 2025-11-25
- åˆ›å»ºåŠŸèƒ½æ–‡æ¡£
- å¼€å§‹å®æ–½ï¼ˆé¢„è®¡ 4-6 å°æ—¶ï¼‰
